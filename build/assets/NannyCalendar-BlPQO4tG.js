import{r as c,f as T,j as e}from"./index-BlCxgRmJ.js";import{u as P}from"./useI18n-BzDKbdEV.js";const v="https://api.monsite.fr";function R(n){const o=n.getFullYear(),w=n.getMonth(),h=new Date(o,w,1),u=new Date(o,w+1,0),g=new Date(h);g.setDate(h.getDate()-(h.getDay()+6)%7);const l=new Date(u);l.setDate(u.getDate()+(7-l.getDay()===7?0:7-l.getDay()));const d=[];for(let s=new Date(g);s<=l;s.setDate(s.getDate()+1))d.push(new Date(s));const m=[];for(let s=0;s<d.length;s+=7)m.push(d.slice(s,s+7));return m}function U(n){const o=new Date(n);return o.setDate(n.getDate()-(n.getDay()+6)%7),Array.from({length:7},(w,h)=>{const u=new Date(o);return u.setDate(o.getDate()+h),u})}function B({nannyId:n}){const{locale:o,t:w}=P(),[h,u]=c.useState([]),[g,l]=c.useState(null),[d,m]=c.useState(""),[s,y]=c.useState(""),[C,S]=c.useState("");c.useEffect(()=>{T(`${v}/children`,{credentials:"include"}).then(t=>t.json()).then(u)},[]);const[a,k]=c.useState(new Date),[M,$]=c.useState([]);c.useEffect(()=>{const t=a.getFullYear(),i=a.getMonth(),x=new Date(t,i,1),f=new Date(t,i+1,0);T(`${v}/assignments?nannyId=${n}&start=${x.toISOString()}&end=${f.toISOString()}`,{credentials:"include"}).then(p=>p.json()).then($)},[n,a]);const A=R(a),F=new Intl.DateTimeFormat(o,{month:"long",year:"numeric"}).format(a),E=Array.from({length:7}).map((t,i)=>{const x=U(new Date)[i];return new Intl.DateTimeFormat(o,{weekday:"short"}).format(x)}),I=()=>{const t=new Date(a);t.setMonth(t.getMonth()-1),k(t)},O=()=>{const t=new Date(a);t.setMonth(t.getMonth()+1),k(t)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-3 sm:mb-6 gap-2",children:[e.jsx("div",{className:"text-lg md:text-2xl font-bold text-gray-900",children:F.charAt(0).toUpperCase()+F.slice(1)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:I,className:"w-8 h-8 flex items-center justify-center rounded-full border border-gray-200 bg-white hover:bg-gray-100 text-gray-500",children:e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:O,className:"w-8 h-8 flex items-center justify-center rounded-full border border-gray-200 bg-white hover:bg-gray-100 text-gray-500",children:e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 5l7 7-7 7"})})})]})]}),e.jsx("div",{className:"block w-full",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[E.map((t,i)=>e.jsx("div",{className:"text-center text-gray-500 font-semibold text-xs py-1",children:t},i)),A.flat().map((t,i)=>{const x=t.toDateString()===new Date().toDateString(),f=t.getMonth()===a.getMonth(),p=r=>r.toString().padStart(2,"0"),N=`${t.getFullYear()}-${p(t.getMonth()+1)}-${p(t.getDate())}`,j=M.filter(r=>r.nanny.id===n&&r.date.split("T")[0]===N);return e.jsxs("div",{className:"align-top p-1 h-full flex flex-col "+(x?"border-2 border-green-400 rounded-xl ":"border border-gray-100 ")+(f?"bg-[#f8f8fc]":"bg-gray-50 opacity-60")+" relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold cursor-pointer "+(f?"text-gray-700":"text-gray-400"),children:t.getDate()}),e.jsx("button",{className:"text-[#0b5566] hover:text-[#08323a] text-lg font-bold",title:w("children.add"),onClick:()=>{l({date:N}),m(""),y("")},children:"+"})]}),j.length===0?e.jsx("div",{className:"text-gray-300 text-xs",children:"—"}):j.slice(0,2).map((r,D)=>e.jsxs("div",{className:"flex items-center gap-1 mb-1 px-1 py-1 rounded-lg "+(D===0?"bg-[#a9ddf2]":"bg-[#fff7e6]")+" shadow-sm group",children:[e.jsx("span",{className:"w-2 h-2 rounded-full "+(D===0?"bg-[#08323a]":"bg-[#856400]")}),e.jsx("span",{className:"font-semibold text-gray-800 text-[11px] group-hover:underline cursor-pointer hover:text-red-600 truncate max-w-[70px]",title:r.child.name,children:r.child.name})]},r.id)),j.length>2&&e.jsxs("div",{className:"text-xs text-gray-500 truncate max-w-[64px] sm:max-w-none",children:["+",j.length-2," autres"]})]},i)})]})}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm",children:e.jsxs("form",{className:"bg-white rounded-2xl shadow-xl p-6 w-full max-w-xs flex flex-col items-center relative",onSubmit:async t=>{if(t.preventDefault(),y(""),S(""),!d){y("Sélectionnez un enfant");return}if(M.filter(b=>b.date.split("T")[0]===g.date&&b.nanny.id===n).some(b=>b.child.id===d)){y("Cet enfant est déjà assigné ce jour-là");return}const[x,f,p]=g.date.split("-"),N=new Date(Date.UTC(Number(x),Number(f)-1,Number(p))).toISOString();if(!(await fetch(`${v}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({date:N,childId:d,nannyId:n})})).ok){y("Erreur lors de l'ajout");return}S("Enfant ajouté au planning !"),setTimeout(()=>{l(null),m(""),S("")},1200);const r=a.getFullYear(),D=a.getMonth(),W=new Date(r,D,1),Y=new Date(r,D+1,0);fetch(`${v}/assignments?nannyId=${n}&start=${W.toISOString()}&end=${Y.toISOString()}`,{credentials:"include"}).then(b=>b.json()).then($)},children:[e.jsx("button",{type:"button",onClick:()=>l(null),className:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl",children:"×"}),e.jsx("h2",{className:"text-lg font-bold mb-4 text-center",children:"Ajouter une affectation"}),e.jsxs("select",{value:d,onChange:t=>m(t.target.value),className:"border rounded px-2 py-1 mb-2 w-full",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner un enfant"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-3 py-1 rounded w-full",children:"Ajouter"}),e.jsx("button",{type:"button",className:"bg-gray-300 px-3 py-1 rounded w-full",onClick:()=>l(null),children:"Annuler"})]}),s&&e.jsx("div",{className:"text-red-600 text-xs mt-2 text-center w-full",children:s}),C&&e.jsx("div",{className:"text-green-600 text-xs mt-2 text-center w-full",children:C})]})})]})}export{B as N};
//# sourceMappingURL=NannyCalendar-BlPQO4tG.js.map
