const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/confetti.browser-DUKOiKk9.js","assets/index-BlCxgRmJ.js","assets/index-DQo9v92x.css"])))=>i.map(i=>d[i]);
import{r as i,_ as y,j as t,a as v,c as p,f as j}from"./index-BlCxgRmJ.js";import{S as w}from"./Sidebar-Gcre9kAW.js";import"./useI18n-BzDKbdEV.js";import"./index-fENnYS2p.js";const b="https://api.monsite.fr",g=new Map;function N(s){const[d,c]=i.useState([]),[u,m]=i.useState(!1);return i.useEffect(()=>{if(!s)return;let h=!1;return(async()=>{m(!0);try{let n=g.get(s);if(!n){const e=b?`${b}/centers/${s}/birthdays/today`:`/api/centers/${s}/birthdays/today`;n=(async()=>{const o=await fetch(e,{credentials:"include"});if(!o.ok)return{birthdays:[]};const r=await o.json();return{birthdays:Array.isArray(r.birthdays)?r.birthdays:[]}})(),g.set(s,n)}const f=await n;h||c(f.birthdays??[])}catch{h||c([])}finally{h||m(!1),g.delete(s)}})(),()=>{h=!0}},[s]),{birthdays:d,loading:u}}function S({items:s,open:d,onClose:c,centerId:u}){const m=i.useRef(null),h=e=>{if(!e)return null;try{const o=new Date(e);if(Number.isNaN(o.getTime()))return null;const r=new Date;let l=r.getFullYear()-o.getFullYear();const a=r.getMonth()-o.getMonth();return(a<0||a===0&&r.getDate()<o.getDate())&&l--,l}catch{return null}},n=i.useRef(!1),f=i.useRef(null);return i.useEffect(()=>{if(d){if(n.current=!0,(async()=>{try{let e=null;try{e=await y(()=>import("./confetti.module-DE9NzQ6R.js"),[])}catch{try{e=await y(()=>import("./confetti.browser-DUKOiKk9.js").then(a=>a.c),__vite__mapDeps([0,1,2]))}catch{e=null}}if(!e||!n.current)return;const o=e&&typeof e=="function"?e:e&&e.default||e;let r=null;try{r=o(void 0,{resize:!0,useWorker:!1})}catch(a){console.error("[BirthdayModal] confetti.create failed:",a)}if(!r||typeof r!="function")return;try{r({particleCount:140,spread:160,origin:{y:.6}})}catch(a){console.error("[BirthdayModal] confetti first-fire failed:",a)}const l=()=>{if(n.current){try{r({particleCount:40,spread:120,origin:{x:Math.random(),y:.6}}),console.debug("[BirthdayModal] confetti tick")}catch(a){console.error("[BirthdayModal] confetti tick error:",a)}n.current&&(f.current=window.setTimeout(l,1200))}};f.current=window.setTimeout(l,1200)}catch(e){console.error("[BirthdayModal] failed to load canvas-confetti:",e)}})(),u){const e=`birthday_seen:${u}:${new Date().toISOString().slice(0,10)}`;try{localStorage.setItem(e,"1")}catch{}}return()=>{n.current=!1,f.current!==null&&(clearTimeout(f.current),f.current=null)}}},[d,u]),i.useEffect(()=>{if(!d)return;document.getElementById("birthday-close-btn")?.focus()},[d]),d?t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-6",children:[t.jsx("canvas",{ref:m,className:"pointer-events-none fixed inset-0"}),t.jsxs("div",{role:"dialog","aria-modal":"true","aria-label":"CÃ©lÃ©bration anniversaire",className:"w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden",children:[t.jsxs("div",{className:"h-64 bg-gradient-to-br from-[#f6a21a] to-[#ffd98a] flex flex-col items-center justify-center text-white",children:[t.jsx("div",{className:"text-5xl",children:"ðŸŽ‰"}),t.jsx("h1",{className:"mt-3 text-4xl font-extrabold tracking-tight uppercase text-center",children:"Joyeux Anniversaire"})]}),t.jsxs("div",{className:"bg-white p-6",children:[s&&s.length>0?t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:s.map(e=>{const o=(e.name||"U").split(" ").map(l=>l[0]).slice(0,2).join(""),r=h(e.dob);return t.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg border border-gray-100 shadow-sm bg-white",children:[t.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg,#ff6aa1,#ff9b4a)"},children:t.jsx("span",{className:"text-white font-bold text-lg",children:o})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-lg font-extrabold text-[#08323a] truncate",children:e.name}),t.jsxs("div",{className:"text-sm text-gray-500 truncate",children:["fÃªte ",r!==null?`ses ${r} ans`:"son anniversaire"," aujourd'hui !"]})]}),t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"px-3 py-2 rounded-full bg-gradient-to-br from-[#e68d17] to-[#f7b65d] text-white font-semibold shadow",children:r??"-"})})]},e.id)})}):t.jsx("div",{className:"text-center text-gray-500",children:"Aucun enfant trouvÃ© pour aujourd'hui."}),t.jsx("div",{className:"mt-6",children:t.jsxs("div",{className:"rounded-xl border border-[#f3cda6] bg-gradient-to-br from-[#fff4ed] to-[#fff9f6] p-5 shadow-sm",children:[t.jsx("div",{className:"text-center text-[#b45309] font-semibold mb-2",children:"â™¡ Message spÃ©cial â™¡"}),t.jsxs("div",{className:"text-sm text-[#6b4b3a]",children:["Nous souhaitons Ã  ",s&&s.length===1?s[0].name:"tous les enfants"," une merveilleuse journÃ©e remplie de joie, de rires et de beaux souvenirs ! Que cette nouvelle annÃ©e vous apporte plein de dÃ©couvertes et de bonheurs."]})]})}),t.jsx("div",{className:"mt-6 pb-6 flex justify-center",children:t.jsx("button",{id:"birthday-close-btn",type:"button",onClick:c,className:"px-6 py-2 bg-[#08323a] text-white rounded-lg font-semibold shadow hover:bg-[#0b3b41] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#f6a21a]",children:"Fermer"})})]})]})]}):null}function B(){const[s,d]=i.useState(!0),[c,u]=i.useState(!1),m=v(),h=p(),[n,f]=i.useState(()=>{try{return localStorage.getItem("currentCenterId")??void 0}catch{return}}),{birthdays:e}=N(c?n:void 0),[o,r]=i.useState(!1);return i.useEffect(()=>{if(!e||e.length===0||!n)return;const l=`birthday_seen:${n}:${new Date().toISOString().slice(0,10)}`;let a=!1;try{a=!!localStorage.getItem(l)}catch{a=!1}a||r(!0)},[e,n,r]),i.useEffect(()=>{let l=!0;return(async()=>{try{const a=await j("/api/user/me",{credentials:"include"});if(!l)return;if(!a.ok){u(!1);return}const x=await a.json();u(!0);try{if(x&&x.centerId){try{localStorage.setItem("currentCenterId",String(x.centerId))}catch{}f(String(x.centerId))}}catch{}}catch{u(!1)}finally{l&&d(!1)}})(),()=>{l=!1}},[]),i.useEffect(()=>{if(!s&&!c&&m("/login",{replace:!0}),!s&&c)try{localStorage.setItem("welcomeShown","1")}catch{}},[s,c,m]),s?t.jsx("div",{className:"flex items-center justify-center h-screen",children:"Chargement..."}):c?t.jsxs("div",{className:"flex min-h-screen",children:[t.jsx(w,{}),t.jsx("main",{className:"flex-1 bg-gray-50 p-6 max-w-full overflow-x-hidden box-border",children:h}),t.jsx(S,{items:e,open:o,onClose:()=>r(!1),centerId:n})]}):null}export{B as default};
//# sourceMappingURL=ProtectedLayout-DMo8fCEy.js.map
