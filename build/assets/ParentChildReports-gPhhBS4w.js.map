{"version":3,"file":"ParentChildReports-gPhhBS4w.js","sources":["../../services/parent.ts","../../pages/ParentChildReports.tsx"],"sourcesContent":["import { fetchWithRefresh } from '../utils/fetchWithRefresh';\n\n// Use relative endpoints so the browser origin (and dev proxy) are respected\n\nasync function handleRes<T>(res: Response): Promise<T> {\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(text || 'API error');\n  }\n  return (await res.json()) as T;\n}\n\ntype Nanny = {\n  id: string;\n  name: string;\n  email?: string | null;\n};\n\ntype Child = {\n  id: string;\n  name: string;\n  birthDate?: string;\n  group?: string;\n};\n\ntype Schedule = {\n  id: string;\n  date: string;\n  startTime?: string;\n  endTime?: string;\n  name?: string;\n  comment?: string | null;\n  nannies?: Nanny[];\n};\n\ntype Report = {\n  id: string;\n  priority: string;\n  type: string;\n  status: string;\n  childId: string;\n  nannyId: string;\n  summary: string;\n  details: string;\n  date: string;\n  time: string;\n  duration?: string | null;\n  childrenInvolved?: number | null;\n  nanny?: Nanny | null;\n};\n\ntype ParentItem = {\n  id: string;\n  name: string;\n  email?: string | null;\n  children?: { child: Child }[];\n};\n\ntype AdminStats = {\n  parentsCount: number;\n  childrenCount: number;\n  presentToday: number;\n};\n\ntype AdminData = {\n  stats: AdminStats;\n  parents: ParentItem[];\n};\n\nexport default {\n  async getChildren(): Promise<Child[]> {\n  const res = await fetchWithRefresh(`/api/parent/children`, { credentials: 'include' });\n    return handleRes<Child[]>(res);\n  },\n  async getAdminList(): Promise<AdminData> {\n  const res = await fetchWithRefresh(`/api/parent/admin`, { credentials: 'include' });\n    return handleRes<AdminData>(res);\n  },\n  async getChildSchedule(childId: string): Promise<Schedule[]> {\n  const res = await fetchWithRefresh(`/api/parent/child/${childId}/schedule`, { credentials: 'include' });\n    return handleRes<Schedule[]>(res);\n  },\n  async getChildReports(childId: string): Promise<Report[]> {\n  const res = await fetchWithRefresh(`/api/parent/child/${childId}/reports`, { credentials: 'include' });\n    return handleRes<Report[]>(res);\n  },\n  async getChild(childId: string): Promise<Child> {\n  const res = await fetchWithRefresh(`/api/children/${childId}`, { credentials: 'include' });\n    return handleRes<Child>(res);\n  }\n};\n","import { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport Sidebar from '../components/Sidebar';\nimport parentService from '../services/parent';\n\ntype Nanny = { id: string; name: string };\ntype Report = { id: string; priority: string; type: string; status: string; summary: string; details: string; date: string; time?: string; nanny?: Nanny | null };\n\nconst typeLabel: Record<string, string> = {\n  incident: 'INCIDENT',\n  comportement: 'COMPORTEMENT',\n  soin: 'SOINS'\n};\n\nconst priorityStyles: Record<string, string> = {\n  haute: 'bg-[#ffeaea] border-[#ffdddd]',\n  moyenne: 'bg-[#fff7e6] border-[#fff1d6]',\n  basse: 'bg-[#a9ddf2] border-[#cfeef9]',\n};\n\nexport default function ParentChildReports() {\n  const { childId } = useParams();\n  const navigate = useNavigate();\n  const [reports, setReports] = useState<Report[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [childName, setChildName] = useState<string | null>(null);\n\n  const formatReportDate = (dateStr?: string, timeStr?: string) => {\n    if (!dateStr) return '';\n    try {\n      const dateOnly = dateStr.split(/[T ]/)[0];\n      let iso = dateOnly;\n\n      let normalizedTime: string | null = null;\n      if (timeStr) {\n        const t = timeStr.includes('h') ? timeStr.replace(/h/, ':').replace(/[^0-9:]/g, '') : timeStr;\n        const parts = t.split(':');\n        const hh = (parts[0] || '00').padStart(2, '0');\n        const mm = (parts[1] || '00').padStart(2, '0');\n        normalizedTime = `${hh}:${mm}:00`;\n      } else {\n        const rest = dateStr.includes('T') ? dateStr.split('T')[1] : (dateStr.includes(' ') ? dateStr.split(' ')[1] : undefined);\n        if (rest) {\n          const parts = rest.split(':');\n          const hh = (parts[0] || '00').padStart(2, '0');\n          const mm = (parts[1] || '00').padStart(2, '0');\n          normalizedTime = `${hh}:${mm}:00`;\n        }\n      }\n\n      iso = normalizedTime ? `${dateOnly}T${normalizedTime}` : `${dateOnly}T00:00:00`;\n\n      const d = new Date(iso);\n      if (isNaN(d.getTime())) return `${dateStr}${timeStr ? ' à ' + timeStr : ''}`;\n\n      const datePart = new Intl.DateTimeFormat('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }).format(d);\n      if (!normalizedTime) return datePart;\n\n      const hours = d.getHours().toString().padStart(2, '0');\n      const minutes = d.getMinutes().toString().padStart(2, '0');\n      return `${datePart} à ${hours}h${minutes}`;\n    } catch {\n      return `${dateStr}${timeStr ? ' à ' + timeStr : ''}`;\n    }\n  };\n\n  useEffect(() => {\n    if (!childId) return;\n    const load = async () => {\n      try {\n        const res = await parentService.getChildReports(childId);\n        if (Array.isArray(res)) {\n          setReports(res.filter(r => r && typeof r === 'object' && 'id' in r));\n        } else {\n          setReports([]);\n        }\n      } catch {\n        // noop\n      } finally {\n        setLoading(false);\n      }\n    };\n    load();\n  }, [childId]);\n\n  useEffect(() => {\n    if (!childId) return;\n    (async () => {\n      try {\n        const child = await parentService.getChild(childId);\n        setChildName(child && typeof child === 'object' && 'name' in child ? (child as { name?: string }).name || null : null);\n      } catch {\n        // noop\n      }\n    })();\n  }, [childId]);\n\n  return (\n    <div className=\"min-h-screen bg-[#f7f8fa] flex flex-col md:flex-row\">\n      <Sidebar />\n      <main className=\"flex-1 flex flex-col items-center py-4 px-2 md:py-8 md:px-4 md:ml-64\">\n        <div className=\"w-full max-w-5xl mx-auto\">\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4 w-full\">\n            <div className=\"self-start md:self-auto\">\n              <button className=\"flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-100 bg-[#a9ddf2] text-[#0b5566] hover:bg-[#cfeef9] cursor-pointer\" onClick={() => navigate(-1)}>\n                <span className=\"text-lg\">←</span>\n                <span className=\"font-medium\">Retour</span>\n              </button>\n            </div>\n            <div className=\"flex-1 text-center min-w-0\">\n              <h1 className=\"text-2xl sm:text-3xl font-extrabold text-gray-900 mb-1 tracking-tight truncate\">Rapports de {childName ?? \"l'enfant\"}</h1>\n              <div className=\"text-base sm:text-lg text-gray-500 font-medium mb-2 sm:mb-4\">Consultez les rapports liés à cet enfant.</div>\n            </div>\n            <div className=\"w-24 md:w-32\" />\n          </div>\n\n          <div className=\"flex flex-col gap-4 md:gap-6\">\n            {loading ? (\n              <div>Chargement...</div>\n            ) : reports.length === 0 ? (\n              <div>Aucun rapport trouvé.</div>\n            ) : (\n              reports.map(report => (\n                <div key={report.id} className={`rounded-xl shadow border-2 ${priorityStyles[report.priority] || ''} overflow-hidden w-full`} style={{ minWidth: 0 }}>\n                  <div className={`flex flex-col md:flex-row items-start md:items-center justify-between px-4 py-2 md:px-6`} style={{ background: report.priority === 'haute' ? '#ffeaea' : report.priority === 'moyenne' ? '#fff7e6' : '#a9ddf2' }}>\n                    <div className=\"flex items-center gap-2 md:gap-3 mb-2 md:mb-0 min-w-0\">\n                      <span className={`px-2 py-1 rounded-lg font-bold text-xs truncate`} style={{ background: report.type === 'incident' ? '#ffeaea' : report.type === 'comportement' ? '#fff7e6' : '#a9ddf2', color: report.type === 'incident' ? '#7a2a2a' : report.type === 'comportement' ? '#856400' : '#08323a' }}>{typeLabel[report.type] || report.type}</span>\n                      <span className={`px-2 py-1 rounded-lg font-bold text-xs`} style={{ background: report.priority === 'haute' ? '#dc2626' : report.priority === 'moyenne' ? '#f59e0b' : '#0b5566', color: '#ffffff' }}>{report.priority?.toUpperCase()}</span>\n                      <span className=\"font-bold text-xs md:text-sm ml-1 truncate\" style={{ color: '#08323a' }}>{report.nanny?.name ?? '—'}</span>\n                    </div>\n                    <div className=\"text-xs text-gray-500 mt-2 md:mt-0 md:ml-4 whitespace-nowrap\">{formatReportDate(report.date, report.time)}</div>\n                  </div>\n                  <div className=\"px-4 py-3 md:px-6 md:py-4\">\n                    <div className=\"font-bold text-gray-700 mb-1 text-sm md:text-base\">Résumé</div>\n                    <div className=\"text-gray-700 text-sm md:text-base mb-2 line-clamp-3\">{report.summary}</div>\n                    <div className=\"text-sm text-gray-500 mt-2 line-clamp-4\">{report.details}</div>\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n"],"names":["handleRes","res","text","parentService","fetchWithRefresh","childId","typeLabel","priorityStyles","ParentChildReports","useParams","navigate","useNavigate","reports","setReports","useState","loading","setLoading","childName","setChildName","formatReportDate","dateStr","timeStr","dateOnly","iso","normalizedTime","parts","hh","mm","rest","d","datePart","hours","minutes","useEffect","r","child","jsxs","jsx","Sidebar","report"],"mappings":"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"}