{"version":3,"file":"PricingPage-Cpe4bSZ3.js","sources":["../../pages/PricingPage.tsx"],"sourcesContent":["import SEO from '../components/SEO';\nimport { useEffect, useState} from 'react';\nimport { useNavigate } from 'react-router-dom';\n// Stripe Checkout redirect only: no Elements or inline card collection\n\n\nconst plans = [\n  {\n    name: 'Découverte',\n    price: '0€',\n    description: 'Pour tester Frimousse sans engagement (15 jours max)',\n    features: [\n      'Limite sur la création de compte',\n      'Support par email',\n      'Accès web responsive',\n    ],\n    cta: 'Essai gratuit',\n    highlight: false,\n    buyButtonId: null,\n  },\n  {\n    name: 'Essentiel',\n    price: '29€ / mois',\n    description: 'Pour les MAM, micro-crèches et petites structures',\n    features: [\n      'Jusqu’à 10 enfants',\n      'Notifications email',\n      'Support par email',\n    ],\n    cta: 'Choisir Essentiel',\n    highlight: false,\n  buyButtonId: 'buy_btn_1Ru88bExeKKlzm3U232ITaMN', \n  productId: 'prod_SpdCOBUbbne4oo',\n  },\n  {\n    name: 'Pro',\n    price: '59€ / mois',\n    description: 'Pour crèches, garderies, centres de loisirs',\n    features: [\n      'Création de comptes illimités',\n      'facturations détaillées',\n      'Assistant IA',\n      'Support prioritaire',\n    ],\n    cta: 'Choisir Pro',\n    highlight: true,\n    buyButtonId: 'buy_btn_1Ru84HExeKKlzm3UMPmR820n', \n    productId: 'prod_SpdCOBUbbne4oo',\n  },\n];\n\nexport default function PricingPage() {\n  const navigate = useNavigate();\n  const search = typeof window !== 'undefined' ? new URLSearchParams(window.location.search) : new URLSearchParams('');\n  const subscribeTokenFromQs = search.get('subscribeToken');\n  const prefillEmailFromQs = search.get('prefillEmail');\n  const [userRole, setUserRole] = useState<string | null>(null);\n  // removed pending discovery modal state (Découverte now redirects to /register)\n  const [globalMessage, setGlobalMessage] = useState<null | { type: 'success' | 'error' | 'info'; text: string }>(null);\n  const [userRoleLoading, setUserRoleLoading] = useState(true);\n  const [paidInfoShown, setPaidInfoShown] = useState<string | null>(null);\n\n  useEffect(() => {\n    setUserRoleLoading(true);\n    fetch('api/me', { credentials: 'include' })\n      .then(r => r.ok ? r.json() : null)\n      .then(data => setUserRole(data?.role || null))\n      .catch(() => setUserRole(null))\n      .finally(() => setUserRoleLoading(false));\n    if (prefillEmailFromQs) setGlobalMessage({ type: 'info', text: `Continuer l'abonnement pour ${prefillEmailFromQs}` });\n  }, [prefillEmailFromQs, subscribeTokenFromQs]);\n\n  // startDiscovery removed: Découverte redirects to /register\n\n  async function startDirect(planKey: string, selPlan?: string) {\n    try {\n      const effectivePlan = planKey;\n      const endpoint = subscribeTokenFromQs ? '/subscriptions/create-checkout-with-token' : '/subscriptions/create-checkout';\n      const body: { plan: string; mode: 'direct' | 'discovery'; selectedPlan?: string; subscribeToken?: string } = { plan: effectivePlan, mode: 'direct' };\n      if (selPlan) body.selectedPlan = selPlan;\n      if (subscribeTokenFromQs) body.subscribeToken = subscribeTokenFromQs;\n      const res = await fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, credentials: subscribeTokenFromQs ? 'omit' : 'include', body: JSON.stringify(body) });\n      const data = await res.json().catch(() => ({}));\n      if (!res.ok || !data.url) throw new Error(data.error || 'Impossible de créer la session de paiement');\n      window.location.href = data.url;\n    } catch (err) {\n      const message = err && (err as Error).message ? (err as Error).message : String(err);\n      setGlobalMessage({ type: 'error', text: message || 'Erreur lors de la création de l’abonnement.' });\n    } finally {\n      // nothing to cleanup\n    }\n  }\n\n  // No modal state to close; discovery chooser uses setPendingPlan(null)\n\n  // No inline card collection: Checkout handles payment. CardModal removed.\n\n  // Discovery chooser removed — Découverte now redirects to registration\n\n\n  return (\n    <div className=\"min-h-screen w-full flex flex-col overflow-x-hidden bg-[#f7f4d7] p-0 m-0\">\n      <SEO\n        title={\"Tarifs | Frimousse Association\"}\n        description={\"Découvrez les tarifs de Frimousse pour crèches associatives, micro-crèches, garderies, centres de loisirs et MAM. Abonnement mensuel, offre gratuite, options modulaires.\"}\n        url={\"https://frimousse-asso.fr/tarifs\"}\n        image={\"/frimousse-cover.png\"}\n      />\n      <script async src=\"https://js.stripe.com/v3/buy-button.js\"></script>\n      <header className=\"w-full bg-gradient-to-r from-[#a9ddf2] to-[#f7f4d7] border-b border-[#fcdcdf] sticky top-0 z-10\">\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between py-3 px-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-full overflow-hidden flex items-center justify-center\">\n              <img src=\"/imgs/LogoFrimousse.webp\" alt=\"Logo Frimousse\" className=\"w-full h-full object-contain\" />\n            </div>\n            <div className=\"w-full text-center\">\n              <span className=\"font-bold text-base text-[#08323a]\">Les Frimousses</span>\n            </div>\n          </div>\n        </div>\n      </header>\n      <main className=\"flex-1 w-full\">\n        {globalMessage && (\n          <div className={`max-w-4xl mx-auto mt-6 p-3 rounded ${globalMessage.type === 'success' ? 'bg-green-50 border border-green-200 text-green-800' : globalMessage.type === 'error' ? 'bg-red-50 border border-red-200 text-red-800' : 'bg-blue-50 border border-blue-200 text-blue-800'}`} role=\"status\">\n            {globalMessage.text}\n          </div>\n        )}\n        <section className=\"w-full py-12 px-6 bg-white border-b border-gray-100\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <button\n              onClick={() => navigate('/')} \n              className=\"mb-8 px-4 py-2 rounded bg-[#0b5566] text-white hover:opacity-95 transition font-semibold shadow focus:outline-none focus:ring-2 focus:ring-[#a9ddf2] focus:ring-offset-2\"\n              aria-label=\"Retour à l'accueil\"\n            >\n              ← Retour à l'accueil\n            </button>\n            <h1 className=\"text-3xl md:text-4xl font-bold text-[#0b5566] mb-6\">Tarifs</h1>\n            <p className=\"text-gray-700 text-base sm:text-lg mb-10\">\n              Des forfaits simples et transparents, adaptés à toutes les structures d’accueil d’enfants : crèches associatives, micro-crèches, garderies, centres de loisirs, MAM…\n            </p>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 items-stretch w-full\">\n              {plans.map((plan, idx) => (\n                <div\n                  key={idx}\n                  className={`rounded-lg border shadow p-6 flex flex-col items-center bg-[#f7f4d7] ${plan.highlight ? 'border-[#0b5566] shadow-lg' : 'border-[#fcdcdf]'} h-full min-w-0 w-full max-w-md mx-auto md:max-w-[420px] md:w-full md:h-auto min-h-[380px] md:min-h-[420px]`}\n                  style={{width: '100%', maxWidth: '420px', margin: '0 auto'}}\n                >\n                  <h2 className={`text-xl font-bold mb-2 ${plan.highlight ? 'text-[#0b5566]' : 'text-[#08323a]'}`}>{plan.name}</h2>\n                  <div className=\"text-3xl font-extrabold mb-2\">{plan.price}</div>\n                  <div className=\"mb-4 text-[#08323a] text-center\">{plan.description}</div>\n                  <div className=\"flex-1 w-full flex flex-col\">\n                    <ul className=\"mb-6 text-left space-y-2 text-[#08323a] flex-1\">\n                      {plan.features.map((f, i) => (\n                        <li key={i} className=\"flex items-center gap-2\"><span className=\"text-[#0b5566]\">✔</span> {f}</li>\n                      ))}\n                    </ul>\n                  </div>\n                  {plan.buyButtonId ? (\n                    <div className=\"w-full flex flex-col items-center mt-4\">\n                      {paidInfoShown === plan.name && (\n                        <div className=\"w-full max-w-xs mb-2 flex items-start justify-between\">\n                          <div className=\"rounded-md bg-yellow-100 border-l-4 border-yellow-400 p-3 text-sm text-yellow-800 flex-1\">\n                            Les abonnements payants ne sont pas encore disponibles — contactez-nous pour plus de renseignements.\n                          </div>\n                          <button aria-label=\"Fermer\" onClick={() => setPaidInfoShown(null)} className=\"ml-2 text-sm text-gray-600\">✕</button>\n                        </div>\n                      )}\n                      <button\n                        className=\"w-full max-w-xs h-11 px-4 font-semibold transition shadow focus:outline-none focus:ring-2 focus:ring-[#a9ddf2] focus:ring-offset-2 flex items-center justify-center cursor-not-allowed rounded bg-gray-300 text-gray-600\"\n                        type=\"button\"\n                        aria-disabled=\"true\"\n                        title=\"Les abonnements payants ne sont pas encore disponibles. Contactez-nous pour plus d’informations.\"\n                        onClick={() => setPaidInfoShown(plan.name)}\n                      >\n                        {plan.cta}\n                      </button>\n                    </div>\n                  ) : (\n                    <div className=\"w-full flex justify-center mt-4\">\n                      <button\n                        className=\"w-full max-w-xs h-11 px-4 font-semibold transition shadow focus:outline-none focus:ring-2 focus:ring-[#a9ddf2] focus:ring-offset-2 flex items-center justify-center cursor-pointer rounded\"\n                        type=\"button\"\n                        style={{ backgroundColor: '#0b5566', color: '#fff' }}\n                        onClick={() => {\n                          if (userRoleLoading) return setGlobalMessage({ type: 'info', text: 'Chargement en cours…' });\n                          // If user clicked the free trial, navigate to register when not logged in.\n                          if (plan.name === 'Découverte') {\n                            if (userRole) return setGlobalMessage({ type: 'info', text: 'Vous êtes déjà connecté.' });\n                            return navigate('/register');\n                          }\n                          // For paid plans, keep existing admin guard\n                          if (userRole === 'super-admin') return setGlobalMessage({ type: 'info', text: \"Compte administrateur — l'abonnement n'est pas requis.\" });\n                          // For Essentiel/Pro use direct mode (30 days trial)\n                          return startDirect(plan.name.toLowerCase());\n                        }}\n                      >\n                        <span className=\"Text Text-color--default Text-fontWeight--500 Text--truncate\" data-testid=\"hosted-buy-button-text\">\n                          {plan.cta}\n                        </span>\n                      </button>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n            <div className=\"mt-10 text-gray-600 text-sm\">\n              <p>Tarifs hors taxes. Sans engagement. Options sur devis : formation, migration de données, modules personnalisés.</p>\n              <p className=\"mt-2\">Pour les réseaux, fédérations ou structures multi-sites, contactez-nous pour une offre sur-mesure.</p>\n            </div>\n          </div>\n        </section>\n  {/* Discovery chooser removed */}\n        <div className=\"max-w-4xl mx-auto text-center mt-10 mb-8\">\n          <button\n            onClick={() => navigate('/')}\n            className=\"px-4 py-2 rounded bg-[#0b5566] text-white hover:opacity-95 transition font-semibold shadow focus:outline-none focus:ring-2 focus:ring-[#a9ddf2] focus:ring-offset-2\"\n            aria-label=\"Retour à l'accueil (bas de page)\"\n          >\n            ← Retour à l'accueil\n          </button>\n        </div>\n      </main>\n    </div>\n  );\n}\n"],"names":["plans","PricingPage","navigate","useNavigate","search","subscribeTokenFromQs","prefillEmailFromQs","userRole","setUserRole","useState","globalMessage","setGlobalMessage","userRoleLoading","setUserRoleLoading","paidInfoShown","setPaidInfoShown","useEffect","r","data","startDirect","planKey","selPlan","effectivePlan","endpoint","body","res","err","message","jsxs","jsx","SEO","plan","idx","f"],"mappings":"6DAMA,MAAMA,EAAQ,CACZ,CACE,KAAM,aACN,MAAO,KACP,YAAa,uDACb,SAAU,CACR,mCACA,oBACA,sBAAA,EAEF,IAAK,gBACL,UAAW,GACX,YAAa,IAAA,EAEf,CACE,KAAM,YACN,MAAO,aACP,YAAa,oDACb,SAAU,CACR,qBACA,sBACA,mBAAA,EAEF,IAAK,oBACL,UAAW,GACb,YAAa,mCACb,UAAW,qBAAA,EAEX,CACE,KAAM,MACN,MAAO,aACP,YAAa,8CACb,SAAU,CACR,gCACA,0BACA,eACA,qBAAA,EAEF,IAAK,cACL,UAAW,GACX,YAAa,mCACb,UAAW,qBAAA,CAEf,EAEA,SAAwBC,GAAc,CACpC,MAAMC,EAAWC,EAAA,EACXC,EAAS,OAAO,OAAW,IAAc,IAAI,gBAAgB,OAAO,SAAS,MAAM,EAAI,IAAI,gBAAgB,EAAE,EAC7GC,EAAuBD,EAAO,IAAI,gBAAgB,EAClDE,EAAqBF,EAAO,IAAI,cAAc,EAC9C,CAACG,EAAUC,CAAW,EAAIC,EAAAA,SAAwB,IAAI,EAEtD,CAACC,EAAeC,CAAgB,EAAIF,EAAAA,SAAsE,IAAI,EAC9G,CAACG,EAAiBC,CAAkB,EAAIJ,EAAAA,SAAS,EAAI,EACrD,CAACK,EAAeC,CAAgB,EAAIN,EAAAA,SAAwB,IAAI,EAEtEO,EAAAA,UAAU,IAAM,CACdH,EAAmB,EAAI,EACvB,MAAM,SAAU,CAAE,YAAa,SAAA,CAAW,EACvC,KAAKI,GAAKA,EAAE,GAAKA,EAAE,KAAA,EAAS,IAAI,EAChC,KAAKC,GAAQV,EAAYU,GAAM,MAAQ,IAAI,CAAC,EAC5C,MAAM,IAAMV,EAAY,IAAI,CAAC,EAC7B,QAAQ,IAAMK,EAAmB,EAAK,CAAC,EACtCP,KAAqC,CAAE,KAAM,OAAQ,KAAM,+BAA+BA,CAAkB,GAAI,CACtH,EAAG,CAACA,EAAoBD,CAAoB,CAAC,EAI7C,eAAec,EAAYC,EAAiBC,EAAkB,CAC5D,GAAI,CACF,MAAMC,EAAgBF,EAChBG,EAAWlB,EAAuB,4CAA8C,iCAChFmB,EAAuG,CAAE,KAAMF,EAAe,KAAM,QAAA,EAEtIjB,MAA2B,eAAiBA,GAChD,MAAMoB,EAAM,MAAM,MAAMF,EAAU,CAAE,OAAQ,OAAQ,QAAS,CAAE,eAAgB,oBAAsB,YAAalB,EAAuB,OAAS,UAAW,KAAM,KAAK,UAAUmB,CAAI,EAAG,EACnLN,EAAO,MAAMO,EAAI,KAAA,EAAO,MAAM,KAAO,CAAA,EAAG,EAC9C,GAAI,CAACA,EAAI,IAAM,CAACP,EAAK,IAAK,MAAM,IAAI,MAAMA,EAAK,OAAS,4CAA4C,EACpG,OAAO,SAAS,KAAOA,EAAK,GAC9B,OAASQ,EAAK,CACZ,MAAMC,EAAUD,GAAQA,EAAc,QAAWA,EAAc,QAAU,OAAOA,CAAG,EACnFf,EAAiB,CAAE,KAAM,QAAS,KAAMgB,GAAW,8CAA+C,CACpG,QAAA,CAEA,CACF,CASA,OACEC,EAAAA,KAAC,MAAA,CAAI,UAAU,2EACb,SAAA,CAAAC,EAAAA,IAACC,EAAA,CACC,MAAO,iCACP,YAAa,4KACb,IAAK,mCACL,MAAO,sBAAA,CAAA,EAETD,EAAAA,IAAC,SAAA,CAAO,MAAK,GAAC,IAAI,yCAAyC,EAC3DA,EAAAA,IAAC,SAAA,CAAO,UAAU,kGAChB,SAAAA,EAAAA,IAAC,MAAA,CAAI,UAAU,gEACb,SAAAD,OAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,0EACb,SAAAA,EAAAA,IAAC,MAAA,CAAI,IAAI,2BAA2B,IAAI,iBAAiB,UAAU,8BAAA,CAA+B,EACpG,EACAA,EAAAA,IAAC,OAAI,UAAU,qBACb,eAAC,OAAA,CAAK,UAAU,qCAAqC,SAAA,gBAAA,CAAc,CAAA,CACrE,CAAA,CAAA,CACF,EACF,EACF,EACAD,EAAAA,KAAC,OAAA,CAAK,UAAU,gBACb,SAAA,CAAAlB,SACE,MAAA,CAAI,UAAW,sCAAsCA,EAAc,OAAS,UAAY,qDAAuDA,EAAc,OAAS,QAAU,+CAAiD,iDAAiD,GAAI,KAAK,SACzR,WAAc,KACjB,QAED,UAAA,CAAQ,UAAU,sDACjB,SAAAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,gCACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM3B,EAAS,GAAG,EAC3B,UAAU,2KACV,aAAW,qBACZ,SAAA,sBAAA,CAAA,EAGD2B,EAAAA,IAAC,KAAA,CAAG,UAAU,qDAAqD,SAAA,SAAM,EACzEA,EAAAA,IAAC,IAAA,CAAE,UAAU,2CAA2C,SAAA,uKAExD,EACAA,EAAAA,IAAC,OAAI,UAAU,6DACZ,WAAM,IAAI,CAACE,EAAMC,IAChBJ,EAAAA,KAAC,MAAA,CAEC,UAAW,wEAAwEG,EAAK,UAAY,6BAA+B,kBAAkB,8GACrJ,MAAO,CAAC,MAAO,OAAQ,SAAU,QAAS,OAAQ,QAAA,EAElD,SAAA,CAAAF,EAAAA,IAAC,KAAA,CAAG,UAAW,0BAA0BE,EAAK,UAAY,iBAAmB,gBAAgB,GAAK,SAAAA,EAAK,IAAA,CAAK,EAC5GF,EAAAA,IAAC,MAAA,CAAI,UAAU,+BAAgC,WAAK,MAAM,EAC1DA,EAAAA,IAAC,MAAA,CAAI,UAAU,kCAAmC,WAAK,YAAY,QAClE,MAAA,CAAI,UAAU,8BACb,SAAAA,EAAAA,IAAC,MAAG,UAAU,iDACX,SAAAE,EAAK,SAAS,IAAI,CAACE,EAAG,IACrBL,OAAC,KAAA,CAAW,UAAU,0BAA0B,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,iBAAiB,SAAA,IAAC,EAAO,IAAEI,CAAA,CAAA,EAAlF,CAAoF,CAC9F,CAAA,CACH,EACF,EACCF,EAAK,YACJH,OAAC,MAAA,CAAI,UAAU,yCACZ,SAAA,CAAAd,IAAkBiB,EAAK,MACtBH,EAAAA,KAAC,MAAA,CAAI,UAAU,wDACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,2FAA2F,SAAA,uGAE1G,EACAA,EAAAA,IAAC,SAAA,CAAO,aAAW,SAAS,QAAS,IAAMd,EAAiB,IAAI,EAAG,UAAU,6BAA6B,SAAA,GAAA,CAAC,CAAA,EAC7G,EAEFc,EAAAA,IAAC,SAAA,CACC,UAAU,2NACV,KAAK,SACL,gBAAc,OACd,MAAM,mGACN,QAAS,IAAMd,EAAiBgB,EAAK,IAAI,EAExC,SAAAA,EAAK,GAAA,CAAA,CACR,CAAA,CACF,EAEAF,EAAAA,IAAC,MAAA,CAAI,UAAU,kCACb,SAAAA,EAAAA,IAAC,SAAA,CACC,UAAU,6LACV,KAAK,SACL,MAAO,CAAE,gBAAiB,UAAW,MAAO,MAAA,EAC5C,QAAS,IACHjB,EAAwBD,EAAiB,CAAE,KAAM,OAAQ,KAAM,uBAAwB,EAEvFoB,EAAK,OAAS,aACZxB,EAAiBI,EAAiB,CAAE,KAAM,OAAQ,KAAM,2BAA4B,EACjFT,EAAS,WAAW,EAGzBK,IAAa,cAAsBI,EAAiB,CAAE,KAAM,OAAQ,KAAM,yDAA0D,EAEjIQ,EAAYY,EAAK,KAAK,YAAA,CAAa,EAG5C,eAAC,OAAA,CAAK,UAAU,+DAA+D,cAAY,yBACxF,WAAK,GAAA,CACR,CAAA,CAAA,CACF,CACF,CAAA,CAAA,EAzDGC,CAAA,CA4DR,EACH,EACAJ,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAC,EAAAA,IAAC,KAAE,SAAA,iHAAA,CAA+G,EAClHA,EAAAA,IAAC,IAAA,CAAE,UAAU,OAAO,SAAA,oGAAA,CAAkG,CAAA,CAAA,CACxH,CAAA,CAAA,CACF,CAAA,CACF,EAEAA,EAAAA,IAAC,MAAA,CAAI,UAAU,2CACb,SAAAA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM3B,EAAS,GAAG,EAC3B,UAAU,sKACV,aAAW,mCACZ,SAAA,sBAAA,CAAA,CAED,CACF,CAAA,CAAA,CACF,CAAA,EACF,CAEJ"}