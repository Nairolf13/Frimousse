{"version":3,"file":"LoginPage-BiBZbpzD.js","sources":["../../pages/LoginPage.tsx"],"sourcesContent":["import { useState } from 'react';\n\n\nconst API_URL = import.meta.env.VITE_API_URL;\n\nexport default function LoginPage() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [forgotOpen, setForgotOpen] = useState(false);\n  const [forgotEmail, setForgotEmail] = useState('');\n  const [forgotMessage, setForgotMessage] = useState('');\n  const [needsSubscription, setNeedsSubscription] = useState(false);\n  const [prefillEmail, setPrefillEmail] = useState('');\n  const [subscribeToken, setSubscribeToken] = useState<string | null>(null);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    try {\n      const res = await fetch(`${API_URL}/auth/login`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ email, password })\n      });\n      if (!res.ok) {\n        const data = await res.json().catch(() => ({}));\n        if (res.status === 402 && data && data.error) {\n          setError(data.error);\n          setNeedsSubscription(true);\n          setPrefillEmail(email);\n          setSubscribeToken(data.subscribeToken || null);\n          return;\n        }\n        throw new Error(data?.message || data?.error || 'Identifiants invalides');\n      }\n      window.location.href = '/dashboard';\n    } catch (err: unknown) {\n      if (err instanceof Error) {\n        setError(err.message || 'Erreur de connexion');\n      } else {\n        setError('Erreur de connexion');\n      }\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen w-screen max-w-full overflow-x-hidden flex items-center justify-center  bg-gradient-to-r from-[#f7f4d7] to-[#a9ddf2]\">\n      <form onSubmit={handleSubmit} className=\"bg-white rounded-2xl shadow-lg p-8 w-full max-w-md flex flex-col items-center\">\n        <div className=\"w-20 h-20 mb-4\">\n          <img src=\"/imgs/LogoFrimousse.webp\" alt=\"Logo Frimousse\" className=\"w-full h-full object-contain\" />\n        </div>\n        <h2 className=\"text-2xl font-bold mb-2 text-[#0b5566] text-center\">Connexion</h2>\n        <p className=\"mb-6 text-[#08323a] text-center\">Connectez-vous √† votre espace Frimousse</p>\n        {error && <div className=\"mb-4 text-red-600 w-full text-center\">{error}</div>}\n        {needsSubscription && (\n          <div className=\"mb-4 w-full text-center\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                const qs = new URLSearchParams();\n                if (prefillEmail) qs.set('prefillEmail', prefillEmail);\n                if (subscribeToken) qs.set('subscribeToken', subscribeToken);\n                window.location.href = `/tarifs?${qs.toString()}`;\n              }}\n              className=\"bg-[#0b5566] text-white px-4 py-2 rounded\"\n            >\n              S'abonner\n            </button>\n          </div>\n        )}\n        <label className=\"block mb-3 w-full text-left font-medium text-[#08323a]\">Email\n          <input type=\"email\" value={email} onChange={e => setEmail(e.target.value)} required className=\"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n        </label>\n        <label className=\"block mb-6 w-full text-left font-medium text-gray-700\">Mot de passe\n          <div className=\"relative\">\n            <input\n              type={showPassword ? \"text\" : \"password\"}\n              value={password}\n              onChange={e => setPassword(e.target.value)}\n              required\n              className=\"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-200 pr-10\"\n            />\n            <button\n              type=\"button\"\n              tabIndex={-1}\n              aria-label={showPassword ? \"Masquer le mot de passe\" : \"Afficher le mot de passe\"}\n              className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-[#0b5566] text-lg focus:outline-none\"\n              onClick={() => setShowPassword(v => !v)}\n            >\n              {showPassword ? 'üôà' : 'üëÅÔ∏è'}\n            </button>\n          </div>\n        </label>\n  <div className=\"w-full text-center text-sm mt-6 mb-6\">\n          <button type=\"button\" onClick={() => setForgotOpen(true)} className=\"text-[#0b5566] hover:underline\">Mot de passe oubli√© ?</button>\n        </div>\n        <button type=\"submit\" className=\"w-full bg-[#0b5566] text-white py-2 rounded-full font-semibold hover:opacity-95 transition\">Se connecter</button>\n        <div className=\"mt-4 text-sm text-[#08323a]\">Pas encore de compte ? <a href=\"/register\" className=\"text-[#0b5566] hover:underline\">Cr√©er un compte</a></div>\n      </form>\n      {forgotOpen && (\n        <div className=\"fixed inset-0 bg-black/40 flex items-center justify-center\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-sm\">\n            <h3 className=\"text-lg font-semibold mb-2\">R√©initialiser le mot de passe</h3>\n            {forgotMessage ? <div className=\"mb-2 text-green-600\">{forgotMessage}</div> : null}\n            <label className=\"block mb-3\">Email\n              <input type=\"email\" value={forgotEmail} onChange={e => setForgotEmail(e.target.value)} className=\"mt-1 w-full border border-gray-300 rounded-lg px-3 py-2\" />\n            </label>\n            <div className=\"flex justify-end gap-2\">\n              <button type=\"button\" onClick={() => setForgotOpen(false)} className=\"px-3 py-1\">Annuler</button>\n              <button type=\"button\" onClick={async () => {\n                setForgotMessage('');\n                try {\n                  const res = await fetch(`${API_URL}/auth/forgot`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: forgotEmail }) });\n                  if (res.ok) {\n                    setForgotMessage('Si un compte existe, un email de r√©initialisation a √©t√© envoy√©.');\n                  } else {\n                    const d = await res.json().catch(() => ({}));\n                    setForgotMessage(d?.error || 'Erreur');\n                  }\n                } catch (err) {\n                  console.error('forgot request error', err);\n                  setForgotMessage('Erreur r√©seau');\n                }\n              }} className=\"bg-[#0b5566] text-white px-3 py-1 rounded\">Envoyer</button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["API_URL","LoginPage","email","setEmail","useState","password","setPassword","error","setError","showPassword","setShowPassword","forgotOpen","setForgotOpen","forgotEmail","setForgotEmail","forgotMessage","setForgotMessage","needsSubscription","setNeedsSubscription","prefillEmail","setPrefillEmail","subscribeToken","setSubscribeToken","handleSubmit","e","res","data","err","jsxs","jsx","qs","v","d"],"mappings":"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"}