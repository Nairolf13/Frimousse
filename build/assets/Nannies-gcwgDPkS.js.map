{"version":3,"file":"Nannies-gcwgDPkS.js","sources":["../../pages/Nannies.tsx"],"sourcesContent":["import React from 'react';\nimport { useI18n } from '../src/lib/useI18n';\nimport '../styles/filter-responsive.css';\nimport NannyCalendar from '../components/NannyCalendar';\nimport { useAuth } from '../src/context/AuthContext';\nimport { fetchWithRefresh } from '../utils/fetchWithRefresh';\n\n\nconst API_URL = import.meta.env.VITE_API_URL;\n\n\nfunction PlanningModal({ nanny, onClose }: { nanny: Nanny; onClose: () => void }) {\n  const { t } = useI18n();\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm\">\n      <div className=\"bg-white rounded-2xl shadow-xl p-6 w-full max-w-2xl relative\">\n        <button onClick={onClose} className=\"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl\">√ó</button>\n        <h2 className=\"text-xl font-bold mb-4 text-center\">{t('nanny.planning.of', { name: nanny.name })}</h2>\n        <NannyCalendar nannyId={nanny.id} />\n      </div>\n    </div>\n  );\n}\n\nimport { useEffect, useState, useRef } from 'react';\nimport { getCached, setCached } from '../src/utils/apiCache';\n\ninterface Child {\n  id: string;\n  name: string;\n}\n\ninterface Nanny {\n  id: string;\n  name: string;\n  availability: string;\n  experience: number;\n  assignedChildren: Child[];\n  specializations?: string[];\n  status?: 'Disponible' | 'En cong√©';\n  contact?: string;\n  email?: string;\n  cotisationPaidUntil?: string | null;\n  birthDate?: string | null;\n  address?: string | null;\n  postalCode?: string | null;\n  city?: string | null;\n  region?: string | null;\n  country?: string | null;\n}\n\nconst emptyForm: Omit<Nanny, 'id' | 'assignedChildren'> & { email?: string; password?: string } = {\n  name: '',\n  availability: 'Disponible',\n  // keep runtime empty so placeholder shows; cast to satisfy TS (Nanny.experience is number)\n  experience: '' as unknown as number,\n  specializations: [],\n  status: 'Disponible',\n  contact: '',\n  email: '',\n  password: '',\n  birthDate: undefined,\n  address: '',\n  postalCode: '',\n  city: '',\n  region: '',\n  country: '',\n};\n\nexport default function Nannies() {\n  const { t } = useI18n();\n  const { user } = useAuth();\n  const [isShortLandscape, setIsShortLandscape] = useState(false);\n  useEffect(() => {\n    if (typeof window === 'undefined' || typeof window.matchMedia !== 'function') return;\n    const mql = window.matchMedia('(max-height: 600px) and (orientation: landscape)');\n    const onChange = () => setIsShortLandscape(Boolean(mql.matches));\n    onChange();\n    if (typeof mql.addEventListener === 'function') mql.addEventListener('change', onChange); else mql.addListener(onChange);\n    window.addEventListener('resize', onChange);\n    window.addEventListener('orientationchange', onChange);\n    return () => { try { if (typeof mql.removeEventListener === 'function') mql.removeEventListener('change', onChange); else mql.removeListener(onChange); } catch { /* ignore */ } window.removeEventListener('resize', onChange); window.removeEventListener('orientationchange', onChange); };\n  }, []);\n  const [nannies, setNannies] = useState<Nanny[]>([]);\n  const [cotisationStatus, setCotisationStatus] = useState<Record<string, { paidUntil: string | null; loading: boolean }>>({});\n  const [cotisationAmounts, setCotisationAmounts] = useState<Record<string, number>>({});\n  const [cotisationParentsTotals, setCotisationParentsTotals] = useState<Record<string, number>>({});\n  interface Assignment {\n    id: string;\n    date: string;\n    nanny: Nanny;\n    child: Child;\n  }\n  \n    const [assignments, setAssignments] = useState<Assignment[]>([]); \n  const [loading, setLoading] = useState(true);\n  const [form, setForm] = useState(emptyForm);\n  // --- geodata/autocomplete (copied from ParentDashboard/RegisterPage)\n  type GeodataPlace = { house_number?: string | null; street?: string | null; city?: string | null; state?: string | null; country?: string | null; postcode?: string | null; name?: string };\n  const [placeSuggestions, setPlaceSuggestions] = useState<GeodataPlace[]>([]);\n  const [openAddress, setOpenAddress] = useState(false);\n  const [rateLimitedUntil, setRateLimitedUntil] = useState<number | null>(null);\n  const searchTimer = React.useRef<number | null>(null);\n\n  const fetchGeodata = React.useCallback(async (query: string) => {\n    if (rateLimitedUntil && Date.now() < rateLimitedUntil) return;\n    if (!query || query.length < 3) { setPlaceSuggestions([]); return; }\n    try {\n      const res = await fetch(`/api/geodata/positionstack?q=${encodeURIComponent(query)}&limit=12`);\n      if (res.status === 422) {\n        setPlaceSuggestions([]);\n        return;\n      }\n      if (res.status === 429) {\n        const cooldownMs = 60_000;\n        setRateLimitedUntil(Date.now() + cooldownMs);\n        setPlaceSuggestions([]);\n        return;\n      }\n      if (!res.ok) { setPlaceSuggestions([]); return; }\n      const data = (await res.json()) as GeodataPlace[];\n      const arr = data || [];\n      const addresses = arr.filter((p) => !!(p.house_number || p.street));\n      setPlaceSuggestions(addresses);\n    } catch (err) {\n      console.error('geodata fetch error', err);\n      setPlaceSuggestions([]);\n    }\n  }, [rateLimitedUntil]);\n\n  React.useEffect(() => {\n    const q = (form.address || form.city || '').trim();\n    if (searchTimer.current) window.clearTimeout(searchTimer.current);\n    searchTimer.current = window.setTimeout(() => {\n      const bias = form.city ? ` ${form.city}` : '';\n      fetchGeodata(`${q}${bias}`.trim());\n    }, 600);\n    return () => { if (searchTimer.current) window.clearTimeout(searchTimer.current); };\n  }, [form.address, form.city, fetchGeodata]);\n\n  React.useEffect(() => {\n    const onDocClick = (e: MouseEvent) => {\n      const target = e.target as Node;\n      if (!target) return;\n      const addrEl = document.querySelector('#nanny-form-address');\n      if (addrEl && addrEl.contains(target)) return;\n      setOpenAddress(false);\n    };\n    document.addEventListener('click', onDocClick);\n    return () => document.removeEventListener('click', onDocClick);\n  }, []);\n\n  const selectPlace = (p: GeodataPlace) => {\n    const house = p.house_number ? String(p.house_number).trim() : '';\n    const road = p.street ? String(p.street).trim() : '';\n    const streetPart = (house ? `${house} ${road}`.trim() : (road || ''));\n    const displayStreet = streetPart || p.name || '';\n    const userTyped = String(form.address || '').trim();\n    let composed = displayStreet;\n    if (!house) {\n      const m = userTyped.match(/^(\\d+)\\s+(.+)$/);\n      if (m && m[1]) {\n        const typedNum = m[1];\n        if (!displayStreet.startsWith(typedNum + ' ')) composed = `${typedNum} ${displayStreet}`.trim();\n      }\n    }\n    setForm({ ...form, address: composed, city: p.city || '', postalCode: p.postcode || '', region: p.state || '', country: p.country || '' });\n    setPlaceSuggestions([]);\n    setOpenAddress(false);\n  };\n  const [showPw, setShowPw] = useState(false);\n  const [birthInputType, setBirthInputType] = useState<'text' | 'date'>('text');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [adding, setAdding] = useState(false);\n  const formRef = useRef<HTMLFormElement | null>(null);\n  const [error, setError] = useState('');\n  const [planningNanny, setPlanningNanny] = useState<Nanny|null>(null);\n  const [search, setSearch] = useState('');\n  const [availabilityFilter, setAvailabilityFilter] = useState('');\n  const [experienceFilter, setExperienceFilter] = useState('');\n\n  const fetchCotisation = async (nannyId: string) => {\n    setCotisationStatus(s => ({ ...s, [nannyId]: { ...s[nannyId], loading: true } }));\n    try {\n      const res = await fetchWithRefresh(`${API_URL}/nannies/${nannyId}/cotisation`, { credentials: 'include' });\n      const data = await res.json();\n      setCotisationStatus(s => ({ ...s, [nannyId]: { paidUntil: data.cotisationPaidUntil, loading: false } }));\n      if (data.lastCotisationAmount) {\n        setCotisationAmounts(prev => ({ ...prev, [nannyId]: Number(data.lastCotisationAmount) }));\n      }\n    } catch {\n      setCotisationStatus(s => ({ ...s, [nannyId]: { paidUntil: null, loading: false } }));\n    }\n  };\n\n  const fetchParentsTotalForNanny = async (nannyId: string) => {\n    try {\n      const res = await fetchWithRefresh(`${API_URL}/nannies/${nannyId}/cotisation-total`, { credentials: 'include' });\n      if (!res.ok) return;\n      const data = await res.json();\n      if (data && typeof data.totalMonthly === 'number') {\n        setCotisationParentsTotals(prev => ({ ...prev, [nannyId]: Number(data.totalMonthly) }));\n      }\n    } catch {\n      // ignore\n    }\n  };\n\n  const [messages, setMessages] = useState<Record<string, { text: string; type: 'success' | 'error' } | null>>({});\n  const [confirmPayment, setConfirmPayment] = useState<{ nannyId: string; amount: number } | null>(null);\n  // Admin password-reset modal state\n  const [adminResetModal, setAdminResetModal] = useState<{ open: boolean; nannyId?: string; password?: string } | null>(null);\n  const [pendingSave, setPendingSave] = useState<{ payload: Partial<typeof emptyForm> & { experience?: number; newPassword?: string }; editingId?: string | null } | null>(null);\n\n  const payCotisation = async (nannyId: string, amount?: number) => {\n    setCotisationStatus(s => ({ ...s, [nannyId]: { ...s[nannyId], loading: true } }));\n    try {\n      const body = amount ? JSON.stringify({ amount }) : undefined;\n      const res = await fetchWithRefresh(`${API_URL}/nannies/${nannyId}/cotisation`, { method: 'PUT', credentials: 'include', headers: body ? { 'Content-Type': 'application/json' } : undefined, body });\n      const data = await res.json();\n      setCotisationStatus(s => ({ ...s, [nannyId]: { paidUntil: data.cotisationPaidUntil, loading: false } }));\n  setMessages(m => ({ ...m, [nannyId]: { text: t('nanny.payment.success'), type: 'success' } }));\n      if (data.lastCotisationAmount) setCotisationAmounts(prev => ({ ...prev, [nannyId]: Number(data.lastCotisationAmount) }));\n      setTimeout(() => setMessages(m => ({ ...m, [nannyId]: null })), 3000);\n      await fetchCotisation(nannyId);\n      } catch {\n      setCotisationStatus(s => ({ ...s, [nannyId]: { paidUntil: null, loading: false } }));\n  setMessages(m => ({ ...m, [nannyId]: { text: t('nanny.payment.error'), type: 'error' } }));\n      setTimeout(() => setMessages(m => ({ ...m, [nannyId]: null })), 4000);\n    }\n  };\n\n  const requestPay = (nannyId: string) => {\n    const amount = cotisationAmounts[nannyId] || 10;\n    setConfirmPayment({ nannyId, amount });\n  };\n\n  const confirmPay = async () => {\n    if (!confirmPayment) return;\n    const { nannyId, amount } = confirmPayment;\n    setConfirmPayment(null);\n    await payCotisation(nannyId, amount);\n  };\n\n  const fetchNannies = React.useCallback(() => {\n    setLoading(true);\n    const cacheKeyNannies = `${API_URL}/nannies`;\n    const cached = getCached<Nanny[]>(cacheKeyNannies);\n    if (cached) {\n      setNannies(cached);\n      const amounts: Record<string, number> = {};\n      cached.forEach(n => { amounts[n.id] = 10; fetchCotisation(n.id); fetchParentsTotalForNanny(n.id); });\n      setCotisationAmounts(amounts);\n      setLoading(false);\n      return;\n    }\n    fetchWithRefresh(`${API_URL}/nannies`, { credentials: 'include' })\n      .then(res => res.json())\n      .then((nannies: Nanny[]) => {\n  setNannies(nannies);\n  const amounts: Record<string, number> = {};\n  nannies.forEach(n => { amounts[n.id] = 10; fetchCotisation(n.id); fetchParentsTotalForNanny(n.id); });\n  setCotisationAmounts(amounts);\n  setCached(cacheKeyNannies, nannies);\n      })\n      .finally(() => setLoading(false));\n  }, []);\n\n  useEffect(() => {\n    fetchNannies();\n    fetchWithRefresh(`${API_URL}/assignments`, { credentials: 'include' })\n      .then(res => res.json())\n      .then(setAssignments);\n  }, [fetchNannies]);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n    setForm({ ...form, [e.target.name]: e.target.value });\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    if (form.password && form.password !== confirmPassword) {\n      setError('Les mots de passe ne correspondent pas');\n      return;\n    }\n    try {\n      const payload: Partial<typeof emptyForm> & { experience?: number; newPassword?: string } = {\n        ...form,\n        experience: Number(form.experience),\n      };\n      if (payload.birthDate === null || payload.birthDate === '') delete payload.birthDate;\n      if (!payload.email) delete payload.email;\n      const isAdmin = user && typeof user.role === 'string' && (user.role.toLowerCase() === 'admin' || user.role.toLowerCase().includes('super'));\n      if (!payload.password) delete payload.password;\n      const isEditingOwnNanny = editingId && user && (String(user.nannyId) === String(editingId));\n\n      if (editingId && (isAdmin || isEditingOwnNanny) && form.password) {\n        (payload as Partial<typeof emptyForm> & { newPassword?: string }).newPassword = form.password;\n        delete (payload as Partial<typeof emptyForm> & { password?: string }).password;\n\n        if (isAdmin && !isEditingOwnNanny) {\n          setPendingSave({ payload, editingId });\n          setAdminResetModal({ open: true, nannyId: editingId, password: form.password });\n          return;\n        }\n      } else {\n        if (!isAdmin && !isEditingOwnNanny) delete (payload as Partial<typeof emptyForm> & { newPassword?: string }).newPassword;\n      }\n\n      await performSave(payload, editingId);\n    } catch (err: unknown) {\n      if (err instanceof Error) {\n        setError(err.message);\n      } else {\n        setError('Erreur');\n      }\n    }\n  };\n\n  const performSave = async (payload: Partial<typeof emptyForm> & { experience?: number; newPassword?: string }, editingId?: string | null) => {\n    try {\n      const res = await fetchWithRefresh(editingId ? `${API_URL}/nannies/${editingId}` : `${API_URL}/nannies`, {\n        method: editingId ? 'PUT' : 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify(payload),\n      });\n      if (res.status === 402) {\n        try {\n          const body = await res.json().catch(() => ({}));\n          setError(body && body.error ? String(body.error) : 'Limite atteinte pour votre plan.');\n        } catch {\n          setError('Limite atteinte pour votre plan.');\n        }\n        return;\n      }\n      if (res.status === 409) {\n        try {\n          const body = await res.json().catch(() => ({}));\n          const msg = body && (body.message || body.error) ? String(body.message || body.error) : 'Un utilisateur avec cet email existe d√©j√†.';\n          setError(msg);\n        } catch {\n          setError('Un utilisateur avec cet email existe d√©j√†.');\n        }\n        return;\n      }\n      if (!res.ok) {\n        try {\n          const body = await res.json().catch(() => ({}));\n          const msg = body && (body.message || body.error) ? String(body.message || body.error) : 'Erreur lors de la sauvegarde';\n          setError(msg);\n        } catch {\n          setError('Erreur lors de la sauvegarde');\n        }\n        return;\n      }\n      setForm(emptyForm);\n      setConfirmPassword('');\n      setEditingId(null);\n      fetchNannies();\n      if (editingId) {\n        setMessages(m => ({ ...m, [editingId]: { text: 'Mise √† jour effectu√©e', type: 'success' } }));\n        setTimeout(() => setMessages(m => ({ ...m, [editingId]: null })), 3000);\n      }\n    } catch (err: unknown) {\n      if (err instanceof Error) {\n        setError(err.message);\n      } else {\n        setError('Erreur');\n      }\n    }\n  };\n\n  const confirmAdminReset = async () => {\n    if (!pendingSave) return;\n    await performSave(pendingSave.payload, pendingSave.editingId);\n    setPendingSave(null);\n    setAdminResetModal(null);\n  };\n\n  const cancelAdminReset = () => {\n    setPendingSave(null);\n    setAdminResetModal(null);\n  };\n\n  const handleEdit = (nanny: Nanny) => {\n    setForm({\n      name: nanny.name,\n      availability: nanny.availability,\n      experience: nanny.experience,\n      specializations: nanny.specializations || [],\n      status: nanny.status || 'Disponible',\n      contact: nanny.contact,\n      email: nanny.email,\n      birthDate: nanny.birthDate,\n      address: nanny.address || '',\n      postalCode: nanny.postalCode || '',\n      city: nanny.city || '',\n      region: nanny.region || '',\n      country: nanny.country || '',\n      password: '',\n    });\n    setEditingId(nanny.id);\n    setAdding(false);\n    setConfirmPassword('');\n    setShowPw(false);\n    // scroll to the form so the user doesn't have to manually scroll\n    // timeout lets React render the form before we attempt to scroll\n    setTimeout(() => {\n      if (formRef.current) {\n        formRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        // small offset so form header isn't flush to top (optional)\n        window.scrollBy({ top: -12, left: 0, behavior: 'smooth' });\n        const firstInput = formRef.current.querySelector<HTMLInputElement>('input[name=\"name\"]');\n        firstInput?.focus();\n      }\n    }, 80);\n  };\n\n  const [deleteId, setDeleteId] = useState<string|null>(null);\n  const handleDelete = async () => {\n    if (!deleteId) return;\n    try {\n      const res = await fetchWithRefresh(`${API_URL}/nannies/${deleteId}`, {\n        method: 'DELETE',\n        credentials: 'include',\n      });\n      if (!res.ok) throw new Error('Erreur lors de la suppression');\n      setDeleteId(null);\n      fetchNannies();\n    } catch (err: unknown) {\n      if (err instanceof Error) {\n        setError(err.message);\n      } else {\n        setError('Erreur');\n      }\n    }\n  };\n\n  // Determine visible nannies depending on role: admins see all, nannies see their own card and any nanny who shares children\n  const isNannyUser = user && typeof user.role === 'string' && user.role.toLowerCase() === 'nanny';\n  const isAdmin = user && typeof user.role === 'string' && (user.role.toLowerCase().includes('admin') || user.role.toLowerCase().includes('super'));\n  const visibleNannies = React.useMemo(() => {\n    if (!isNannyUser) return nannies;\n    const meId = user && (user.nannyId || user.id);\n    if (!meId) return [];\n  // Children assigned to me\n  const myChildIds = new Set(assignments.filter(a => a.nanny && String(a.nanny.id) === String(meId)).map(a => a.child.id));\n  // Nanny IDs assigned to any of my children\n  const relatedNannyIds = new Set(assignments.filter(a => myChildIds.has(a.child.id)).map(a => a.nanny.id));\n  relatedNannyIds.add(meId);\n  return nannies.filter(n => relatedNannyIds.has(n.id));\n  }, [nannies, assignments, user, isNannyUser]);\n\n  const totalNannies = visibleNannies.length;\n  const availableToday = visibleNannies.filter(n => n.availability === 'Disponible').length;\n  const onLeave = visibleNannies.filter(n => n.availability === 'En_cong√©' || n.availability === 'En cong√©').length;\n\n  const filtered = nannies.filter(n =>\n    (!search || n.name.toLowerCase().includes(search.toLowerCase())) &&\n    (!availabilityFilter ||\n      (availabilityFilter === 'Disponible' && n.availability === 'Disponible') ||\n      (availabilityFilter === 'En cong√©' && (n.availability === 'En_cong√©' || n.availability === 'En cong√©')) ||\n      availabilityFilter === '') &&\n    (!experienceFilter || (experienceFilter === 'junior' ? n.experience < 3 : n.experience >= 3))\n  );\n\n  // remove desktop left padding when device is short landscape so page occupies full width\n  return (\n    <div className={`min-h-screen bg-[#fcfcff] p-2 sm:p-4 ${!isShortLandscape ? 'md:pl-64' : ''} w-full`}>\n      <div className=\"max-w-7xl mx-auto w-full px-0 sm:px-2 md:px-4\">\n        <div className=\"flex flex-col md:flex-row md:items-center gap-4 mb-6 w-full\">\n          <div>\n            <h1 className=\"text-2xl md:text-3xl font-extrabold mb-1 tracking-tight\" style={{ color: '#0b5566' }}>{t('page.nannies')}</h1>\n            <div className=\"text-base md:text-lg font-medium mb-4 md:mb-6\" style={{ color: '#08323a' }}>{t('page.nannies.description')}</div>\n          </div>\n          <div className=\"flex gap-2 items-center self-start md:ml-auto\">\n            {(user && typeof user.role === 'string' && (user.role.toLowerCase().includes('admin') || user.role.toLowerCase().includes('super'))) && (\n                <button\n                type=\"button\"\n                onClick={() => { setForm(emptyForm); setEditingId(null); setAdding(true); }}\n                className={`bg-[#0b5566] text-white font-semibold rounded-lg px-5 py-2 text-base shadow hover:bg-[#08323a] transition min-h-[44px] md:h-[60px] ${isShortLandscape ? '-translate-x-3' : ''}`}\n                style={{transform: isShortLandscape ? 'translateX(-12px)' : undefined}}\n              >\n                {t('nanny.add')}\n              </button>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex flex-col md:flex-row md:items-center gap-4 mb-6 w-full lg:flex-row lg:items-center lg:gap-4 lg:mb-6 lg:w-full md:max-w-md md:w-full\">\n          \n          <div className=\"flex gap-2 flex-wrap justify-start w-full\">\n            <div className=\"bg-white rounded-xl shadow px-3 md:px-4 py-2 flex flex-col items-center min-w-[80px] md:min-w-[90px] min-h-[44px] md:h-auto\">\n              <div className=\"text-xs text-gray-400\">{t('stats.total')}</div>\n              <div className=\"text-base md:text-lg font-bold text-[#0b5566]\">{totalNannies}</div>\n            </div>\n            <div className=\"bg-white rounded-xl shadow px-3 md:px-4 py-2 flex flex-col items-center min-w-[80px] md:min-w-[90px] min-h-[44px] md:h-auto\">\n              <div className=\"text-xs text-gray-400\">{t('nanny.available_label')}</div>\n              <div className=\"text-base md:text-lg font-bold text-[#0b5566]\">{availableToday}</div>\n            </div>\n            <div className=\"bg-white rounded-xl shadow px-3 md:px-4 py-2 flex flex-col items-center min-w-[80px] md:min-w-[90px] min-h-[44px] md:h-auto\">\n              <div className=\"text-xs text-gray-400\">{t('nanny.on_leave_label')}</div>\n              <div className=\"text-base md:text-lg font-bold text-[#0b5566]\">{onLeave}</div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col md:flex-row md:items-center gap-2 md:gap-3 mb-6 w-full filter-responsive\">\n          <input type=\"text\" value={search} onChange={e => setSearch(e.target.value)} placeholder={t('nanny.search_placeholder')} className=\"border border-gray-200 rounded-lg px-3 py-2 text-gray-700 bg-white shadow-sm text-base w-full md:w-64\" />\n          <select value={availabilityFilter} onChange={e => setAvailabilityFilter(e.target.value)} className=\"border rounded px-3 py-2 text-xs md:text-base bg-white text-gray-700 shadow-sm w-full md:w-auto\">\n            <option value=\"\">{t('nanny.filter.any')}</option>\n            <option value=\"Disponible\">{t('nanny.filter.disponible')}</option>\n            <option value=\"En cong√©\">{t('nanny.filter.en_conge')}</option>\n          </select>\n          <select value={experienceFilter} onChange={e => setExperienceFilter(e.target.value)} className=\"border border-gray-200 rounded-lg px-3 py-2 bg-white text-gray-700 shadow-sm text-xs md:text-base w-full md:w-auto\">\n            <option value=\"\">{t('nanny.filter.experience_any')}</option>\n            <option value=\"junior\">{t('nanny.filter.experience_junior')}</option>\n            <option value=\"senior\">{t('nanny.filter.experience_senior')}</option>\n          </select>\n          <div className=\"flex-1\"></div>\n        </div>\n\n        {(adding || editingId) && (\n          <form ref={formRef} onSubmit={handleSubmit} className=\"mb-6 bg-white rounded-2xl shadow p-4 md:p-6 grid gap-4 md:grid-cols-3 lg:grid-cols-3\">\n            {/* Shared input class ensures consistent widths and appearance */}\n            <input name=\"name\" value={form.name} onChange={handleChange} placeholder={t('nanny.form.name')} required className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n            <select name=\"availability\" value={form.availability} onChange={handleChange} required className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\">\n              <option value=\"Disponible\">{t('nanny.availability.available')}</option>\n              <option value=\"En_cong√©\">{t('nanny.availability.on_leave')}</option>\n              <option value=\"Maladie\">{t('nanny.availability.sick')}</option>\n            </select>\n              <div id=\"nanny-form-address\" className=\"md:col-span-2\">\n                <label className=\"block text-left font-medium text-[#08323a]\">\n                  <div className=\"relative\">\n                    <input name=\"address\" value={form.address || ''} onChange={(e) => setForm({ ...form, address: e.target.value })} placeholder={t('parent.form.address')} className=\"mt-1 h-11 w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" onFocus={() => setOpenAddress(true)} />\n                    {openAddress && placeSuggestions.length > 0 && (\n                      <ul className=\"absolute z-20 left-0 right-0 bg-white border mt-1 max-h-56 overflow-auto rounded shadow\">\n                        {placeSuggestions.map((p, idx) => {\n                          const summary = [p.house_number && `${p.house_number} ${p.street}`, p.street || p.name, p.postcode, p.state, p.country].filter(Boolean).join(', ');\n                          const label = p.name || (p.house_number ? `${p.house_number} ${p.street}` : p.street || '');\n                          return (\n                            <li key={idx} role=\"button\" tabIndex={0} onClick={() => { selectPlace(p); }} className=\"px-3 py-2 hover:bg-gray-100 cursor-pointer\">\n                              <div className=\"text-sm font-medium\">{label}</div>\n                              <div className=\"text-xs text-gray-500\">{summary}</div>\n                            </li>\n                          );\n                        })}\n                      </ul>\n                    )}\n                  </div>\n                </label>\n              </div>\n              <label className=\"block text-left font-medium\">\n                <span className=\"sr-only\">{t('parent.form.postalCode')}</span>\n                <input name=\"postalCode\" value={form.postalCode || ''} onChange={(e) => setForm({ ...form, postalCode: e.target.value })} placeholder={t('parent.form.postalCode')} className=\"mt-1 h-11 w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n              </label>\n              <input name=\"city\" value={form.city || ''} onChange={(e) => setForm({ ...form, city: e.target.value })} placeholder={t('parent.form.city')} className=\"h-11 w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n              <input name=\"region\" value={form.region || ''} onChange={(e) => setForm({ ...form, region: e.target.value })} placeholder={t('parent.form.region') || 'R√©gion'} className=\"h-11 w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n              <input name=\"country\" value={form.country || ''} onChange={(e) => setForm({ ...form, country: e.target.value })} placeholder={t('parent.form.country') || 'Pays'} className=\"h-11 w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n            <input name=\"experience\" type=\"number\" value={form.experience || ''} onChange={handleChange} placeholder={t('nanny.form.experience') || 'Exp√©rience'} required className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n            {/* Display formatted dd/mm/yyyy when not editing; keep ISO value for type=date */}\n            <input\n              name=\"birthDate\"\n              type={birthInputType}\n              value={birthInputType === 'date' ? (form.birthDate || '') : (form.birthDate ? ((): string => {\n                // robustly format any parsable date as DD/MM/YYYY\n                try {\n                  const d = new Date(String(form.birthDate));\n                  if (!isNaN(d.getTime())) {\n                    const dd = String(d.getDate()).padStart(2, '0');\n                    const mm = String(d.getMonth() + 1).padStart(2, '0');\n                    const yyyy = String(d.getFullYear());\n                    return `${dd}/${mm}/${yyyy}`;\n                  }\n                } catch (e) {\n                  void e;\n                }\n                return String(form.birthDate);\n              })() : '')}\n              onChange={handleChange}\n              placeholder={t('nanny.form.birthDate') || 'Date de naissance'}\n              className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\"\n              onFocus={() => setBirthInputType('date')}\n              onBlur={() => setBirthInputType('text')}\n              readOnly={birthInputType === 'text'}\n            />\n            <input name=\"specializations\" value={form.specializations?.join(', ')} onChange={e => setForm({ ...form, specializations: e.target.value.split(',').map(s => s.trim()) })} placeholder={t('nanny.form.specializations')} className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base md:col-span-2 focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n            <input name=\"contact\" type=\"tel\" value={form.contact || ''} onChange={handleChange} placeholder={t('nanny.form.contact')} className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n            <input name=\"email\" type=\"email\" value={form.email || ''} onChange={handleChange} placeholder={t('nanny.form.email')} className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n            <div className=\"relative md:col-span-1\">\n              <input name=\"password\" autoComplete=\"new-password\" type={showPw ? \"text\" : \"password\"} value={form.password || ''} onChange={handleChange} placeholder={t('nanny.form.password')} className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base pr-10 focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n              <button type=\"button\" tabIndex={-1} className=\"absolute right-2 top-2 text-gray-400 hover:text-gray-700\" onClick={() => setShowPw(v => !v)}>{showPw ? \"üôà\" : \"üëÅÔ∏è\"}</button>\n            </div>\n            <div className=\"relative md:col-span-1\">\n              <input name=\"confirmPassword\" autoComplete=\"new-password\" type={showPw ? \"text\" : \"password\"} value={confirmPassword} onChange={e => setConfirmPassword(e.target.value)} placeholder={t('nanny.form.confirmPassword')} className=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-base pr-10 focus:outline-none focus:ring-2 focus:ring-[#a9ddf2]\" />\n              <button type=\"button\" tabIndex={-1} className=\"absolute right-2 top-2 text-gray-400 hover:text-gray-700\" onClick={() => setShowPw(v => !v)}>{showPw ? \"üôà\" : \"üëÅÔ∏è\"}</button>\n            </div>\n            <div className=\"md:col-span-2 flex gap-2\">\n              <button type=\"submit\" className=\"bg-[#0b5566] text-white px-4 py-2 rounded hover:bg-[#08323a] transition\">\n                {editingId ? t('global.save') : t('global.add')}\n              </button>\n              <button type=\"button\" onClick={() => { setForm(emptyForm); setConfirmPassword(''); setEditingId(null); setAdding(false); }} className=\"bg-gray-300 px-4 py-2 rounded\">{t('global.cancel')}</button>\n            </div>\n            {error && <div className=\"text-red-600 md:col-span-2\">{error}</div>}\n          </form>\n        )}\n\n        {loading ? (\n          <div>Chargement...</div>\n        ) : (\n          <div className=\"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 w-full children-responsive-grid\">\n            {filtered\n              .filter(n => visibleNannies.some(v => String(v.id) === String(n.id)))\n              .map((nanny, idx) => {\n              const cotisation = cotisationStatus[nanny.id];\n              const daysRemaining = cotisation && cotisation.paidUntil ? Math.max(0, Math.ceil((new Date(cotisation.paidUntil).getTime() - Date.now()) / (1000 * 60 * 60 * 24))) : 0;\n              const cardColors = [\n                'bg-blue-50',\n                'bg-yellow-50',\n                'bg-purple-50',\n                'bg-green-50',\n                'bg-pink-50',\n                'bg-orange-50',\n              ];\n              const color = cardColors[idx % cardColors.length];\n              const isDeleting = deleteId === nanny.id;\n              const todayStr = new Date().toISOString().split('T')[0];\n              const assignedTodayCount = assignments.filter(a => a.nanny && a.nanny.id === nanny.id && a.date.split('T')[0] === todayStr).length;\n              const isPaymentModalOpen = confirmPayment?.nannyId === nanny.id;\n              // Normalize availability and compute label + classes for colored pill\n              const _availRaw = String(nanny.availability || '').toLowerCase();\n              const availabilityLabel = (nanny.availability === 'En_cong√©' || nanny.availability === 'En cong√©')\n                ? t('nanny.availability.on_leave')\n                : (nanny.availability === 'Disponible' ? t('nanny.availability.available') : t('nanny.availability.sick'));\n              let availabilityClasses = 'px-2 py-1 rounded-full text-xs font-medium ';\n              if (_availRaw.includes('dispon')) {\n                availabilityClasses += 'bg-green-100 text-green-800 border border-green-200';\n              } else if (_availRaw.includes('malad') || _availRaw.includes('cong')) {\n                availabilityClasses += 'bg-red-100 text-red-700 border border-red-200';\n              } else {\n                availabilityClasses += 'bg-white border border-gray-200 text-gray-600';\n              }\n              return (\n                <div\n                  key={nanny.id}\n                  className={`rounded-2xl shadow ${color} relative flex flex-col min-h-[440px] h-full transition-transform duration-500 perspective-1000 overflow-hidden`}\n                  style={{ height: '100%', perspective: '1000px' }}\n                >\n                  {/* availability badge moved into header below name */}\n                  <div\n                    className={`w-full h-full transition-transform duration-500 ${isDeleting ? 'rotate-y-180' : ''}`}\n                    style={{ transformStyle: 'preserve-3d', position: 'relative', width: '100%', height: '100%' }}\n                  >\n                    <div\n                      className={`absolute inset-0 w-full h-full p-3 sm:p-4 md:p-6 flex flex-col items-center ${isDeleting ? 'opacity-0 pointer-events-none' : 'opacity-100'} bg-transparent`}\n                      style={{ backfaceVisibility: 'hidden' }}\n                    >\n                        <div className=\"w-full pt-2 sm:pt-3 text-center\">\n                          <div className=\"flex items-center justify-center\">\n                            <h3 className=\"font-semibold text-lg sm:text-xl text-[#08323a] truncate max-w-[220px] -mt-1 -translate-y-0.5\" title={nanny.name} style={{transform: 'translateY(-2px)'}}>{nanny.name}</h3>\n                          </div>\n                          <div className=\"mt-2 flex items-center justify-center gap-4 text-sm text-gray-600\">\n                            <span className={availabilityClasses}>\n                              {availabilityLabel}\n                            </span>\n                            <span className=\"px-2 py-1 rounded-full bg-white border border-gray-200 text-xs font-medium\">{`${nanny.experience} ${nanny.experience === 1 ? 'an' : 'ans'} exp`}</span>\n                            {nanny.birthDate ? (\n                              <span className=\"text-xs font-medium px-2 py-1 rounded-full bg-green-100 text-green-700 whitespace-nowrap\" title={t('label.birthDate')}>\n                                üéÇ {new Date(nanny.birthDate).toLocaleDateString('fr-FR')}\n                              </span>\n                            ) : (\n                              <span className=\"text-xs font-medium px-2 py-1 rounded-full bg-gray-100 text-gray-600 whitespace-nowrap\" title={t('label.birthDate')}>\n                                üéÇ {t('children.birthDate.undefined')}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                      {/* birthday now shown in header pill; detailed date removed to avoid duplication */}\n                      <div className=\"mt-4 flex flex-col gap-2 sm:gap-3 text-xs sm:text-sm text-gray-700 mb-3 sm:mb-4\">\n                        <span className=\"flex items-start gap-2 w-full justify-start\">\n                          <span aria-hidden className={`inline-block ${nanny.address ? '' : 'text-gray-300'}`}>üìç</span>\n                          <div className=\"leading-snug\">\n                            {nanny.address ? <div className=\"truncate\">{nanny.address}</div> : <div className=\"text-gray-300\">‚Äî</div>}\n                            {(nanny.postalCode || nanny.city) ? <div className=\"truncate\">{[nanny.postalCode, nanny.city].filter(Boolean).join(' ')}</div> : <div className=\"text-gray-300\">‚Äî</div>}\n                          </div>\n                        </span>\n                        <span className=\"flex items-center gap-2 w-full justify-start\">\n                          <span className=\"w-5 text-center text-sm sm:text-base\" role=\"img\" aria-label=\"Email\">‚úâÔ∏è</span>\n                          {nanny.email ? (\n                            <a href={`mailto:${nanny.email}`} className=\"text-blue-700 underline text-xs sm:text-sm break-words max-w-full sm:max-w-none\" aria-label={`Envoyer un mail √† ${nanny.name}`}>{nanny.email}</a>\n                          ) : (\n                            <span className=\"text-gray-400 text-xs sm:text-sm\">‚Äî</span>\n                          )}\n                        </span>\n                        <span className=\"flex items-center gap-2 w-full justify-start\">\n                          <span aria-hidden className={`inline-block ${nanny.contact ? '' : 'text-gray-300'}`}>üìû</span>\n                          {nanny.contact ? (\n                            <a href={`tel:${nanny.contact}`} className=\"text-blue-700 underline text-xs sm:text-sm break-words max-w-full sm:max-w-none\" aria-label={`Appeler ${nanny.name}`}>{nanny.contact}</a>\n                          ) : (\n                            <span className=\"text-gray-400 text-xs sm:text-sm\">‚Äî</span>\n                          )}\n                        </span>\n                      </div>\n                      {nanny.specializations && nanny.specializations.length > 0 && (\n                        <div className=\"flex flex-wrap justify-center gap-1 sm:gap-2 mb-2 w-full px-2 sm:px-4\">\n                          {nanny.specializations.map((spec, i) => (\n                            <span key={i} className=\"bg-purple-100 text-purple-700 px-1 sm:px-2 py-1 rounded-full text-xs font-semibold border border-purple-200 truncate max-w-[80px] sm:max-w-none\">{spec}</span>\n                          ))}\n                        </div>\n                      )}\n                      <div className=\"text-xs sm:text-sm text-gray-700 mb-2 w-full flex flex-col items-center\">\n                        <span className=\"block font-medium mb-1 text-center\">\n                          {t('nanny.assignments_today')}\n                          <span className=\"inline-block bg-white text-gray-700 px-2 py-0.5 rounded-full text-xs font-semibold border border-gray-200 ml-1\">\n                            {assignedTodayCount}\n                          </span>\n                        </span>\n                      </div>\n                      <div className=\"flex flex-col gap-2 mt-auto mb-4 w-full min-w-0 items-center\">\n                        <div className=\"flex flex-col items-center\">\n                          <span className=\"text-xs font-semibold text-gray-700\">{t('nanny.cotisation.label')}</span>\n                          <div className=\"flex items-center gap-2 mt-1\">\n                            <div className=\"flex items-center gap-2\">\n                              {cotisation?.loading ? (\n                                <span className=\"text-sm text-gray-500\">{t('loading')}</span>\n                              ) : daysRemaining > 0 ? (\n                                <span className=\"text-base font-bold text-[#08323a]\">{(cotisationAmounts[nanny.id] ?? 10)}‚Ç¨</span>\n                              ) : isAdmin ? (\n                                <input\n                                  type=\"number\"\n                                  className=\"w-20 px-2 py-1 border rounded text-sm\"\n                                  value={cotisationAmounts[nanny.id] ?? 10}\n                                  onChange={(e) => setCotisationAmounts(prev => ({ ...prev, [nanny.id]: Number(e.target.value) }))}\n                                />\n                              ) : (\n                                <span className=\"text-base font-bold text-[#08323a]\">10‚Ç¨</span>\n                              )}\n\n                              {cotisation?.loading ? (\n                                <span className=\"text-gray-400 text-xl\">‚Ä¶</span>\n                              ) : daysRemaining > 0 ? (\n                                <span className=\"text-[#0b5566] text-xl\">‚úîÔ∏è</span>\n                              ) : (\n                                <span className=\"text-red-500 text-xl\">‚ùå</span>\n                              )}\n                            </div>\n\n                            {/* Pay button placed to the right of the amount/input and status icon */}\n                            {daysRemaining <= 0 && isAdmin && (\n                              <button\n                                className=\"ml-2 text-[#0b5566] text-xs font-semibold px-3 py-1 rounded bg-[#a9ddf2] hover:bg-[#f7f4d7] transition disabled:opacity-50 disabled:cursor-not-allowed\"\n                                disabled={cotisation?.loading || isPaymentModalOpen}\n                                onClick={() => requestPay(nanny.id)}\n                              >\n                                {cotisation?.loading ? t('nanny.payment.loading') : isPaymentModalOpen ? t('nanny.payment.confirming') : t('nanny.payment.pay')}\n                              </button>\n                            )}\n                          </div>\n\n                          <span className=\"text-xs text-gray-500 text-center mt-1\">\n                            {cotisation ? (\n                              cotisation.loading ? t('loading') : (\n                                cotisation.paidUntil ? (daysRemaining > 0 ? t('nanny.cotisation.days_remaining', { n: String(daysRemaining) }) : t('nanny.cotisation.renew')) : t('nanny.cotisation.renew')\n                              )\n                            ) : '‚Äî'}\n                          </span>\n\n                          {/* Total monthly contributions from assigned parents */}\n                          <div className=\"text-xs text-gray-600 text-center mt-2\">\n                            <span className=\"block font-medium\">{t('nanny.cotisation.total_parents') || 'Cotisation totale mensuelle des parents'}&nbsp;</span>\n                            <span className=\"text-base font-bold text-[#08323a]\">{(cotisationParentsTotals[nanny.id] ?? 0)}‚Ç¨</span>\n                          </div>\n\n                          {daysRemaining <= 0 && messages[nanny.id] && (\n                            <div className={`mt-1 text-xs ${messages[nanny.id]?.type === 'success' ? 'text-[#0b5566]' : 'text-red-600'}`}>\n                              {messages[nanny.id]?.text}\n                            </div>\n                          )}\n                        </div>\n\n                        <div className=\"flex items-center gap-2 mt-2\">\n                          <div className=\"flex gap-1\">\n                            <button\n                              onClick={() => setPlanningNanny(nanny)}\n                              className=\"bg-white border border-gray-200 text-gray-500 hover:text-[#08323a] rounded-full p-2 shadow-sm\"\n                              title={t('nanny.planning.button')}\n                              aria-label={t('nanny.planning.button') as string}\n                            >\n                              {/* Calendar icon */}\n                              <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-current\"><rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect><line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\"></line><line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\"></line><line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\"></line></svg>\n                            </button>\n                            <button\n                              onClick={() => handleEdit(nanny)}\n                              className=\"bg-white border border-gray-200 text-gray-500 hover:text-[#08323a] rounded-full p-2 shadow-sm\"\n                              title={t('children.action.edit')}\n                            >\n                              <svg width=\"18\" height=\"18\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" viewBox=\"0 0 24 24\"><path d=\"M15.232 5.232l3.536 3.536M9 13l6-6 3 3-6 6H9v-3z\"/></svg>\n                            </button>\n                            <button\n                                onClick={() => setDeleteId(nanny.id)}\n                                className=\"bg-white border border-gray-200 text-gray-500 hover:text-red-500 rounded-full p-2 shadow-sm\"\n                                title={t('children.action.delete')}\n                              >\n                              <svg width=\"18\" height=\"18\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" viewBox=\"0 0 24 24\"><path d=\"M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6M1 7h22M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/></svg>\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                    <div\n                      className={`absolute inset-0 w-full h-full flex flex-col items-center justify-center bg-white rounded-2xl shadow-xl p-8 ${isDeleting ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}\n                      style={{ backfaceVisibility: 'hidden', transform: 'rotateY(180deg)' }}\n                    >\n                      <div className=\"text-red-500 text-4xl mb-2\">üóëÔ∏è</div>\n                      <div className=\"text-lg font-semibold mb-2 text-gray-900 text-center\">{t('modal.delete.title')}</div>\n                      <div className=\"text-gray-500 mb-6 text-center\">{t('nanny.delete.confirm_body')}</div>\n                      <div className=\"flex gap-3 w-full\">\n                        <button\n                          onClick={() => setDeleteId(null)}\n                          className=\"flex-1 bg-gray-100 text-gray-700 rounded-lg px-4 py-2 font-medium hover:bg-gray-200 transition\"\n                        >{t('modal.cancel')}</button>\n                        <button\n                          onClick={handleDelete}\n                          className=\"flex-1 bg-red-500 text-white rounded-lg px-4 py-2 font-medium hover:bg-red-600 transition shadow\"\n                        >{t('children.action.delete')}</button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n      {confirmPayment && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm\">\n          <div className=\"bg-white rounded-2xl shadow-xl p-6 w-full max-w-md\">\n            <h3 className=\"text-lg font-bold mb-2\">{t('nanny.payment.confirm_title')}</h3>\n            <p className=\"mb-4\">{t('nanny.payment.confirm_body', { amount: String(confirmPayment.amount) })}</p>\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setConfirmPayment(null)}\n                className=\"flex-1 bg-gray-100 text-gray-700 rounded-lg px-4 py-2\"\n              >{t('modal.cancel')}</button>\n              <button\n                onClick={confirmPay}\n                className=\"flex-1 bg-blue-600 text-white rounded-lg px-4 py-2\"\n              >{t('common.confirm')}</button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {planningNanny && (\n        <PlanningModal nanny={planningNanny} onClose={() => setPlanningNanny(null)} />\n      )}\n      {/* Admin password reset confirmation modal */}\n      {adminResetModal && adminResetModal.open && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm\">\n          <div className=\"bg-white rounded-2xl shadow-xl p-6 w-full max-w-md\">\n            <h3 className=\"text-lg font-bold mb-2\">{t('parent.reset.confirm_title')}</h3>\n            <p className=\"mb-4\">{t('parent.reset.confirm_body')}</p>\n            <div className=\"flex gap-3\">\n              <button onClick={cancelAdminReset} className=\"flex-1 bg-gray-100 text-gray-700 rounded-lg px-4 py-2\">{t('modal.cancel')}</button>\n              <button onClick={confirmAdminReset} className=\"flex-1 bg-blue-600 text-white rounded-lg px-4 py-2\">{t('parent.reset.confirm')}</button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["API_URL","PlanningModal","nanny","onClose","t","useI18n","jsxs","jsx","NannyCalendar","emptyForm","Nannies","user","useAuth","isShortLandscape","setIsShortLandscape","useState","useEffect","mql","onChange","nannies","setNannies","cotisationStatus","setCotisationStatus","cotisationAmounts","setCotisationAmounts","cotisationParentsTotals","setCotisationParentsTotals","assignments","setAssignments","loading","setLoading","form","setForm","placeSuggestions","setPlaceSuggestions","openAddress","setOpenAddress","rateLimitedUntil","setRateLimitedUntil","searchTimer","React","fetchGeodata","query","res","addresses","p","err","q","bias","onDocClick","e","target","addrEl","selectPlace","house","road","displayStreet","userTyped","composed","m","typedNum","showPw","setShowPw","birthInputType","setBirthInputType","confirmPassword","setConfirmPassword","editingId","setEditingId","adding","setAdding","formRef","useRef","error","setError","planningNanny","setPlanningNanny","search","setSearch","availabilityFilter","setAvailabilityFilter","experienceFilter","setExperienceFilter","fetchCotisation","nannyId","data","fetchWithRefresh","s","prev","fetchParentsTotalForNanny","messages","setMessages","confirmPayment","setConfirmPayment","adminResetModal","setAdminResetModal","pendingSave","setPendingSave","payCotisation","amount","body","requestPay","confirmPay","fetchNannies","cacheKeyNannies","cached","getCached","amounts","n","setCached","handleChange","handleSubmit","payload","isAdmin","isEditingOwnNanny","performSave","msg","confirmAdminReset","cancelAdminReset","handleEdit","deleteId","setDeleteId","handleDelete","isNannyUser","visibleNannies","meId","myChildIds","a","relatedNannyIds","totalNannies","availableToday","onLeave","filtered","idx","summary","label","d","dd","mm","yyyy","v","cotisation","daysRemaining","cardColors","color","isDeleting","todayStr","assignedTodayCount","isPaymentModalOpen","_availRaw","availabilityLabel","availabilityClasses","spec","i"],"mappings":"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"}