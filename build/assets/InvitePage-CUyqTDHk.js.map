{"version":3,"file":"InvitePage-CUyqTDHk.js","sources":["../../pages/InvitePage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useSearchParams, useNavigate } from 'react-router-dom';\nimport { fetchWithRefresh } from '../utils/fetchWithRefresh';\n\nconst InvitePage: React.FC = () => {\n  const [searchParams] = useSearchParams();\n  const token = searchParams.get('token') || '';\n  const [password, setPassword] = useState('');\n  const [confirm, setConfirm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState<string | null>(null);\n  const navigate = useNavigate();\n  function getApiUrl(): string {\n  const meta = import.meta as { env?: { VITE_API_URL?: string } };\n  return meta?.env?.VITE_API_URL ?? 'https://www.lesfrimousses.com/api';\n  }\n  const API_URL = getApiUrl();\n\n  const submit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    if (!token) return setError(\"Lien d'invitation manquant\");\n    if (!password) return setError('Mot de passe requis');\n    if (password !== confirm) return setError('Les mots de passe ne correspondent pas');\n    try {\n  setLoading(true);\n  const res = await fetchWithRefresh(`${API_URL}/parent/accept-invite`, {\n        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ token, password })\n      });\n      const body = await res.json();\n      if (!res.ok) throw new Error(body?.message || body?.error || 'Erreur');\n      setSuccess('Mot de passe défini, vous pouvez maintenant vous connecter.');\n      setTimeout(() => navigate('/login'), 1500);\n    } catch (err: unknown) {\n      if (err instanceof Error) setError(err.message);\n      else setError('Erreur');\n    } finally { setLoading(false); }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 p-4\">\n      <div className=\"max-w-md w-full bg-white p-6 rounded shadow\">\n        <h2 className=\"text-xl font-semibold mb-4\">Invitation - définir votre mot de passe</h2>\n        {error && <div className=\"text-red-600 mb-2\">{error}</div>}\n        {success ? (\n          <div className=\"text-green-600\">{success}</div>\n        ) : (\n          <form onSubmit={submit} className=\"space-y-3\">\n            <div>\n              <label className=\"text-sm\">Mot de passe</label>\n              <input type=\"password\" value={password} onChange={e => setPassword(e.target.value)} className=\"w-full border rounded px-3 py-2\" />\n            </div>\n            <div>\n              <label className=\"text-sm\">Confirmer</label>\n              <input type=\"password\" value={confirm} onChange={e => setConfirm(e.target.value)} className=\"w-full border rounded px-3 py-2\" />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <button type=\"submit\" disabled={loading} className=\"bg-green-500 text-white px-4 py-2 rounded\">{loading ? 'Envoi...' : 'Valider'}</button>\n            </div>\n          </form>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default InvitePage;\n"],"names":["InvitePage","searchParams","useSearchParams","token","password","setPassword","useState","confirm","setConfirm","loading","setLoading","error","setError","success","setSuccess","navigate","useNavigate","getApiUrl","API_URL","submit","e","res","fetchWithRefresh","body","err","jsxs","jsx"],"mappings":"+DAIA,MAAMA,EAAuB,IAAM,CACjC,KAAM,CAACC,CAAY,EAAIC,EAAA,EACjBC,EAAQF,EAAa,IAAI,OAAO,GAAK,GACrC,CAACG,EAAUC,CAAW,EAAIC,EAAAA,SAAS,EAAE,EACrC,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAE,EACnC,CAACG,EAASC,CAAU,EAAIJ,EAAAA,SAAS,EAAK,EACtC,CAACK,EAAOC,CAAQ,EAAIN,EAAAA,SAAwB,IAAI,EAChD,CAACO,EAASC,CAAU,EAAIR,EAAAA,SAAwB,IAAI,EACpDS,EAAWC,EAAA,EACjB,SAASC,GAAoB,CAE7B,OADa,aACA,KAAK,cAAgB,mCAClC,CACA,MAAMC,EAAUD,EAAA,EAEVE,EAAS,MAAOC,GAAuB,CAG3C,GAFAA,EAAE,eAAA,EACFR,EAAS,IAAI,EACT,CAACT,EAAO,OAAOS,EAAS,4BAA4B,EACxD,GAAI,CAACR,EAAU,OAAOQ,EAAS,qBAAqB,EACpD,GAAIR,IAAaG,EAAS,OAAOK,EAAS,wCAAwC,EAClF,GAAI,CACNF,EAAW,EAAI,EACf,MAAMW,EAAM,MAAMC,EAAiB,GAAGJ,CAAO,wBAAyB,CAChE,OAAQ,OAAQ,QAAS,CAAE,eAAgB,kBAAA,EAAsB,KAAM,KAAK,UAAU,CAAE,MAAAf,EAAO,SAAAC,EAAU,CAAA,CAC1G,EACKmB,EAAO,MAAMF,EAAI,KAAA,EACvB,GAAI,CAACA,EAAI,GAAI,MAAM,IAAI,MAAME,GAAM,SAAWA,GAAM,OAAS,QAAQ,EACrET,EAAW,6DAA6D,EACxE,WAAW,IAAMC,EAAS,QAAQ,EAAG,IAAI,CAC3C,OAASS,EAAc,CACjBA,aAAe,MAAOZ,EAASY,EAAI,OAAO,IAChC,QAAQ,CACxB,QAAA,CAAYd,EAAW,EAAK,CAAG,CACjC,EAEA,aACG,MAAA,CAAI,UAAU,+DACb,SAAAe,EAAAA,KAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,6BAA6B,SAAA,0CAAuC,EACjFf,GAASe,EAAAA,IAAC,MAAA,CAAI,UAAU,oBAAqB,SAAAf,EAAM,EACnDE,EACCa,EAAAA,IAAC,MAAA,CAAI,UAAU,iBAAkB,SAAAb,CAAA,CAAQ,EAEzCY,EAAAA,KAAC,OAAA,CAAK,SAAUN,EAAQ,UAAU,YAChC,SAAA,CAAAM,OAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,QAAA,CAAM,UAAU,UAAU,SAAA,eAAY,EACvCA,EAAAA,IAAC,QAAA,CAAM,KAAK,WAAW,MAAOtB,EAAU,SAAUgB,GAAKf,EAAYe,EAAE,OAAO,KAAK,EAAG,UAAU,iCAAA,CAAkC,CAAA,EAClI,SACC,MAAA,CACC,SAAA,CAAAM,EAAAA,IAAC,QAAA,CAAM,UAAU,UAAU,SAAA,YAAS,EACpCA,EAAAA,IAAC,QAAA,CAAM,KAAK,WAAW,MAAOnB,EAAS,SAAUa,GAAKZ,EAAWY,EAAE,OAAO,KAAK,EAAG,UAAU,iCAAA,CAAkC,CAAA,EAChI,EACAM,MAAC,MAAA,CAAI,UAAU,oCACb,eAAC,SAAA,CAAO,KAAK,SAAS,SAAUjB,EAAS,UAAU,4CAA6C,SAAAA,EAAU,WAAa,UAAU,CAAA,CACnI,CAAA,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CACF,CAEJ"}