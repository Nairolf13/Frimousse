{"version":3,"file":"ReportsPage-CDswdsUx.js","sources":["../../pages/ReportsPage.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useI18n } from '../src/lib/useI18n';\nimport { useAuth } from '../src/context/AuthContext';\nimport Sidebar from '../components/Sidebar';\nimport { fetchWithRefresh } from '../utils/fetchWithRefresh';\nimport { getCached, setCached, DEFAULT_TTL } from '../src/utils/apiCache';\n\nconst API_URL = import.meta.env.VITE_API_URL;\n\nconst childGroups = [\n  { key: 'G1', label: 'children.group.G1' },\n  { key: 'G2', label: 'children.group.G2' },\n  { key: 'G3', label: 'children.group.G3' },\n  { key: 'G4', label: 'children.group.G4' },\n  { key: 'G5', label: 'children.group.G5' },\n  { key: 'G6', label: 'children.group.G6' },\n];\nconst nannyRoles = [\n  { key: 'Nounou_Senior', label: 'nanny.role.senior' },\n  { key: 'Responsable', label: 'nanny.role.manager' },\n  { key: 'Stagiaire', label: 'nanny.role.trainee' },\n  { key: 'Remplacante', label: 'nanny.role.substitute' },\n  { key: 'Autre', label: 'nanny.role.other' },\n];\n\ninterface Report {\n  id: string;\n  priority: string;\n  type: string;\n  status: string;\n  child: {\n    id: string;\n    name: string;\n    age: number;\n    group: string;\n    initials?: string;\n  };\n  nanny: {\n    id: string;\n    name: string;\n    role: string;\n    initials?: string;\n  };\n  summary: string;\n  details: string;\n  date: string;\n  time: string;\n  duration?: string;\n  childrenInvolved?: number;\n}\n\n\nconst priorityStyles = {\n  haute: 'bg-[#ffeaea] border-[#ffdddd]',\n  moyenne: 'bg-[#fff7e6] border-[#fff1d6]',\n  basse: 'bg-[#a9ddf2] border-[#cfeef9]',\n};\nconst priorityLabel = {\n  haute: 'reports.priority.haute',\n  moyenne: 'reports.priority.moyenne',\n  basse: 'reports.priority.basse',\n};\nconst typeLabel = {\n  incident: 'reports.type.incident',\n  comportement: 'reports.type.comportement',\n  soin: 'reports.type.soin',\n};\n\nexport default function ReportsPage() {\n\n  const { user } = useAuth();\n  const { t, locale } = useI18n();\n\n  useEffect(() => {\n    let mounted = true;\n    const cacheKeyChildren = `${API_URL}/children`;\n    const cacheKeyNannies = `${API_URL}/nannies`;\n    async function loadLists() {\n      try {\n        const cachedChildren = getCached<{id:string,name:string,age:number,group:string}[]>(cacheKeyChildren);\n        const cachedNannies = getCached<{id:string,name:string,role:string}[]>(cacheKeyNannies);\n        if (cachedChildren) setChildrenList(cachedChildren);\n        if (cachedNannies) setNanniesList(cachedNannies);\n\n        // Fetch in parallel but avoid overwriting already set state if unmounted\n        const promises: Promise<Response>[] = [];\n        if (!cachedChildren) promises.push(fetchWithRefresh(`${API_URL}/children`));\n        else promises.push(Promise.resolve(new Response(JSON.stringify(cachedChildren))));\n        if (!cachedNannies) promises.push(fetchWithRefresh(`${API_URL}/nannies`));\n        else promises.push(Promise.resolve(new Response(JSON.stringify(cachedNannies))));\n\n        const [childrenRes, nanniesRes] = await Promise.all(promises);\n        if (!mounted) return;\n        try {\n          const childrenData = await childrenRes.json();\n          setChildrenList(Array.isArray(childrenData) ? childrenData : []);\n          setCached(cacheKeyChildren, Array.isArray(childrenData) ? childrenData : [], DEFAULT_TTL);\n        } catch { setChildrenList([]); }\n        try {\n          const nanniesData = await nanniesRes.json();\n          setNanniesList(Array.isArray(nanniesData) ? nanniesData : []);\n          setCached(cacheKeyNannies, Array.isArray(nanniesData) ? nanniesData : [], DEFAULT_TTL);\n        } catch { setNanniesList([]); }\n      } catch {\n        if (mounted) { setChildrenList([]); setNanniesList([]); }\n      }\n    }\n    loadLists();\n    return () => { mounted = false; };\n  }, []);\n  const [reports, setReports] = useState<Report[]>([]);\n\n  useEffect(() => {\n    fetchWithRefresh(`${API_URL}/reports`)\n      .then(res => res.json())\n      .then(data => setReports(Array.isArray(data) ? data : []))\n      .catch(() => setReports([]));\n  }, []);\n  const total = reports.length;\n  const week = reports.filter(r => {\n    if (!r.date) return false;\n    const reportDate = new Date(r.date);\n    const now = new Date();\n    const startOfWeek = new Date(now);\n    startOfWeek.setHours(0,0,0,0);\n    startOfWeek.setDate(now.getDate() - ((now.getDay() + 6) % 7));\n    const endOfWeek = new Date(startOfWeek);\n    endOfWeek.setDate(startOfWeek.getDate() + 6);\n    return reportDate >= startOfWeek && reportDate <= endOfWeek;\n  }).length;\n\n  const [filterLast30Days, setFilterLast30Days] = useState(false);\n  const [filterType, setFilterType] = useState('');\n  const [searchText, setSearchText] = useState('');\n\n  const filteredReports = reports.filter(r => {\n    let ok = true;\n    if (filterLast30Days) {\n      if (!r.date) return false;\n      const reportDate = new Date(r.date);\n      const now = new Date();\n      const thirtyDaysAgo = new Date(now);\n      thirtyDaysAgo.setDate(now.getDate() - 30);\n      ok = ok && reportDate >= thirtyDaysAgo && reportDate <= now;\n    }\n    if (filterType) {\n      ok = ok && r.type === filterType;\n    }\n    if (searchText.trim()) {\n      const txt = searchText.trim().toLowerCase();\n      ok = ok && !!(\n        (r.child?.name && r.child.name.toLowerCase().includes(txt)) ||\n        (r.summary && r.summary.toLowerCase().includes(txt)) ||\n        (r.details && r.details.toLowerCase().includes(txt))\n      );\n    }\n    return ok;\n  });\n  const [modalOpen, setModalOpen] = useState(false);\n  const [editingReport, setEditingReport] = useState<Report | null>(null);\n  const [form, setForm] = useState({\n    priority: 'moyenne' as 'haute' | 'moyenne' | 'basse',\n    type: 'incident' as 'incident' | 'comportement' | 'soin',\n    status: 'en_attente' as 'en_attente' | 'traite' | 'resolu',\n    childId: '',\n    childName: '',\n    childAge: 3,\n    childGroup: '',\n    nannyId: '',\n    nannyName: '',\n    nannyRole: '',\n    summary: '',\n    details: '',\n    date: new Date().toISOString().split('T')[0],\n    time: '14:00',\n    duration: '',\n    childrenInvolved: '',\n  });\n\n  const [childrenList, setChildrenList] = useState<{id: string, name: string, age: number, group: string}[]>([]);\n  const [nanniesList, setNanniesList] = useState<{id: string, name: string, role: string}[]>([]);\n\n  // When a child is selected, prefer showing only the nannies assigned to that child\n  type ChildWithNannies = { id: string; name: string; age: number; group: string; nannyIds?: string[] };\n  const selectedChild = childrenList.find(c => c.id === form.childId) as ChildWithNannies | undefined;\n  const visibleNannies = (selectedChild && Array.isArray(selectedChild.nannyIds) && selectedChild.nannyIds.length > 0)\n    ? nanniesList.filter(n => selectedChild.nannyIds!.includes(n.id))\n    : nanniesList;\n\n  // If the currently selected nanny is no longer visible for the chosen child, clear it\n  useEffect(() => {\n    if (!form.nannyId) return;\n    const ok = visibleNannies.some(n => n.id === form.nannyId);\n    if (!ok) setForm(f => ({ ...f, nannyId: '', nannyName: '', nannyRole: '' }));\n  }, [form.childId, form.nannyId, visibleNannies]);\n\n  const [isShortLandscape, setIsShortLandscape] = useState(false);\n  useEffect(() => {\n    if (typeof window === 'undefined' || typeof window.matchMedia !== 'function') return;\n    const mql = window.matchMedia('(max-height: 600px) and (orientation: landscape)');\n    const onChange = () => setIsShortLandscape(Boolean(mql.matches));\n    onChange();\n    if (typeof mql.addEventListener === 'function') mql.addEventListener('change', onChange); else mql.addListener(onChange);\n    window.addEventListener('resize', onChange);\n    window.addEventListener('orientationchange', onChange);\n    return () => { try { if (typeof mql.removeEventListener === 'function') mql.removeEventListener('change', onChange); else mql.removeListener(onChange); } catch { /* ignore */ } window.removeEventListener('resize', onChange); window.removeEventListener('orientationchange', onChange); };\n  }, []);\n\n  useEffect(() => {\n    fetchWithRefresh(`${API_URL}/children`)\n      .then(res => res.json())\n      .then(data => setChildrenList(data))\n      .catch(() => setChildrenList([]));\n    fetchWithRefresh(`${API_URL}/nannies`)\n      .then(res => res.json())\n      .then(data => setNanniesList(data))\n      .catch(() => setNanniesList([]));\n  }, []);\n\n  async function handleAddReport(e: React.FormEvent) {\n    e.preventDefault();\n    const payload = {\n      priority: form.priority,\n      type: form.type,\n      status: form.status,\n      childId: form.childId,\n      nannyId: form.nannyId,\n      summary: form.summary,\n      details: form.details,\n      date: form.date,\n      time: form.time,\n      duration: form.type === 'comportement' ? form.duration : undefined,\n      childrenInvolved: form.type === 'comportement' ? Number(form.childrenInvolved) || undefined : undefined,\n    };\n    await fetchWithRefresh(`${API_URL}/reports`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n    });\n    fetchWithRefresh(`${API_URL}/reports`)\n      .then(res => res.json())\n      .then(data => setReports(data))\n      .catch(() => setReports([]));\n    setModalOpen(false);\n  setEditingReport(null);\n    setForm({\n      priority: 'moyenne',\n      type: 'incident',\n      status: 'en_attente',\n      childId: '',\n      childName: '',\n      childAge: 3,\n      childGroup: '',\n      nannyId: '',\n      nannyName: '',\n      nannyRole: '',\n      summary: '',\n      details: '',\n      date: new Date().toISOString().split('T')[0],\n      time: '14:00',\n      duration: '',\n      childrenInvolved: '',\n    });\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#f7f8fa] flex flex-col md:flex-row\">\n      {!isShortLandscape && <Sidebar />}\n      <main className={`flex-1 flex flex-col items-center py-4 px-2 md:py-8 md:px-2 ${!isShortLandscape ? 'md:ml-64' : ''}`}>\n        <div className=\"w-full max-w-5xl mx-auto\">\n          <h1 className=\"text-2xl md:text-3xl font-extrabold mb-1 tracking-tight\" style={{ color: '#0b5566' }}>{t('page.reports')}</h1>\n          <div className=\"text-base md:text-lg font-medium mb-4 md:mb-6\" style={{ color: '#08323a' }}>{t('page.reports.description')}</div>\n          <div className=\"flex flex-col md:flex-row flex-wrap gap-2 mb-4 md:mb-6 items-stretch md:items-center\">\n            <div className=\"flex gap-2 flex-wrap\">\n              <button\n                className={`flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg border text-sm md:text-base font-medium ${filterLast30Days ? 'bg-[#a9ddf2] border-[#fcdcdf] text-[#0b5566]' : 'bg-white border-gray-100 text-gray-500'}`}\n                onClick={e => {e.preventDefault(); setFilterLast30Days(v => !v);}}\n              >\n                <span>üìÖ</span> {t('reports.filter.last30')}\n              </button>\n              <select\n                value={filterType}\n                onChange={e => setFilterType(e.target.value)}\n                className=\"px-3 md:px-4 py-2 rounded-lg border border-gray-100 bg-white text-sm md:text-base font-medium\"\n              >\n                <option value=\"\">{t('reports.filter.allTypes')}</option>\n                <option value=\"incident\">{t('reports.type.incident')}</option>\n                <option value=\"comportement\">{t('reports.type.comportement')}</option>\n                <option value=\"soin\">{t('reports.type.soin')}</option>\n              </select>\n              <input\n                type=\"text\"\n                placeholder={t('reports.search.placeholder')}\n                value={searchText}\n                onChange={e => setSearchText(e.target.value)}\n                className=\"px-3 md:px-4 py-2 rounded-lg border border-gray-100 bg-white text-sm md:text-base w-full md:w-64\"\n              />\n            </div>\n            {!(user && user.role === 'parent') && (\n              <button className=\"bg-[#0b5566] text-white px-4 md:px-5 py-2 rounded-lg font-bold shadow hover:bg-[#08323a] transition text-sm md:text-base mt-2 md:mt-0 md:ml-2 w-full md:w-auto\" onClick={() => {\n                setEditingReport(null);\n                setForm({\n                  priority: 'moyenne',\n                  type: 'incident',\n                  status: 'en_attente',\n                  childId: '',\n                  childName: '',\n                  childAge: 3,\n                  childGroup: '',\n                  nannyId: '',\n                  nannyName: '',\n                  nannyRole: '',\n                  summary: '',\n                  details: '',\n                  date: new Date().toISOString().split('T')[0],\n                  time: '14:00',\n                  duration: '',\n                  childrenInvolved: '',\n                });\n                setModalOpen(true);\n              }}>{t('reports.new')}</button>\n            )}\n          </div>\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 md:gap-4 mb-4 md:mb-6\">\n            <div className=\"bg-white rounded-xl shadow border border-gray-100 p-3 md:p-4 flex flex-col items-center\">\n              <div className=\"text-2xl md:text-3xl font-extrabold\" style={{ color: '#0b5566' }}>{total}</div>\n              <div className=\"text-xs text-gray-500 mt-1\">{t('reports.card.total')}</div>\n            </div>\n            <div className=\"bg-white rounded-xl shadow border border-gray-100 p-3 md:p-4 flex flex-col items-center\">\n              <div className=\"text-xl md:text-2xl font-extrabold\" style={{ color: '#08323a' }}>{week}</div>\n              <div className=\"text-xs text-gray-500 mt-1\">{t('reports.card.week')}</div>\n            </div>\n          </div>\n        <div className=\"flex flex-col gap-4 md:gap-6\">\n          {filteredReports.map(report => {\n            const childInitials = report.child?.initials || (report.child?.name ? report.child.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0,2) : '');\n            const nannyInitials = report.nanny?.initials || (report.nanny?.name ? report.nanny.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0,2) : '');\n              return (\n              <div key={report.id} className={`rounded-xl shadow border-2 ${priorityStyles[report.priority as keyof typeof priorityStyles] || ''} p-0 overflow-hidden`} style={{ minWidth: 0 }}>\n                <div className={`flex flex-col sm:flex-row items-start sm:items-center justify-between px-4 md:px-6 py-2`}> \n                  <div className=\"flex items-center gap-2 md:gap-3 mb-2 sm:mb-0\">\n                    <span className={`px-2 md:px-3 py-1 rounded-lg font-bold text-xs`} style={{ background: report.type === 'incident' ? '#ffeaea' : report.type === 'comportement' ? '#fff7e6' : '#a9ddf2', color: report.type === 'incident' ? '#7a2a2a' : report.type === 'comportement' ? '#856400' : '#08323a' }}>{t(typeLabel[report.type as keyof typeof typeLabel] || report.type)}</span>\n                    <span className={`px-2 md:px-3 py-1 rounded-lg font-bold text-xs`} style={{ background: report.priority === 'haute' ? '#dc2626' : report.priority === 'moyenne' ? '#f59e0b' : '#0b5566', color: '#ffffff' }}>{t(priorityLabel[report.priority as keyof typeof priorityLabel] || report.priority)}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"w-8 h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-bold border\" style={{ background: '#a9ddf2', color: '#08323a', borderColor: '#cfeef9' }}>{childInitials}</span>\n                    <span className=\"font-bold text-xs md:text-sm ml-1\" style={{ color: '#08323a' }}>{report.child?.name}</span>\n                    <span className=\"w-8 h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-bold border\" style={{ background: '#fff7e6', color: '#856400', borderColor: '#fff1d6' }}>{nannyInitials}</span>\n                    <span className=\"font-bold text-xs md:text-sm ml-1\" style={{ color: '#856400' }}>{report.nanny?.name}</span>\n                    {/* three-dot menu */}\n                    <div className=\"relative ml-2\">\n                      <button aria-label=\"Actions\" className=\"text-gray-500 hover:text-gray-800\" onClick={() => {\n                        // prefill form with report values\n                        setEditingReport(report);\n                        setForm({\n                          priority: (report.priority as unknown as 'haute' | 'moyenne' | 'basse') || 'moyenne',\n                          type: (report.type as unknown as 'incident' | 'comportement' | 'soin') || 'incident',\n                          status: (report.status as unknown as 'en_attente' | 'traite' | 'resolu') || 'en_attente',\n                          childId: report.child?.id || report.child?.id || '',\n                          childName: report.child?.name || '',\n                          childAge: report.child?.age || 3,\n                          childGroup: report.child?.group || '',\n                          nannyId: report.nanny?.id || report.nanny?.id || '',\n                          nannyName: report.nanny?.name || '',\n                          nannyRole: report.nanny?.role || '',\n                          summary: report.summary || '',\n                          details: report.details || '',\n                          date: report.date ? new Date(report.date).toISOString().split('T')[0] : new Date().toISOString().split('T')[0],\n                          time: report.time || '14:00',\n                          duration: report.duration || '',\n                          childrenInvolved: report.childrenInvolved ? String(report.childrenInvolved) : '',\n                        });\n                        setModalOpen(true);\n                      }}>\n                        ‚ãÆ\n                      </button>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"px-4 md:px-6 pb-4\">\n                  <div className=\"font-bold text-gray-700 mb-1 text-sm md:text-base\">{report.type === 'incident' ? t('reports.summary.incident') : report.type === 'comportement' ? t('reports.summary.comportement') : t('reports.summary.soin')}</div>\n                  <div className=\"text-gray-700 text-sm md:text-base mb-2\">{report.summary}</div>\n                  {report.type === 'comportement' && (\n                    <div className=\"flex gap-4 md:gap-6 items-center text-xs text-gray-500 mt-2 flex-wrap\">\n                        <span className=\"flex items-center gap-1\"><span>‚è±Ô∏è</span> {t('reports.card.duration')} : {report.duration}</span>\n                        <span className=\"flex items-center gap-1\"><span>üëß</span> {t('reports.card.childrenInvolved', { n: String(report.childrenInvolved ?? 0) })}</span>\n                    </div>\n                  )}\n                  <div className=\"flex flex-col items-end mt-4\">\n                    <span className=\"text-xs italic\" style={{ color: '#08323a' }}>\n                      Rapport √©tabli par <span className=\"font-bold\" style={{ color: '#856400' }}>{report.nanny?.name}</span> concernant <span className=\"font-bold\" style={{ color: '#08323a' }}>{report.child?.name}</span>\n                    </span>\n                    <span className=\"text-xs text-gray-500\">\n                      {(() => {\n                        let dateObj;\n                        try {\n                          dateObj = new Date(report.date);\n                        } catch {\n                          dateObj = null;\n                        }\n                        if (dateObj && !isNaN(dateObj.getTime())) {\n                          const options: Intl.DateTimeFormatOptions = { day: '2-digit', month: 'long', year: 'numeric' };\n                          const dateStr = dateObj.toLocaleDateString(locale || 'fr-FR', options);\n                          const heure = report.time ? report.time.slice(0,5).replace(':', 'h') : '';\n                          return `${dateStr}${heure ? ' ' + t('common.at') + ' ' + heure : ''}`;\n                        }\n                        return `${report.date}${report.time ? ' √† ' + report.time : ''}`;\n                      })()}\n                    </span>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n        {modalOpen && (\n            <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/30 backdrop-blur-sm\">\n            <div className=\"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md relative flex flex-col gap-6 animate-fade-in\" style={{ border: '4px solid #fcdcdf' }}>\n              <button onClick={() => setModalOpen(false)} className=\"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl\">√ó</button>\n              <h2 className=\"text-2xl font-extrabold mb-2 text-center\" style={{ color: '#0b5566' }}>{editingReport ? t('reports.modal.title.edit') : t('reports.modal.title.new')}</h2>\n              <form className=\"space-y-3\" onSubmit={async (e) => {\n                if (editingReport) {\n                  e.preventDefault();\n                  const payload = {\n                    priority: form.priority,\n                    type: form.type,\n                    status: form.status,\n                    childId: form.childId,\n                    nannyId: form.nannyId,\n                    summary: form.summary,\n                    details: form.details,\n                    date: form.date,\n                    time: form.time,\n                    duration: form.type === 'comportement' ? form.duration : undefined,\n                    childrenInvolved: form.type === 'comportement' ? Number(form.childrenInvolved) || undefined : undefined,\n                  };\n                  await fetchWithRefresh(`${API_URL}/reports/${editingReport.id}`, {\n                    method: 'PUT',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(payload),\n                  });\n                  fetchWithRefresh(`${API_URL}/reports`).then(res => res.json()).then(data => setReports(data)).catch(() => setReports([]));\n                  setModalOpen(false);\n                  setEditingReport(null);\n                } else {\n                  await handleAddReport(e);\n                }\n              }}>\n                <div className=\"flex gap-2\">\n                  <select value={form.priority} onChange={e => setForm(f => ({ ...f, priority: e.target.value as 'haute' | 'moyenne' | 'basse' }))} className=\"border rounded px-3 py-2 w-1/2\">\n                    <option value=\"haute\">{t('reports.priority.haute')}</option>\n                    <option value=\"moyenne\">{t('reports.priority.moyenne')}</option>\n                    <option value=\"basse\">{t('reports.priority.basse')}</option>\n                  </select>\n                  <select value={form.type} onChange={e => setForm(f => ({ ...f, type: e.target.value as 'incident' | 'comportement' | 'soin' }))} className=\"border rounded px-3 py-2 w-1/2\">\n                    <option value=\"incident\">{t('reports.type.incident')}</option>\n                    <option value=\"comportement\">{t('reports.type.comportement')}</option>\n                    <option value=\"soin\">{t('reports.type.soin')}</option>\n                  </select>\n                </div>\n                  <select value={form.childId} onChange={e => {\n                  const selected = childrenList.find(c => c.id === e.target.value);\n                  setForm(f => ({\n                    ...f,\n                    childId: selected ? selected.id : '',\n                    childName: selected ? selected.name : '',\n                    childAge: selected ? Number(selected.age) : 3,\n                    childGroup: selected ? selected.group : '',\n                  }));\n                }} className=\"border rounded px-3 py-2 w-full\" required>\n                  <option value=\"\">{t('reports.field.child')}</option>\n                  {childrenList.map(child => (\n                    <option key={child.id} value={child.id}>{child.name}</option>\n                  ))}\n                </select>\n                <div className=\"flex gap-2\">\n                  <input type=\"number\" min={1} max={18} placeholder={t('label.age') || '√Çge'} value={form.childAge} onChange={e => setForm(f => ({ ...f, childAge: Number(e.target.value) }))} className=\"border rounded px-3 py-2 w-1/2\" required />\n                  <select value={form.childGroup} onChange={e => setForm(f => ({ ...f, childGroup: e.target.value }))} className=\"border rounded px-3 py-2 w-1/2\" required>\n                    <option value=\"\">{t('reports.field.group')}</option>\n                    {childGroups.map(g => (\n                      <option key={g.key} value={g.key}>{t(g.label)}</option>\n                    ))}\n                  </select>\n                </div>\n                  <select value={form.nannyId} onChange={e => {\n                  const selected = nanniesList.find(n => n.id === e.target.value);\n                  setForm(f => ({\n                    ...f,\n                    nannyId: selected ? selected.id : '',\n                    nannyName: selected ? selected.name : '',\n                    nannyRole: selected ? selected.role : '',\n                  }));\n                }} className=\"border rounded px-3 py-2 w-full\" required>\n                  <option value=\"\">{t('reports.field.nanny')}</option>\n                  {visibleNannies.map(nanny => (\n                    <option key={nanny.id} value={nanny.id}>{nanny.name}</option>\n                  ))}\n                </select>\n                <select value={form.nannyRole} onChange={e => setForm(f => ({ ...f, nannyRole: e.target.value }))} className=\"border rounded px-3 py-2 w-full\" required>\n                  <option value=\"\">{t('reports.field.role')}</option>\n                  {nannyRoles.map(role => (\n                    <option key={role.key} value={role.key}>{t(role.label)}</option>\n                  ))}\n                </select>\n                <input type=\"date\" value={form.date} onChange={e => setForm(f => ({ ...f, date: e.target.value }))} className=\"border rounded px-3 py-2 w-full\" required />\n                <input type=\"time\" value={form.time} onChange={e => setForm(f => ({ ...f, time: e.target.value }))} className=\"border rounded px-3 py-2 w-full\" required />\n                <textarea placeholder={t('reports.field.summary')} value={form.summary} onChange={e => setForm(f => ({ ...f, summary: e.target.value }))} className=\"border rounded px-3 py-2 w-full\" required />\n                {form.type === 'comportement' && (\n                  <div className=\"flex gap-2\">\n                    <input type=\"text\" placeholder={t('reports.field.duration') || 'Dur√©e'} value={form.duration} onChange={e => setForm(f => ({ ...f, duration: e.target.value }))} className=\"border rounded px-3 py-2 w-1/2\" />\n                    <input type=\"number\" min={1} placeholder={t('reports.field.childrenInvolved') || 'Nb enfants impliqu√©s'} value={form.childrenInvolved} onChange={e => setForm(f => ({ ...f, childrenInvolved: e.target.value }))} className=\"border rounded px-3 py-2 w-1/2\" />\n                  </div>\n                )}\n                <div className=\"flex gap-2 mt-2\">\n                  <button type=\"submit\" className=\"bg-[#0b5566] text-white px-4 py-2 rounded hover:bg-[#08323a] transition\">{editingReport ? t('reports.save') : t('reports.create')}</button>\n                  {editingReport && (\n                    <button type=\"button\" onClick={async () => {\n                      if (!editingReport) return; \n                      await fetchWithRefresh(`${API_URL}/reports/${editingReport.id}`, { method: 'DELETE' });\n                      fetchWithRefresh(`${API_URL}/reports`).then(res => res.json()).then(data => setReports(data)).catch(() => setReports([]));\n                      setModalOpen(false); setEditingReport(null);\n                    }} className=\"bg-red-500 text-white px-4 py-2 rounded\">{t('reports.delete')}</button>\n                  )}\n                  <button type=\"button\" onClick={() => { setModalOpen(false); setEditingReport(null); }} className=\"bg-gray-300 px-4 py-2 rounded\">{t('reports.cancel')}</button>\n                </div>\n              </form>\n            </div>\n          </div>\n        )}\n        </div>\n      </main>\n    </div>\n  );\n}\n"],"names":["API_URL","childGroups","nannyRoles","priorityStyles","priorityLabel","typeLabel","ReportsPage","user","useAuth","t","locale","useI18n","useEffect","mounted","cacheKeyChildren","cacheKeyNannies","loadLists","cachedChildren","getCached","cachedNannies","promises","fetchWithRefresh","childrenRes","nanniesRes","childrenData","setChildrenList","setCached","DEFAULT_TTL","nanniesData","setNanniesList","reports","setReports","useState","res","data","total","week","r","reportDate","now","startOfWeek","endOfWeek","filterLast30Days","setFilterLast30Days","filterType","setFilterType","searchText","setSearchText","filteredReports","ok","thirtyDaysAgo","txt","modalOpen","setModalOpen","editingReport","setEditingReport","form","setForm","childrenList","nanniesList","selectedChild","c","visibleNannies","n","f","isShortLandscape","setIsShortLandscape","mql","onChange","handleAddReport","payload","jsxs","Sidebar","jsx","v","report","childInitials","nannyInitials","dateObj","options","dateStr","heure","selected","child","g","nanny","role"],"mappings":"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"}