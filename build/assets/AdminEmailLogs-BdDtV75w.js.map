{"version":3,"file":"AdminEmailLogs-BdDtV75w.js","sources":["../../pages/AdminEmailLogs.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport Sidebar from '../components/Sidebar';\nimport { fetchWithRefresh } from '../utils/fetchWithRefresh';\nimport { useI18n } from '../src/lib/useI18n';\nimport { HiOutlineCheck, HiOutlineClock, HiOutlineExclamationCircle, HiOutlineEye, HiOutlineDownload, HiOutlineRefresh, HiOutlineDocumentText, HiOutlineSearch } from 'react-icons/hi';\n\ntype EmailLog = {\n  id: string;\n  createdAt: string;\n  recipients: string;\n  subject: string | null;\n  status: string;\n  errorText: string | null;\n  bypassOptOut: boolean;\n  paymentHistory: { id: string; month?: number; year?: number; total?: number; createdAt?: string } | null;\n};\n\n// shortRecipients removed — desktop now shows parsed recipients and mobile shows full chips\n\nfunction timeAgo(iso: string) {\n  try {\n    const diff = Date.now() - new Date(iso).getTime();\n    const sec = Math.floor(diff / 1000);\n    if (sec < 60) return `il y a ${sec}s`;\n    const min = Math.floor(sec / 60);\n    if (min < 60) return `il y a ${min}m`;\n    const h = Math.floor(min / 60);\n    if (h < 24) return `il y a ${h}h`;\n    const d = Math.floor(h / 24);\n    return `il y a ${d}j`;\n  } catch {\n    return '';\n  }\n}\n\n// month grid helpers (copied/adapted from NannyCalendar)\nfunction getMonthGrid(date: Date) {\n  const year = date.getFullYear();\n  const month = date.getMonth();\n  const first = new Date(year, month, 1);\n  const last = new Date(year, month + 1, 0);\n  const start = new Date(first);\n  start.setDate(first.getDate() - ((first.getDay() + 6) % 7));\n  const end = new Date(last);\n  end.setDate(last.getDate() + (7 - end.getDay() === 7 ? 0 : 7 - end.getDay()));\n  const days: Date[] = [];\n  for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {\n    days.push(new Date(d));\n  }\n  const weeks: Date[][] = [];\n  for (let i = 0; i < days.length; i += 7) weeks.push(days.slice(i, i + 7));\n  return weeks;\n}\n\n\nexport default function AdminEmailLogs() {\n  const { t } = useI18n();\n  const API_URL = import.meta.env.VITE_API_URL ?? '/api';\n  const [isShortLandscape, setIsShortLandscape] = useState(false);\n  const [logs, setLogs] = useState<EmailLog[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [page, setPage] = useState(1);\n  const [total, setTotal] = useState<number | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [resending, setResending] = useState<Record<string, boolean>>({});\n  const [disabledAfterResend, setDisabledAfterResend] = useState<Record<string, boolean>>({});\n  const [query, setQuery] = useState('');\n  const [debouncedQuery, setDebouncedQuery] = useState(query);\n  // default to current month in YYYY-MM\n  const now = new Date();\n  const pad = (n: number) => String(n).padStart(2, '0');\n  const defaultMonth = `${now.getFullYear()}-${pad(now.getMonth() + 1)}`;\n  const [selectedMonth, setSelectedMonth] = useState(defaultMonth);\n  // month/year controls (like PaymentHistory)\n  const [month, setMonth] = useState<number>(now.getMonth() + 1);\n  const [year, setYear] = useState<number>(now.getFullYear());\n  const monthNames = Array.from({ length: 12 }, (_, i) => new Intl.DateTimeFormat(undefined, { month: 'long' }).format(new Date(2020, i, 1)));\n  const yearOptions = Array.from({ length: 5 }, (_, i) => new Date().getFullYear() - 2 + i);\n  const [recipientFilter, setRecipientFilter] = useState('');\n\n  // no native month picker used; selection handled by month/year selects and modal\n\n  // Calendar modal state\n  const [showCalendarModal, setShowCalendarModal] = useState(false);\n  const [calendarDate, setCalendarDate] = useState(new Date());\n\n  const handleSelectDay = (d: Date) => {\n    const y = d.getFullYear();\n    const m = String(d.getMonth() + 1).padStart(2, '0');\n    setSelectedMonth(`${y}-${m}`);\n    setShowCalendarModal(false);\n  };\n\n  // debounce query so we don't fetch on every keystroke\n  useEffect(() => {\n    const id = setTimeout(() => setDebouncedQuery(query), 300);\n    return () => clearTimeout(id);\n  }, [query]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined' || typeof window.matchMedia !== 'function') return;\n    const mql = window.matchMedia('(max-height: 600px) and (orientation: landscape)');\n    const onChange = () => setIsShortLandscape(Boolean(mql.matches));\n    onChange();\n    if (typeof mql.addEventListener === 'function') mql.addEventListener('change', onChange); else mql.addListener(onChange);\n    window.addEventListener('resize', onChange);\n    window.addEventListener('orientationchange', onChange);\n    return () => { try { if (typeof mql.removeEventListener === 'function') mql.removeEventListener('change', onChange); else mql.removeListener(onChange); } catch { /* ignore */ } window.removeEventListener('resize', onChange); window.removeEventListener('orientationchange', onChange); };\n  }, []);\n\n  // localized timeAgo wrapper uses the raw helper and inserts into translated string\n  const localTimeAgo = (iso: string) => {\n    try {\n      // reuse existing timeAgo helper which currently returns a French-ish relative string\n      const raw = timeAgo(iso);\n      return t('admin.emaillogs.last_attempt', { when: raw });\n    } catch {\n      return '';\n    }\n  };\n\n  // when debounced query or month changes, reset to first page\n  useEffect(() => {\n    setPage(1);\n  }, [debouncedQuery, selectedMonth]);\n\n  useEffect(() => {\n    let mounted = true;\n    const controller = new AbortController();\n    const load = async () => {\n      setLoading(true);\n      setError(null);\n      try {\n        const params = new URLSearchParams();\n        params.set('limit', '50');\n        params.set('page', String(page));\n        if (debouncedQuery) params.set('q', debouncedQuery);\n        if (selectedMonth) params.set('month', selectedMonth);\n        const res = await fetchWithRefresh(`/api/admin/emaillogs?${params.toString()}`, { credentials: 'include', signal: controller.signal });\n        if (!mounted) return;\n        if (res.status === 403) {\n          setError('Accès refusé — administrateur requis.');\n          setLogs([]);\n          setTotal(null);\n          return;\n        }\n        if (!res.ok) throw new Error('Erreur serveur');\n        const json = await res.json();\n        setLogs(Array.isArray(json.data) ? json.data : []);\n        setTotal(json.meta && typeof json.meta.total === 'number' ? json.meta.total : null);\n      } catch (e: unknown) {\n        // Detect fetch abort in a type-safe manner\n  if (typeof e === 'object' && e !== null && 'name' in e && (e as { name?: unknown }).name === 'AbortError') return;\n        const msg = e instanceof Error ? e.message : String(e);\n        setError(msg);\n        setLogs([]);\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    };\n    load();\n    return () => { mounted = false; controller.abort(); };\n  }, [page, debouncedQuery, selectedMonth]);\n\n  // keep selectedMonth in sync when month/year selects change\n  useEffect(() => {\n    setSelectedMonth(`${year}-${pad(month)}`);\n  }, [month, year]);\n\n  async function openInvoice(paymentId: string) {\n    if (!paymentId) return;\n    try {\n      const res = await fetchWithRefresh(`${API_URL}/payment-history/invoice/${paymentId}`, { credentials: 'include' });\n      if (!res.ok) {\n        const text = await res.text().catch(() => '');\n        throw new Error(text || 'Erreur lors de la récupération du PDF');\n      }\n      const blob = await res.blob();\n      const url = URL.createObjectURL(blob);\n      window.open(url, '_blank');\n      // revoke after a minute\n      setTimeout(() => URL.revokeObjectURL(url), 60 * 1000);\n    } catch (e) {\n      console.error('Failed to open invoice', e);\n      alert(t('admin.emaillogs.open_invoice_failed'));\n    }\n  }\n\n  async function downloadInvoice(paymentId: string, filename?: string) {\n    if (!paymentId) return;\n    try {\n      const res = await fetchWithRefresh(`${API_URL}/payment-history/invoice/${paymentId}`, { credentials: 'include' });\n      if (!res.ok) {\n        const text = await res.text().catch(() => '');\n        throw new Error(text || 'Erreur lors du téléchargement');\n      }\n      const blob = await res.blob();\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename || `invoice-${paymentId}.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      setTimeout(() => URL.revokeObjectURL(url), 60 * 1000);\n    } catch (e) {\n      console.error('Failed to download invoice', e);\n      alert(t('admin.emaillogs.download_invoice_failed'));\n    }\n  }\n\n  async function resendEmail(logId: string) {\n    if (!logId) return;\n    try {\n      setResending(s => ({ ...s, [logId]: true }));\n      // Optimistic: mark loading state per log could be added; for simplicity, refetch page after\n      const res = await fetchWithRefresh(`/api/admin/emaillogs/${logId}/resend`, { method: 'POST', credentials: 'include' });\n      if (!res.ok) {\n        const text = await res.text().catch(() => '');\n        setResending(s => { const c = { ...s }; delete c[logId]; return c; });\n        throw new Error(text || 'Failed to resend');\n      }\n      // Refresh current page of logs\n      setLoading(true);\n      const params = new URLSearchParams();\n      params.set('limit', String(limit));\n      params.set('page', String(page));\n      if (debouncedQuery) params.set('q', debouncedQuery);\n      if (selectedMonth) params.set('month', selectedMonth);\n      const fresh = await fetchWithRefresh(`/api/admin/emaillogs?${params.toString()}`, { credentials: 'include' });\n      if (fresh.ok) {\n        const json = await fresh.json();\n        setLogs(Array.isArray(json.data) ? json.data : []);\n        setTotal(json.meta && typeof json.meta.total === 'number' ? json.meta.total : null);\n        // mark related paymentHistory as disabled for further resends\n        try {\n          let phId: string | null = null;\n          if (Array.isArray(json.data)) {\n            const found = (json.data as EmailLog[]).find((it: EmailLog) => it && it.id === logId);\n            if (found && found.paymentHistory) phId = found.paymentHistory.id;\n          }\n          if (!phId) {\n            const original = logs.find(l => l.id === logId);\n            phId = original && original.paymentHistory ? original.paymentHistory.id : null;\n          }\n          if (phId) setDisabledAfterResend(s => ({ ...s, [phId]: true }));\n        } catch (err) {\n          console.error('Unable to mark disabledAfterResend', err);\n        }\n      }\n    } catch (e) {\n      const msg = e instanceof Error ? e.message : String(e);\n      alert(t('admin.emaillogs.resend_failed', { msg }));\n    } finally {\n      setResending(s => { const c = { ...s }; delete c[logId]; return c; });\n      setLoading(false);\n    }\n  }\n\n  // Helpers to parse recipients and filter logs (used for export)\n  function parseRecipientsField(recipientsField: string): string[] {\n    try {\n      const parsed = JSON.parse(recipientsField || '[]');\n      if (Array.isArray(parsed)) return parsed.map(String);\n      return [String(parsed)];\n    } catch {\n      return (recipientsField || '').split(/[,;\\n]/).map(s => s.trim()).filter(Boolean);\n    }\n  }\n\n  function getFilteredLogs(): EmailLog[] {\n    return logs.filter(l => {\n      const recips: string[] = parseRecipientsField(l.recipients || '');\n      if (recipientFilter && !recips.includes(recipientFilter)) return false;\n      if (query) {\n        const q = query.toLowerCase();\n        if (!(String(l.subject || '').toLowerCase().includes(q) || recips.join(' ').toLowerCase().includes(q))) return false;\n      }\n      return true;\n    });\n  }\n\n  function csvEscape(value: unknown) {\n    if (value == null) return '';\n    const s = String(value);\n    return `\"${s.replace(/\"/g, '\"\"')}\"`;\n  }\n\n  function hasSentForPayment(paymentHistoryId: string) {\n    if (!paymentHistoryId) return false;\n    return logs.some(l => l.paymentHistory && l.paymentHistory.id === paymentHistoryId && String(l.status).toLowerCase() === 'sent');\n  }\n\n  function exportCsv() {\n    try {\n      const rows: string[][] = [];\n      const header = ['createdAt', 'subject', 'recipients', 'invoiceNumber', 'paymentHistoryId', 'total', 'status', 'errorText'];\n      rows.push(header);\n      const filtered = getFilteredLogs();\n      for (const l of filtered) {\n        const recips = parseRecipientsField(l.recipients || '').join('; ');\n        let invoiceNumber = '';\n        let paymentHistoryId = '';\n        let total = '';\n        if (l.paymentHistory) {\n          paymentHistoryId = l.paymentHistory.id;\n          const invoiceDate = l.paymentHistory.createdAt ? new Date(l.paymentHistory.createdAt) : new Date();\n          invoiceNumber = `FA-${invoiceDate.getFullYear()}-${String(l.paymentHistory.id).slice(0,6)}`;\n          if (typeof l.paymentHistory.total === 'number') total = l.paymentHistory.total.toFixed(2);\n        }\n        rows.push([\n          csvEscape(new Date(l.createdAt).toISOString()),\n          csvEscape(l.subject || ''),\n          csvEscape(recips),\n          csvEscape(invoiceNumber),\n          csvEscape(paymentHistoryId),\n          csvEscape(total),\n          csvEscape(l.status),\n          csvEscape(l.errorText || '')\n        ]);\n      }\n      const csvContent = rows.map(r => r.join(',')).join('\\n');\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `emaillogs-${selectedMonth || 'all'}.csv`;\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      setTimeout(() => URL.revokeObjectURL(url), 60 * 1000);\n    } catch (e) {\n      console.error('Export CSV failed', e);\n      alert(t('admin.emaillogs.export_failed'));\n    }\n  }\n\n  // pagination helpers\n  const limit = 50;\n  const totalPages = total && total > 0 ? Math.max(1, Math.ceil(total / limit)) : 1;\n  const hasPrev = page > 1;\n  const hasNext = total !== null ? page < totalPages : logs.length === limit;\n\n  // status helpers\n  const getStatusInfo = (status: string | undefined) => {\n    // normalize\n    const s = String(status || '').toLowerCase();\n    if (s === 'sent' || s === 'ok' || s === 'delivered') {\n      return {\n        label: t('emaillogs.status.sent'),\n        badge: 'bg-green-100 text-green-800',\n        icon: <HiOutlineCheck className=\"w-4 h-4 mr-2\" />\n      };\n    }\n    if (s === 'pending' || s === 'processing' || s === 'in_progress' || s === 'queued') {\n      return {\n        label: t('emaillogs.status.pending'),\n        badge: 'bg-yellow-100 text-yellow-800',\n        icon: <HiOutlineClock className=\"w-4 h-4 mr-2\" />\n      };\n    }\n    // default to error\n    return {\n      label: t('emaillogs.status.error'),\n      badge: 'bg-red-100 text-red-800',\n      icon: <HiOutlineExclamationCircle className=\"w-4 h-4 mr-2\" />\n    };\n  };\n\n  // expanded state removed — mobile cards now show full info with actions\n\n  return (\n    <div className={`relative z-0 min-h-screen bg-gray-50 p-4 ${!isShortLandscape ? 'md:pl-64' : ''} w-full`}>\n      {!isShortLandscape && <Sidebar />}\n      <main className=\"flex-1 flex flex-col items-center py-4 px-2 md:py-8 md:px-4\">\n        <div className=\"w-full max-w-5xl mx-auto\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <div>\n              <h1 className=\"text-2xl md:text-3xl font-extrabold mb-1 tracking-tight\" style={{ color: '#0b5566' }}>{t('admin.emaillogs.title')}</h1>\n              <div className=\"text-base md:text-lg font-medium mb-4 md:mb-6\" style={{ color: '#08323a' }}>{t('admin.emaillogs.description')}</div>\n            </div>\n          </div>\n\n          {error && (\n            <div className=\"mb-4 p-3 bg-red-50 border border-red-100 text-red-700 rounded\">{error}</div>\n          )}\n\n          <>\n          {loading && <div className=\"mb-4\">{t('admin.emaillogs.loading')}</div>}\n              {/* Mobile filters: show search, month/year and recipient selects in a column */}\n              <div className=\"md:hidden bg-white rounded-lg p-3 mb-4 shadow\">\n                <div className=\"flex flex-col gap-3\">\n                  <div className=\"flex items-center gap-2 bg-gray-50 rounded-md px-3 py-2\">\n                    <HiOutlineSearch className=\"w-4 h-4 text-gray-400\" />\n                    <input aria-label=\"search-mobile\" value={query} onChange={e => setQuery(e.target.value)} className=\"bg-transparent text-sm text-gray-600 placeholder-gray-400 outline-none w-full\" placeholder={t('admin.emaillogs.search_placeholder')} />\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <select value={month} onChange={e => setMonth(Number(e.target.value))} className=\"flex-1 border rounded px-2 py-1 text-sm\">\n                      {monthNames.map((mName, idx) => <option key={mName} value={idx + 1}>{mName}</option>)}\n                    </select>\n                    <select value={year} onChange={e => setYear(Number(e.target.value))} className=\"flex-1 border rounded px-2 py-1 text-sm\">\n                      {yearOptions.map(y => <option key={y} value={y}>{y}</option>)}\n                    </select>\n                  </div>\n                  <div>\n                    <select value={recipientFilter} onChange={e => setRecipientFilter(e.target.value)} className=\"w-full border rounded px-2 py-1 text-sm\">\n                      <option value=\"\">{t('admin.emaillogs.all_recipients')}</option>\n                      {Array.from(new Set(logs.flatMap(l => {\n                        try { const p = JSON.parse(l.recipients || '[]'); return Array.isArray(p) ? p.map(String) : [String(p)]; } catch { return (l.recipients || '').split(/[,;\\n]/).map(s => s.trim()).filter(Boolean); }\n                      }))).map((r, idx) => <option key={idx} value={r}>{r}</option>)}\n                    </select>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button onClick={() => exportCsv()} className=\"flex-1 flex items-center justify-center gap-2 bg-green-500 text-white rounded px-3 py-2 text-sm\">\n                      <HiOutlineDocumentText className=\"w-4 h-4\" />\n                      {t('admin.emaillogs.export')}\n                    </button>\n                    <button onClick={() => { setPage(1); setQuery(''); setSelectedMonth(''); }} className=\"p-2 border rounded\">\n                      <HiOutlineRefresh className=\"w-4 h-4 text-gray-600\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n              {/* Mobile: stacked cards */}\n              <div className=\"md:hidden space-y-4\">\n                {/** compute visible logs applying recipient and query filters */}\n                {(() => {\n                  const v = logs.filter(l => {\n                    // recipients\n                    let recips: string[] = [];\n                    try {\n                      const parsed = JSON.parse(l.recipients || '[]');\n                      if (Array.isArray(parsed)) recips = parsed.map(String);\n                      else recips = [String(parsed)];\n                    } catch {\n                      recips = (l.recipients || '').split(/[,;\\n]/).map(s => s.trim()).filter(Boolean);\n                    }\n                    if (recipientFilter && !recips.includes(recipientFilter)) return false;\n                    if (query) {\n                      const q = query.toLowerCase();\n                      if (!(String(l.subject || '').toLowerCase().includes(q) || recips.join(' ').toLowerCase().includes(q))) return false;\n                    }\n                    return true;\n                  });\n                  return v.map(l => {\n                  let recips: string[] = [];\n                  try {\n                    const parsed = JSON.parse(l.recipients || '[]');\n                    if (Array.isArray(parsed)) recips = parsed.map(String);\n                    else recips = [String(parsed)];\n                  } catch {\n                    recips = (l.recipients || '').split(/[,;\\n]/).map(s => s.trim()).filter(Boolean);\n                  }\n                  const primaryDot = l.status === 'sent' ? 'bg-green-500' : 'bg-red-500';\n                          return (\n                            <div key={l.id} className=\"bg-white rounded-xl shadow-sm p-4\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-10 h-10 rounded-full bg-[#eef9ff] flex items-center justify-center text-[#0b5566] font-semibold\"><HiOutlineDocumentText className=\"w-5 h-5\" /></div>\n                          <div>\n                            <div className=\"flex items-center gap-3\">\n                              <div className=\"text-lg font-bold text-gray-900\">{l.subject || t('payments.download_invoice')}</div>\n                              {(() => {\n                                const s = getStatusInfo(l.status);\n                                return (\n                                  <div className={`ml-2 text-sm font-medium px-2 py-1 rounded-full ${s.badge} flex items-center`}>{s.icon}<span>{s.label}</span></div>\n                                );\n                              })()}\n                            </div>\n                            {/* redundant subject line removed — title already shows the subject */}\n                          </div>\n                        </div>\n                      </div>\n\n                      <div className=\"mt-4\">\n                        <div className=\"text-xs text-gray-400\">{t('admin.emaillogs.date_sent')}</div>\n                        <div className=\"text-sm text-gray-800 font-medium\">{new Date(l.createdAt).toLocaleString()}</div>\n                      </div>\n\n                      <div className=\"mt-4\">\n                        <div className=\"text-xs text-gray-400\">{t('admin.emaillogs.recipients')}</div>\n                        <div className=\"mt-2 flex flex-col gap-2\">\n                          {recips.length ? recips.map((r, i) => (\n                            <div key={i} className=\"flex items-center gap-3 bg-gray-50 rounded-md px-3 py-2\">\n                              <span className={`${primaryDot} w-2 h-2 rounded-full block`} />\n                              <span className=\"text-sm text-gray-800 break-words\">{r}</span>\n                            </div>\n                          )) : (\n                            <div className=\"text-sm text-gray-600\">—</div>\n                          )}\n                        </div>\n                      </div>\n\n                      {l.errorText ? (\n                        <div className=\"mt-4 p-3 bg-red-50 border border-red-100 rounded-md text-red-700\">\n                          <div className=\"flex items-start gap-3\">\n                            <div className=\"text-xl\">⚠️</div>\n                            <div>\n                              <div className=\"font-semibold\">{t('admin.emaillogs.send_error')}</div>\n                              <div className=\"text-sm mt-1\">{l.errorText}</div>\n                            </div>\n                          </div>\n                        </div>\n                      ) : null}\n\n                      <div className=\"mt-4 flex items-center justify-center gap-3\">\n                        {l.status === 'sent' ? (\n                          <>\n                            <button\n                              onClick={() => l.paymentHistory && openInvoice(l.paymentHistory.id)}\n                              disabled={!l.paymentHistory}\n                              aria-label={t('admin.emaillogs.view_invoice')}\n                              className={`w-10 h-10 flex items-center justify-center rounded-full border text-gray-600 ${!l.paymentHistory ? 'opacity-50 cursor-not-allowed' : ''}`}>\n                              <HiOutlineEye className=\"w-5 h-5\" />\n                            </button>\n                            <button\n                              onClick={() => l.paymentHistory && downloadInvoice(l.paymentHistory.id, `facture-${l.paymentHistory ? l.paymentHistory.id : l.id}.pdf`)}\n                              disabled={!l.paymentHistory}\n                              title={t('admin.emaillogs.download')}\n                              className={`w-10 h-10 flex items-center justify-center rounded-full border text-gray-600 ${!l.paymentHistory ? 'opacity-50 cursor-not-allowed' : ''}`}>\n                              <HiOutlineDownload className=\"w-5 h-5\" />\n                            </button>\n                          </>\n                          ) : (\n                          <button\n                            title={t('admin.emaillogs.resend')}\n                            onClick={() => resendEmail(l.id)}\n                            disabled={!!resending[l.id] || !!(l.paymentHistory && (disabledAfterResend[l.paymentHistory.id] || hasSentForPayment(l.paymentHistory.id)))}\n                            className={`w-10 h-10 flex items-center justify-center rounded-full bg-red-500 text-white ${resending[l.id] || (l.paymentHistory && (disabledAfterResend[l.paymentHistory.id] || hasSentForPayment(l.paymentHistory.id))) ? 'opacity-50 cursor-not-allowed' : ''}`}>\n                            <HiOutlineRefresh className=\"w-5 h-5\" />\n                          </button>\n                        )}\n                        {/* more/actions button removed per UX request */}\n                      </div>\n\n                      <div className=\"mt-3 text-xs text-gray-400 text-center\">{localTimeAgo(l.createdAt)}</div>\n                    </div>\n                  );\n                  });\n                })()}\n              </div>\n\n              {/* Desktop/tablet: gestion des factures layout */}\n              <div className=\"hidden md:block\">\n                <div className=\"bg-white rounded-2xl shadow p-6\">\n                  <div className=\"flex items-center justify-between gap-4 mb-6\">\n                    <div className=\"flex-1 flex items-center gap-4\">\n                      <h2 className=\"text-xl font-semibold\">Gestion des Factures</h2>\n                      <div className=\"flex items-center bg-gray-50 rounded-md px-3 py-2 gap-3\">\n                        <HiOutlineSearch className=\"w-4 h-4 text-gray-400\" />\n                        <input aria-label=\"search\" value={query} onChange={e => setQuery(e.target.value)} className=\"bg-transparent text-sm text-gray-600 placeholder-gray-400 outline-none\" placeholder={t('admin.emaillogs.search_placeholder')} />\n                      </div>\n                      <div className=\"ml-2 flex items-center gap-2\">\n                        <select value={month} onChange={e => setMonth(Number(e.target.value))} className=\"border rounded px-2 py-1 text-sm\">\n                          {monthNames.map((mName, idx) => <option key={mName} value={idx + 1}>{mName}</option>)}\n                        </select>\n                        <select value={year} onChange={e => setYear(Number(e.target.value))} className=\"border rounded px-2 py-1 text-sm\">\n                          {yearOptions.map(y => <option key={y} value={y}>{y}</option>)}\n                        </select>\n                        <div className=\"ml-2\">\n                          <select value={recipientFilter} onChange={e => setRecipientFilter(e.target.value)} className=\"border rounded px-2 py-1 text-sm\">\n                            <option value=\"\">{t('admin.emaillogs.all_recipients')}</option>\n                            {Array.from(new Set(logs.flatMap(l => {\n                              try { const p = JSON.parse(l.recipients || '[]'); return Array.isArray(p) ? p.map(String) : [String(p)]; } catch { return (l.recipients || '').split(/[,;\\n]/).map(s => s.trim()).filter(Boolean); }\n                            }))).map((r, idx) => <option key={idx} value={r}>{r}</option>)}\n                          </select>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"ml-auto flex items-center gap-3\">\n                        <button onClick={() => exportCsv()} className=\"flex items-center gap-2 bg-green-500 text-white rounded px-3 py-2 text-sm\" aria-label=\"export\">\n                          <HiOutlineDocumentText className=\"w-4 h-4\" />\n                          {t('admin.emaillogs.export')}\n                        </button>\n                        <button className=\"p-2 border rounded\" aria-label=\"refresh\" onClick={() => { setPage(1); setQuery(''); setSelectedMonth(''); }}>\n                          <HiOutlineRefresh className=\"w-4 h-4 text-gray-600\" />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"min-w-full\">\n                      <thead className=\"text-left text-sm text-gray-500 border-b\">\n                        <tr>\n                          <th className=\"py-3 px-4\">{t('emaillogs.table.subject')}</th>\n                          <th className=\"py-3 px-4\">{t('emaillogs.table.date')}</th>\n                          <th className=\"py-3 px-4\">{t('emaillogs.table.recipients')}</th>\n                          <th className=\"py-3 px-4\">{t('emaillogs.table.invoice_number')}</th>\n                          <th className=\"py-3 px-4\">{t('emaillogs.table.status')}</th>\n                          <th className=\"py-3 px-4\">{t('emaillogs.table.error')}</th>\n                          <th className=\"py-3 px-4\">{t('emaillogs.table.actions')}</th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"divide-y\">\n                        {(() => {\n                          const v = logs.filter(l => {\n                            let recips: string[] = [];\n                            try {\n                              const parsed = JSON.parse(l.recipients || '[]');\n                              if (Array.isArray(parsed)) recips = parsed.map(String);\n                              else recips = [String(parsed)];\n                            } catch {\n                              recips = (l.recipients || '').split(/[,;\\n]/).map(s => s.trim()).filter(Boolean);\n                            }\n                            if (recipientFilter && !recips.includes(recipientFilter)) return false;\n                            if (query) {\n                              const q = query.toLowerCase();\n                              if (!(String(l.subject || '').toLowerCase().includes(q) || recips.join(' ').toLowerCase().includes(q))) return false;\n                            }\n                            return true;\n                          });\n                          return v.map(l => {\n                          // recipients first line\n                          let recips: string[] = [];\n                          try {\n                            const parsed = JSON.parse(l.recipients || '[]');\n                            if (Array.isArray(parsed)) recips = parsed.map(String);\n                            else recips = [String(parsed)];\n                          } catch {\n                            recips = (l.recipients || '').split(/[,;\\n]/).map(s => s.trim()).filter(Boolean);\n                          }\n                          const firstRecip = recips[0] || '';\n                          const statusIsSent = l.status === 'sent';\n                          return (\n                            <tr key={l.id} className=\"hover:bg-gray-50 align-top\">\n                              <td className=\"py-4 px-4 w-1/3\">\n                                <div className=\"text-sm font-medium text-gray-900\">{l.subject || t('payments.download_invoice')}</div>\n                              </td>\n                              <td className=\"py-4 px-4 text-sm text-gray-700\">\n                                <div>{new Date(l.createdAt).toLocaleDateString()}</div>\n                                <div className=\"text-xs text-gray-400\">{new Date(l.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>\n                              </td>\n                              <td className=\"py-4 px-4 text-sm text-gray-700 max-w-xs\">\n                                <div className=\"flex items-center gap-3\">\n                                  <span className={`w-2 h-2 rounded-full ${statusIsSent ? 'bg-green-500' : 'bg-red-500'}`} />\n                                  <div className=\"flex flex-col\">\n                                    <div className=\"text-sm text-gray-800\">{firstRecip}</div>\n                                    {recips[1] && <div className=\"text-xs text-gray-400\">{recips.slice(1, 2).join(', ')}</div>}\n                                  </div>\n                                </div>\n                              </td>\n                              <td className=\"py-4 px-4 text-sm text-blue-600\">\n                                {l.paymentHistory ? (\n                                  <div>\n                                    {(() => {\n                                      const ph = l.paymentHistory;\n                                      if (!ph) return null;\n                                      const invoiceDate = ph.createdAt ? new Date(ph.createdAt) : new Date();\n                                      const invoiceNumber = `FA-${invoiceDate.getFullYear()}-${String(ph.id).slice(0,6)}`;\n                                      return (\n                                        <>\n                                          <div className=\"font-medium\">{invoiceNumber}</div>\n                                        </>\n                                      );\n                                    })()}\n                                  </div>\n                                ) : '—'}\n                              </td>\n                              <td className=\"py-4 px-4\">\n                                {(() => {\n                                  const s = getStatusInfo(l.status);\n                                  return <div className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${s.badge}`}>{s.icon}<span>{s.label}</span></div>;\n                                })()}\n                              </td>\n                              <td className=\"py-4 px-4 text-sm text-red-600 max-w-xs\">{l.errorText ? <div className=\"font-medium\">{l.errorText}</div> : '-'}</td>\n                              <td className=\"py-4 px-4 text-sm\">\n                                <div className=\"flex items-center gap-2\">\n                                  {statusIsSent ? (\n                                    <>\n                                      <button title={t('admin.emaillogs.view_invoice')} disabled={!l.paymentHistory} onClick={() => l.paymentHistory && openInvoice(l.paymentHistory.id)} className={`p-2 rounded border text-gray-600 ${!l.paymentHistory ? 'opacity-50 cursor-not-allowed' : ''}`}><HiOutlineEye className=\"w-4 h-4\" /></button>\n                                      <button title={t('admin.emaillogs.download')} disabled={!l.paymentHistory} onClick={() => l.paymentHistory && downloadInvoice(l.paymentHistory.id, `facture-${l.paymentHistory ? l.paymentHistory.id : l.id}.pdf`)} className={`p-2 rounded border text-gray-600 ${!l.paymentHistory ? 'opacity-50 cursor-not-allowed' : ''}`}><HiOutlineDownload className=\"w-4 h-4\" /></button>\n                                    </>\n                                  ) : (\n                                    <button\n                                      title={t('admin.emaillogs.resend')}\n                                      onClick={() => resendEmail(l.id)}\n                                      disabled={!!resending[l.id] || !!(l.paymentHistory && (disabledAfterResend[l.paymentHistory.id] || hasSentForPayment(l.paymentHistory.id)))}\n                                      className={`p-2 rounded bg-red-500 text-white ${resending[l.id] || (l.paymentHistory && (disabledAfterResend[l.paymentHistory.id] || hasSentForPayment(l.paymentHistory.id))) ? 'opacity-50 cursor-not-allowed' : ''}`}>\n                                      <HiOutlineRefresh className=\"w-4 h-4\" />\n                                    </button>\n                                  )}\n                                  {/* more/actions button removed per UX request */}\n                                </div>\n                              </td>\n                            </tr>\n                          );\n                          });\n                        })()}\n                      </tbody>\n                    </table>\n                  </div>\n\n                    <div className=\"mt-6 bg-gray-50 rounded p-6 text-center\">\n                    <div className=\"text-sm text-gray-600\">\n                      {t('admin.emaillogs.displaying', {\n                        from: total ? `${(page - 1) * limit + 1}` : (logs.length ? '1' : '—'),\n                        to: total ? `${Math.min(page * limit, total)}` : (logs.length ? `${logs.length}` : '—'),\n                        total: String(total ?? '—')\n                      })}\n                    </div>\n                    <div className=\"mt-3 flex items-center justify-center gap-3\">\n                      <button className=\"px-3 py-1 border rounded\" onClick={() => setPage(Math.max(1, page - 1))} disabled={!hasPrev}>{t('emaillogs.pagination.prev')}</button>\n                      <div className=\"inline-flex items-center justify-center w-10 h-10 bg-white rounded-full border\">{page}</div>\n                      <button className=\"px-3 py-1 border rounded\" onClick={() => hasNext && setPage(page + 1)} disabled={!hasNext}>{t('emaillogs.pagination.next')}</button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </>\n        </div>\n      </main>\n      {showCalendarModal && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40\">\n          <div className=\"bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"text-lg font-semibold\">{t('admin.emaillogs.choose_month')}</div>\n              <button className=\"text-gray-500\" onClick={() => setShowCalendarModal(false)}>✕</button>\n            </div>\n            <div>\n              <div className=\"flex items-center justify-between mb-3\">\n                <div className=\"font-medium\">{new Intl.DateTimeFormat('fr-FR', { month: 'long', year: 'numeric' }).format(calendarDate)}</div>\n                <div className=\"flex items-center gap-2\">\n                  <button onClick={() => setCalendarDate(d => new Date(d.getFullYear(), d.getMonth() - 1, 1))} className=\"px-2 py-1 border rounded\">‹</button>\n                  <button onClick={() => setCalendarDate(d => new Date(d.getFullYear(), d.getMonth() + 1, 1))} className=\"px-2 py-1 border rounded\">›</button>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-7 gap-1 text-center text-xs text-gray-500 mb-2\">\n                {getMonthGrid(calendarDate).flat().slice(0,7).map((d, i) => (\n                  <div key={i}>{new Intl.DateTimeFormat('fr-FR', { weekday: 'short' }).format(d)}</div>\n                ))}\n              </div>\n              <div className=\"grid grid-cols-7 gap-1\">\n                {getMonthGrid(calendarDate).flat().map((d, idx) => {\n                  const isCurrentMonth = d.getMonth() === calendarDate.getMonth();\n                  return (\n                    <button key={idx} onClick={() => handleSelectDay(d)} className={`p-2 rounded ${isCurrentMonth ? 'bg-[#f8f8fc]' : 'bg-gray-50 opacity-60'}`}>\n                      <div className=\"text-sm text-gray-800\">{d.getDate()}</div>\n                    </button>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["timeAgo","iso","diff","sec","min","h","getMonthGrid","date","year","month","first","last","start","end","days","d","weeks","i","AdminEmailLogs","t","useI18n","API_URL","isShortLandscape","setIsShortLandscape","useState","logs","setLogs","loading","setLoading","page","setPage","total","setTotal","error","setError","resending","setResending","disabledAfterResend","setDisabledAfterResend","query","setQuery","debouncedQuery","setDebouncedQuery","now","pad","n","defaultMonth","selectedMonth","setSelectedMonth","setMonth","setYear","monthNames","_","yearOptions","recipientFilter","setRecipientFilter","showCalendarModal","setShowCalendarModal","calendarDate","setCalendarDate","handleSelectDay","y","m","useEffect","id","mql","onChange","localTimeAgo","raw","mounted","controller","params","res","fetchWithRefresh","json","e","msg","openInvoice","paymentId","text","blob","url","downloadInvoice","filename","a","resendEmail","logId","s","c","limit","fresh","phId","found","it","original","l","err","parseRecipientsField","recipientsField","parsed","getFilteredLogs","recips","q","csvEscape","value","hasSentForPayment","paymentHistoryId","exportCsv","rows","header","filtered","invoiceNumber","csvContent","r","totalPages","hasPrev","hasNext","getStatusInfo","status","jsx","HiOutlineCheck","HiOutlineClock","HiOutlineExclamationCircle","jsxs","Sidebar","Fragment","HiOutlineSearch","mName","idx","p","HiOutlineDocumentText","HiOutlineRefresh","primaryDot","HiOutlineEye","HiOutlineDownload","firstRecip","statusIsSent","ph","isCurrentMonth"],"mappings":"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"}