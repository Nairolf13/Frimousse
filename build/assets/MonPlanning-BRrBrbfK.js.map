{"version":3,"file":"MonPlanning-BRrBrbfK.js","sources":["../../pages/MonPlanning.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport NannyCalendar from '../components/NannyCalendar';\nimport { fetchWithRefresh } from '../utils/fetchWithRefresh';\n\nexport default function MonPlanning() {\n  const [nannyId, setNannyId] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [nannies, setNannies] = useState<Array<{ id: string; name: string }>>([]);\n\n  useEffect(() => {\n    fetchWithRefresh('api/me')\n      .then(res => res.json())\n      .then(async (user) => {\n        if (user.role === 'nanny' && user.nannyId) {\n          setNannyId(user.nannyId);\n          return;\n        }\n\n        if (user.role === 'admin' || user.role === 'super-admin') {\n          setIsAdmin(true);\n          try {\n            const r = await fetchWithRefresh('api/nannies');\n            if (r.ok) {\n              const list = await r.json();\n              type NannyFromApi = { id?: string; name?: string };\n              const simplified = Array.isArray(list)\n                ? (list as NannyFromApi[]).map((n: NannyFromApi) => ({ id: String(n.id ?? ''), name: String(n.name ?? '') }))\n                : [];\n              setNannies(simplified);\n              if (simplified.length > 0) setNannyId(simplified[0].id);\n            }\n          } catch (e) {\n            console.error('Failed to load nannies for admin', e);\n          }\n        }\n      })\n      .finally(() => setLoading(false));\n  }, []);\n\n  if (loading) return <div className=\"p-8 text-center text-[#0b5566]\">Chargement...</div>;\n  if (!nannyId) {\n    if (isAdmin) return <div className=\"p-8 text-center text-red-500\">Aucune nounou trouvée pour votre structure.</div>;\n    return <div className=\"p-8 text-center text-red-500\">Accès réservé aux nounous.</div>;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#f7f4d7] flex flex-col md:flex-row\">\n      <main className=\"flex-1 flex flex-col items-center py-4 px-2 md:py-8 md:px-2 md:ml-64\">\n        <div className=\"w-full max-w-5xl mx-auto\">\n          <div className=\"bg-white rounded-2xl shadow p-4 md:p-10 min-h-[600px] md:min-h-[700px] flex flex-col\" style={{ border: '1px solid #fcdcdf' }}>\n            <h1 className=\"text-2xl md:text-3xl font-bold mb-6 text-center text-[#0b5566]\">Mon planning</h1>\n            {isAdmin && nannies.length > 0 && (\n              <div className=\"mb-4 flex justify-center\">\n                <label className=\"mr-2 self-center\">Voir le planning de :</label>\n                <select value={nannyId || ''} onChange={e => setNannyId(e.target.value)} className=\"border rounded px-2 py-1\">\n                  {nannies.map(n => (\n                    <option key={n.id} value={n.id}>{n.name}</option>\n                  ))}\n                </select>\n              </div>\n            )}\n            <div className=\"flex-1 flex flex-col\">\n              <div className=\"flex-1 p-4 rounded-lg\" style={{ background: '#a9ddf2' }}>\n                <NannyCalendar nannyId={nannyId} />\n              </div>\n            </div>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n"],"names":["MonPlanning","nannyId","setNannyId","useState","loading","setLoading","isAdmin","setIsAdmin","nannies","setNannies","useEffect","fetchWithRefresh","res","user","r","list","simplified","n","e","jsx","jsxs","NannyCalendar"],"mappings":"oIAIA,SAAwBA,GAAc,CACpC,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAwB,IAAI,EACpD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAASC,CAAU,EAAIJ,EAAAA,SAAS,EAAK,EACtC,CAACK,EAASC,CAAU,EAAIN,EAAAA,SAA8C,CAAA,CAAE,EAgC9E,OA9BAO,EAAAA,UAAU,IAAM,CACdC,EAAiB,QAAQ,EACtB,KAAKC,GAAOA,EAAI,MAAM,EACtB,KAAK,MAAOC,GAAS,CACpB,GAAIA,EAAK,OAAS,SAAWA,EAAK,QAAS,CACzCX,EAAWW,EAAK,OAAO,EACvB,MACF,CAEA,GAAIA,EAAK,OAAS,SAAWA,EAAK,OAAS,cAAe,CACxDN,EAAW,EAAI,EACf,GAAI,CACF,MAAMO,EAAI,MAAMH,EAAiB,aAAa,EAC9C,GAAIG,EAAE,GAAI,CACR,MAAMC,EAAO,MAAMD,EAAE,KAAA,EAEfE,EAAa,MAAM,QAAQD,CAAI,EAChCA,EAAwB,IAAKE,IAAqB,CAAE,GAAI,OAAOA,EAAE,IAAM,EAAE,EAAG,KAAM,OAAOA,EAAE,MAAQ,EAAE,GAAI,EAC1G,CAAA,EACJR,EAAWO,CAAU,EACjBA,EAAW,OAAS,KAAcA,EAAW,CAAC,EAAE,EAAE,CACxD,CACF,OAASE,EAAG,CACV,QAAQ,MAAM,mCAAoCA,CAAC,CACrD,CACF,CACF,CAAC,EACA,QAAQ,IAAMb,EAAW,EAAK,CAAC,CACpC,EAAG,CAAA,CAAE,EAEDD,EAAgBe,EAAAA,IAAC,MAAA,CAAI,UAAU,iCAAiC,SAAA,gBAAa,EAC5ElB,EAMHkB,EAAAA,IAAC,OAAI,UAAU,sDACb,eAAC,OAAA,CAAK,UAAU,uEACd,SAAAA,EAAAA,IAAC,MAAA,CAAI,UAAU,2BACb,SAAAC,EAAAA,KAAC,OAAI,UAAU,uFAAuF,MAAO,CAAE,OAAQ,qBACrH,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,iEAAiE,SAAA,eAAY,EAC1Fb,GAAWE,EAAQ,OAAS,GAC3BY,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACb,SAAA,CAAAD,EAAAA,IAAC,QAAA,CAAM,UAAU,mBAAmB,SAAA,wBAAqB,EACzDA,EAAAA,IAAC,SAAA,CAAO,MAAOlB,GAAW,GAAI,SAAUiB,GAAKhB,EAAWgB,EAAE,OAAO,KAAK,EAAG,UAAU,2BAChF,SAAAV,EAAQ,IAAI,GACXW,EAAAA,IAAC,SAAA,CAAkB,MAAO,EAAE,GAAK,SAAA,EAAE,IAAA,EAAtB,EAAE,EAAyB,CACzC,CAAA,CACH,CAAA,EACF,QAED,MAAA,CAAI,UAAU,uBACb,SAAAA,MAAC,OAAI,UAAU,wBAAwB,MAAO,CAAE,WAAY,SAAA,EAC1D,eAACE,EAAA,CAAc,QAAApB,EAAkB,EACnC,CAAA,CACF,CAAA,EACF,CAAA,CACF,EACF,EACF,EA5BIK,EAAgBa,EAAAA,IAAC,MAAA,CAAI,UAAU,+BAA+B,SAAA,8CAA2C,EACtGA,EAAAA,IAAC,MAAA,CAAI,UAAU,+BAA+B,SAAA,6BAA0B,CA6BnF"}