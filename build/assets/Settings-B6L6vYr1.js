import{r as c,j as e,f as g}from"./index-BlCxgRmJ.js";import{H as A,a as M}from"./index-fENnYS2p.js";import{u as W}from"./useI18n-BzDKbdEV.js";async function B(f){const n="=".repeat((4-f.length%4)%4),w=(f+n).replace(/-/g,"+").replace(/_/g,"/"),b=window.atob(w),N=new Uint8Array(b.length);for(let x=0;x<b.length;++x)N[x]=b.charCodeAt(x);return N}async function G(f){if(!("serviceWorker"in navigator))throw new Error("Service Worker non support√©");if(!("PushManager"in window))throw new Error("Push API non support√©e");const n=await navigator.serviceWorker.register("/sw.js");if(await Notification.requestPermission()!=="granted")throw new Error("Permission de notifications refus√©e");const b=await B(f);return{subscription:await n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:b}),registration:n}}async function q(){if(!("serviceWorker"in navigator))return;const f=await navigator.serviceWorker.getRegistration();if(!f)return;const n=await f.pushManager.getSubscription();n&&await n.unsubscribe()}const U=[{code:"fr",label:"Fran√ßais",emoji:"üá´üá∑"},{code:"en",label:"English",emoji:"üá¨üáß"}];function H({value:f,onChange:n}){const[w,b]=c.useState(!1),N=c.useRef(null),x=c.useRef(null);c.useEffect(()=>{function d(P){if(!x.current)return;const C=P.target;C&&x.current.contains(C)||C&&N.current&&N.current.contains(C)||b(!1)}function v(P){P.key==="Escape"&&b(!1)}return document.addEventListener("mousedown",d),document.addEventListener("touchstart",d),document.addEventListener("keydown",v),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("touchstart",d),document.removeEventListener("keydown",v)}},[]);const D=U.find(d=>d.code===f)||U[0];return e.jsxs("div",{className:"relative inline-block text-left w-full md:w-auto",children:[e.jsxs("button",{ref:N,type:"button",onClick:()=>b(d=>!d),"aria-haspopup":"menu","aria-expanded":w,className:"w-full md:w-auto flex items-center gap-2 justify-between px-3 py-2 bg-gray-100 rounded-md text-sm text-gray-700 hover:bg-gray-200",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base w-5",children:D.emoji}),e.jsx("span",{className:"truncate max-w-[10rem]",children:D.label})]}),e.jsx("svg",{className:"w-4 h-4 text-gray-500",viewBox:"0 0 20 20",fill:"none","aria-hidden":!0,children:e.jsx("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),w&&e.jsx("div",{ref:x,className:"absolute right-0 mt-2 w-full md:w-48 bg-white border rounded-md shadow-lg z-50",children:e.jsx("div",{className:"py-1",children:U.map(d=>e.jsxs("button",{onClick:()=>{n(d.code),b(!1)},className:`w-full text-left px-3 py-2 text-sm flex items-center gap-2 hover:bg-gray-50 ${d.code===f?"font-semibold":""}`,children:[e.jsx("span",{className:"w-5",children:d.emoji}),e.jsx("span",{className:"truncate",children:d.label})]},d.code))})})]})}const S="https://api.monsite.fr";function K({onClose:f}){const{t:n}=W(),[w,b]=c.useState(!1),[N,x]=c.useState(!1),[D,d]=c.useState(""),[v,P]=c.useState(""),[C,I]=c.useState(""),[R,_]=c.useState(""),[m,$]=c.useState(!1),[T,O]=c.useState(!1),[l,o]=c.useState(!1),[y,j]=c.useState([]),[k,E]=c.useState(!1),J=c.useCallback(async t=>{try{if(!t||t.length<3){j([]);return}const i=await fetch(`/api/geodata/positionstack?q=${encodeURIComponent(t)}&limit=12`);if(!i.ok)throw j([]),new Error("Impossible de r√©cup√©rer les suggestions");const s=(await i.json()).filter(u=>u.street||u.house_number||u.name&&/\d/.test(String(u.name)));j(s.slice(0,8))}catch(i){console.error("geodata fetch error",i),j([])}},[]),F=async t=>{j([]),E(!1);const i=[t.house_number,t.street].filter(Boolean).join(" ").trim(),h=t.city||t.name||"";L(s=>{const u=s?{...s}:null;if(!u)return u;if(u.role==="user"){const a=u;return{...u,address:i||a.address,city:h||a.city,postalCode:t.postcode||a.postalCode,region:t.state||a.region,country:t.country||a.country,lat:t.lat??null,lon:t.lon??null,geodataRaw:t.raw??t}}if(u.role==="parent"){const a=u;return{...u,address:i||a.address,city:h||a.city,postalCode:t.postcode||a.postalCode,region:t.state||a.region,country:t.country||a.country,lat:t.lat??null,lon:t.lon??null,geodataRaw:t.raw??t}}return u})},[r,L]=c.useState(null);c.useEffect(()=>{if(!r)return;const i=(s=>s&&(s.role==="user"||s.role==="parent")&&s.address||"")(r);if(!i||i.length<3){j([]);return}const h=setTimeout(()=>J(i),650);return()=>clearTimeout(h)},[r,J]),c.useEffect(()=>{let t=!0;return(async()=>{b(!0),d("");try{const h=await g(`${S}/user/me`,{credentials:"include"});if(!h.ok)throw new Error("Impossible de r√©cup√©rer l'utilisateur");const s=await h.json();if(s&&s.parentId){const u=await g(`${S}/parent/${encodeURIComponent(String(s.parentId))}`,{credentials:"include"});if(u.ok){const a=await u.json();if(!t)return;L({role:"parent",id:a.id,firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",phone:s&&s.phone?s.phone:a.phone||"",address:s&&s.address?s.address:a.address||"",postalCode:s&&s.postalCode?s.postalCode:a.postalCode||"",city:s&&s.city?s.city:a.city||"",region:s&&s.region?s.region:a.region||"",country:s&&s.country?s.country:a.country||"",birthDate:a.birthDate?new Date(a.birthDate).toISOString().slice(0,10):s&&s.birthDate?new Date(s.birthDate).toISOString().slice(0,10):"",lat:s&&typeof s.lat<"u"?s.lat:a.lat??null,lon:s&&typeof s.lon<"u"?s.lon:a.lon??null,geodataRaw:s&&typeof s.geodataRaw<"u"?s.geodataRaw:a.geodataRaw??null});return}}if(s&&s.nannyId){const u=await g(`${S}/nannies/${encodeURIComponent(String(s.nannyId))}`,{credentials:"include"});if(u.ok){const a=await u.json();if(!t)return;L({role:"nanny",id:a.id,name:a.name||"",availability:a.availability||"",experience:a.experience||0,contact:a.contact||"",email:a.email||"",birthDate:a.birthDate?new Date(a.birthDate).toISOString().slice(0,10):""});return}}if(s&&s.email)try{const u=await g(`${S}/parent/by-email?email=${encodeURIComponent(String(s.email))}`,{credentials:"include"});if(u.ok){const a=await u.json();if(!t)return;L({role:"parent",id:a.id,firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",phone:s&&s.phone?s.phone:a.phone||"",address:s&&s.address?s.address:a.address||"",postalCode:s&&s.postalCode?s.postalCode:a.postalCode||"",city:s&&s.city?s.city:a.city||"",region:s&&s.region?s.region:a.region||"",country:s&&s.country?s.country:a.country||"",birthDate:a.birthDate?new Date(a.birthDate).toISOString().slice(0,10):s&&s.birthDate?new Date(s.birthDate).toISOString().slice(0,10):"",lat:s&&typeof s.lat<"u"?s.lat:a.lat??null,lon:s&&typeof s.lon<"u"?s.lon:a.lon??null,geodataRaw:s&&typeof s.geodataRaw<"u"?s.geodataRaw:a.geodataRaw??null});return}}catch{}s&&L({role:"user",id:s.id,name:s.name||"",email:s.email||"",phone:s.phone||"",address:s.address||"",postalCode:s.postalCode||"",city:s.city||"",region:s.region||"",country:s.country||"",birthDate:s.birthDate?new Date(s.birthDate).toISOString().slice(0,10):"",lat:s.lat??null,lon:s.lon??null,geodataRaw:s.geodataRaw??null})}catch(h){const s=h instanceof Error?h.message:String(h);d(s)}finally{t&&b(!1)}})(),()=>{t=!1}},[]);const p=(t,i)=>L(h=>h&&{...h,[t]:i}),z=async()=>{if(r){x(!0),d("");try{if(r.role==="parent"){const t=r,i={firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.phone,address:t.address,postalCode:t.postalCode,city:t.city,region:t.region,country:t.country};if(t.birthDate&&(i.birthDate=t.birthDate),typeof t.lat<"u"&&(i.lat=t.lat),typeof t.lon<"u"&&(i.lon=t.lon),t.geodataRaw&&(i.geodataRaw=t.geodataRaw),!(await g(`${S}/parent/${encodeURIComponent(String(r.id))}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Erreur lors de la mise √† jour du parent")}else if(r.role==="nanny"){const t={name:r.name,availability:r.availability,experience:Number(r.experience||0),contact:r.contact,email:r.email,birthDate:r.birthDate||null};if(!(await g(`${S}/nannies/${encodeURIComponent(String(r.id))}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("Erreur lors de la mise √† jour de la nounou")}else{const t=r,i={name:t.name,email:t.email,phone:t.phone,address:t.address,postalCode:t.postalCode,city:t.city,region:t.region,country:t.country};t.birthDate&&(i.birthDate=t.birthDate),typeof t.lat<"u"&&(i.lat=t.lat),typeof t.lon<"u"&&(i.lon=t.lon),t.geodataRaw&&(i.geodataRaw=t.geodataRaw);const h=await g(`${S}/user/me`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!h.ok){const s=await h.text().catch(()=>"");throw new Error(s||"Impossible de mettre √† jour l'utilisateur")}}if(v||C||R){if(!v||!C||!R)throw new Error(n("settings.password.all_required"));if(C!==R)throw new Error(n("settings.password.mismatch"));if(!(await g(`${S}/user/password`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPassword:v,newPassword:C})})).ok)throw new Error("Erreur lors du changement de mot de passe")}f(),window.location.reload()}catch(t){const i=t instanceof Error?t.message:String(t);d(i)}finally{x(!1)}}};return w?e.jsx("div",{className:"text-center py-6",children:n("loading")}):r?e.jsxs("div",{children:[r.role==="parent"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.firstName")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.firstName,onChange:t=>p("firstName",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.lastName")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.lastName,onChange:t=>p("lastName",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.email")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.email,onChange:t=>p("email",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.phone")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.phone,onChange:t=>p("phone",t.target.value)})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"text-sm",children:n("parent.form.address")||"Adresse"}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.address||"",onChange:t=>{p("address",t.target.value),E(!0)}}),k&&y&&y.length>0&&e.jsx("div",{className:"border rounded bg-white mt-1 max-h-48 overflow-auto",children:y.map((t,i)=>e.jsxs("div",{className:"px-2 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>F(t),children:[(t.house_number||"")+" "+(t.street||t.name||"")," ",t.postcode?` - ${t.postcode}`:""]},i))})]})]}),r.role==="nanny"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.name")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.name,onChange:t=>p("name",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.email")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.email,onChange:t=>p("email",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.contact")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.contact,onChange:t=>p("contact",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.experience")}),e.jsx("input",{type:"number",className:"border rounded px-2 py-1 w-full",value:String(r.experience||0),onChange:t=>p("experience",Number(t.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.availability")}),e.jsxs("select",{className:"border rounded px-2 py-1 w-full",value:r.availability,onChange:t=>p("availability",t.target.value),children:[e.jsx("option",{value:"Disponible",children:n("availability.available")}),e.jsx("option",{value:"En_cong√©",children:n("availability.on_leave")}),e.jsx("option",{value:"Maladie",children:n("availability.sick")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.birthDate")}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 w-full",value:r.birthDate||"",onChange:t=>p("birthDate",t.target.value)})]})]}),r.role==="user"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.name")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.name,onChange:t=>p("name",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.email")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.email,onChange:t=>p("email",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.phone")}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.phone||"",onChange:t=>p("phone",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("parent.form.postalCode")||"Code postal"}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.postalCode||"",onChange:t=>p("postalCode",t.target.value)})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"text-sm",children:n("parent.form.address")||"Adresse"}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.address||"",onChange:t=>{p("address",t.target.value),E(!0)}}),k&&y&&y.length>0&&e.jsx("div",{className:"border rounded bg-white mt-1 max-h-48 overflow-auto",children:y.map((t,i)=>e.jsxs("div",{className:"px-2 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>F(t),children:[(t.house_number||"")+" "+(t.street||t.name||"")," ",t.postcode?` - ${t.postcode}`:""]},i))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("parent.form.city")||"Ville"}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.city||"",onChange:t=>p("city",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("parent.form.region")||"R√©gion"}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.region||"",onChange:t=>p("region",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("parent.form.country")||"Pays"}),e.jsx("input",{className:"border rounded px-2 py-1 w-full",value:r.country||"",onChange:t=>p("country",t.target.value)})]})]}),e.jsxs("div",{className:"border-t mt-4 pt-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:n("settings.change_password")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.oldPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m?"text":"password",className:"border rounded px-2 py-1 w-full pr-10",value:v,onChange:t=>P(t.target.value)}),e.jsx("button",{type:"button",onClick:()=>$(t=>!t),className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 p-1","aria-label":m?"Masquer l'ancien mot de passe":"Afficher l'ancien mot de passe",children:m?e.jsx(A,{className:"w-5 h-5"}):e.jsx(M,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.newPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:T?"text":"password",className:"border rounded px-2 py-1 w-full pr-10",value:C,onChange:t=>I(t.target.value)}),e.jsx("button",{type:"button",onClick:()=>O(t=>!t),className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 p-1","aria-label":T?"Masquer le nouveau mot de passe":"Afficher le nouveau mot de passe",children:T?e.jsx(A,{className:"w-5 h-5"}):e.jsx(M,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:n("label.confirmPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:l?"text":"password",className:"border rounded px-2 py-1 w-full pr-10",value:R,onChange:t=>_(t.target.value)}),e.jsx("button",{type:"button",onClick:()=>o(t=>!t),className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 p-1","aria-label":l?"Masquer la confirmation":"Afficher la confirmation",children:l?e.jsx(A,{className:"w-5 h-5"}):e.jsx(M,{className:"w-5 h-5"})})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{className:"bg-blue-600 text-white px-3 py-2 rounded",onClick:z,disabled:N,children:n(N?"settings.saving":"settings.save")}),e.jsx("button",{className:"bg-gray-200 px-3 py-2 rounded",onClick:f,children:n("settings.cancel")})]}),D&&e.jsx("div",{className:"text-red-600 text-sm mt-2",children:D})]}):e.jsx("div",{className:"text-sm text-gray-500",children:n("no_profile")})}function V(){const{t:f}=W(),[n,w]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"flex-1 bg-[#a9ddf2] text-[#0b5566] px-4 py-2 rounded-lg font-medium hover:bg-[#cfeef9]",onClick:()=>w(!0),children:f("settings.profile.edit")}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center bg-black/30 backdrop-blur-sm overflow-auto py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-full max-w-2xl relative",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl",children:"√ó"}),e.jsx("h2",{className:"text-lg font-bold mb-4 text-center",children:f("settings.profile.edit")}),e.jsx(K,{onClose:()=>w(!1)})]})})]})}function Y(){const[f,n]=c.useState(!1);c.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const l=window.matchMedia("(max-height: 600px) and (orientation: landscape)"),o=()=>n(!!l.matches);return o(),typeof l.addEventListener=="function"?l.addEventListener("change",o):l.addListener(o),window.addEventListener("resize",o),window.addEventListener("orientationchange",o),()=>{try{typeof l.removeEventListener=="function"?l.removeEventListener("change",o):l.removeListener(o)}catch{}window.removeEventListener("resize",o),window.removeEventListener("orientationchange",o)}},[]);const[w,b]=c.useState(!0),[N,x]=c.useState(null),[D,d]=c.useState(null),[v,P]=c.useState(()=>{try{return localStorage.getItem("site_language")==="en"?"en":"fr"}catch{return"fr"}});c.useEffect(()=>{try{document.documentElement.lang=v==="en"?"en":"fr",localStorage.setItem("site_language",v),document.cookie=`site_language=${v};path=/;max-age=${3600*24*365}`}catch{}},[v]);const[C,I]=c.useState(!1),[R,_]=c.useState(""),{t:m,setLocale:$}=W(),[T,O]=c.useState(!1);return c.useEffect(()=>{(async()=>{try{const l=await g(`${S}/user/me`,{credentials:"include"});if(!l.ok)return;const o=await l.json();o&&(o.role==="admin"||typeof o.role=="string"&&o.role.toLowerCase().includes("super"))&&O(!0)}catch{}})()},[]),c.useEffect(()=>{(async()=>{try{const l=await g(`${S}/user/me`,{credentials:"include"});if(l.ok){const o=await l.json();o&&typeof o.notifyByEmail=="boolean"&&b(!!o.notifyByEmail)}}catch{}})(),(async()=>{if(!("serviceWorker"in navigator)||!("PushManager"in window)){x(!1);return}try{const l=await navigator.serviceWorker.getRegistration();if(!l)return x(!1);const o=await l.pushManager.getSubscription();x(!!o);try{const y=await g("/api/push-subscriptions/me",{credentials:"include"});if(y.ok){const j=await y.json();if(o&&Array.isArray(j.subscriptions)){const k=j.subscriptions.find(E=>E.subscription&&E.subscription.endpoint===o.endpoint);k&&k.id&&d(k.id)}}}catch{}}catch{x(!1)}})()},[]),e.jsx("div",{className:`relative z-0 min-h-screen bg-[#fcfcff] p-4 ${f?"":"md:pl-64"} w-full`,children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold mb-6 tracking-tight",style:{color:"#0b5566"},children:m("settings.title")}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 items-stretch",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow p-4 flex flex-col justify-between h-full",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:m("settings.email.title")}),e.jsx("div",{className:"text-gray-500 text-sm",children:m("settings.email.desc")})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:async l=>{const o=l.target.checked;b(o);try{await g(`${S}/user/me`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({notifyByEmail:o})})}catch{}},className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-[#a9ddf2] rounded-full peer peer-checked:bg-[#0b5566] after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-5"})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow p-4 flex flex-col justify-between h-full",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:m("settings.push.title")}),e.jsx("div",{className:"text-gray-500 text-sm",children:m("settings.push.desc")})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!!N,onChange:async l=>{const o=l.target.checked;try{if(!o){try{await q()}catch{}try{D?await g(`/api/push-subscriptions/${encodeURIComponent(D)}`,{method:"DELETE",credentials:"include"}):await g("/api/push-subscriptions/me",{method:"DELETE",credentials:"include"})}catch(k){console.error("Failed to delete subscription on server",k)}x(!1),d(null);return}const y="BLFJbu-zMK1zWpjj95TJsTx7bp-NSJcXdeAqoikosTEtWeGVgHt1NEGeWydS9k6pfLz6iFbZu9_1FTyS4v27FeQ",{subscription:j}=await G(y);try{const k=await g("/api/push-subscriptions/save",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:j})});if(k.ok){const E=await k.json();E&&E.id&&d(E.id)}}catch{}x(!0)}catch(y){const j=y instanceof Error?y.message:String(y);alert("Impossible d'activer les notifications push: "+j)}},className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-[#a9ddf2] rounded-full peer peer-checked:bg-[#0b5566] after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-5"})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"md:flex-1 pr-3",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:m("settings.language.title")}),e.jsx("div",{className:"text-gray-500 text-sm",children:m("settings.language.desc")})]}),e.jsx("div",{className:"md:flex-none w-full md:w-auto",children:e.jsx("div",{className:"max-w-[320px] md:max-w-[420px]",children:e.jsx(H,{value:v,onChange:l=>{P(l),$(l==="en"?"en":"fr")}})})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow p-4 md:col-span-2",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-4",children:"Gestion du compte"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{className:"flex-1 bg-[#fcdcdf] text-[#7a2a2a] font-semibold rounded-lg px-4 py-2 shadow hover:bg-[#fbd5d8]",onClick:()=>I(!0),children:m("settings.account.delete")}),e.jsx(V,{})]})]}),T&&e.jsxs("div",{className:"bg-white rounded-2xl shadow p-4 flex flex-col justify-between h-full md:col-span-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800",children:["üßæ ",m("admin.emaillogs.title")]}),e.jsx("div",{className:"text-gray-500 text-sm",children:m("admin.emaillogs.description")})]}),e.jsx("div",{className:"mt-4 flex items-center gap-3",children:e.jsx("button",{onClick:()=>{window.location.href="/admin/emaillogs"},className:"bg-[#a9ddf2] text-[#0b5566] px-4 py-2 rounded-lg font-medium hover:bg-[#cfeef9]",children:m("admin.emaillogs.title")})})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx("button",{className:"w-full bg-[#a9ddf2] text-[#0b5566] px-4 py-2 rounded-lg font-medium hover:bg-[#cfeef9]",style:{marginTop:"8px"},onClick:async()=>{try{await g("/api/auth/logout",{method:"POST",credentials:"include"})}catch{}try{const l=(()=>{try{return localStorage.getItem("cookie_consent")}catch{return null}})();try{localStorage.clear()}catch{}if(l)try{localStorage.setItem("cookie_consent",l)}catch{}}catch{}try{const l=(()=>{try{return sessionStorage.getItem("cookie_consent")}catch{return null}})();try{sessionStorage.clear()}catch{}if(l)try{sessionStorage.setItem("cookie_consent",l)}catch{}}catch{}try{document.cookie.split(";").forEach(function(l){const o=l.split("=")[0].trim();document.cookie=o+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/",document.cookie=o+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain="+window.location.hostname})}catch{}window.location.href="/login"},children:m("settings.logout")})})]})]}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-full max-w-xs flex flex-col items-center relative",children:[e.jsx("button",{type:"button",onClick:()=>I(!1),className:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl",children:"√ó"}),e.jsx("h2",{className:"text-lg font-bold mb-4 text-center text-red-700",children:m("settings.delete_confirm.title")}),e.jsx("p",{className:"text-gray-700 text-center mb-4",children:m("settings.delete_confirm.body")}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{type:"button",className:"bg-gray-300 px-3 py-1 rounded w-full",onClick:()=>I(!1),children:m("settings.cancel")}),e.jsx("button",{type:"button",className:"bg-red-500 text-white px-3 py-1 rounded w-full font-bold",onClick:async()=>{if(_(""),!(await g(`${S}/user`,{method:"DELETE",credentials:"include"})).ok){_(m("settings.delete_error"));return}I(!1),window.location.href="/login"},children:m("settings.delete_confirm.confirm")})]}),R&&e.jsx("div",{className:"text-red-600 text-xs mt-2 text-center w-full",children:R})]})})]})})}export{Y as default};
//# sourceMappingURL=Settings-B6L6vYr1.js.map
