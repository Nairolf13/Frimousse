import{b as K,r as d,f as m,j as t,g as R,s as $,D as E}from"./index-BlCxgRmJ.js";import{u as B}from"./useI18n-BzDKbdEV.js";import{S as H}from"./Sidebar-Gcre9kAW.js";import"./index-fENnYS2p.js";const o="https://api.monsite.fr",Q=[{key:"G1",label:"children.group.G1"},{key:"G2",label:"children.group.G2"},{key:"G3",label:"children.group.G3"},{key:"G4",label:"children.group.G4"},{key:"G5",label:"children.group.G5"},{key:"G6",label:"children.group.G6"}],V=[{key:"Nounou_Senior",label:"nanny.role.senior"},{key:"Responsable",label:"nanny.role.manager"},{key:"Stagiaire",label:"nanny.role.trainee"},{key:"Remplacante",label:"nanny.role.substitute"},{key:"Autre",label:"nanny.role.other"}],X={haute:"bg-[#ffeaea] border-[#ffdddd]",moyenne:"bg-[#fff7e6] border-[#fff1d6]",basse:"bg-[#a9ddf2] border-[#cfeef9]"},Y={haute:"reports.priority.haute",moyenne:"reports.priority.moyenne",basse:"reports.priority.basse"},Z={incident:"reports.type.incident",comportement:"reports.type.comportement",soin:"reports.type.soin"};function se(){const{user:D}=K(),{t:s,locale:G}=B();d.useEffect(()=>{let e=!0;const n=`${o}/children`,l=`${o}/nannies`;async function i(){try{const c=R(n),v=R(l);c&&g(c),v&&b(v);const h=[];c?h.push(Promise.resolve(new Response(JSON.stringify(c)))):h.push(m(`${o}/children`)),v?h.push(Promise.resolve(new Response(JSON.stringify(v)))):h.push(m(`${o}/nannies`));const[z,M]=await Promise.all(h);if(!e)return;try{const p=await z.json();g(Array.isArray(p)?p:[]),$(n,Array.isArray(p)?p:[],E)}catch{g([])}try{const p=await M.json();b(Array.isArray(p)?p:[]),$(l,Array.isArray(p)?p:[],E)}catch{b([])}}catch{e&&(g([]),b([]))}}return i(),()=>{e=!1}},[]);const[N,u]=d.useState([]);d.useEffect(()=>{m(`${o}/reports`).then(e=>e.json()).then(e=>u(Array.isArray(e)?e:[])).catch(()=>u([]))},[]);const T=N.length,O=N.filter(e=>{if(!e.date)return!1;const n=new Date(e.date),l=new Date,i=new Date(l);i.setHours(0,0,0,0),i.setDate(l.getDate()-(l.getDay()+6)%7);const c=new Date(i);return c.setDate(i.getDate()+6),n>=i&&n<=c}).length,[L,q]=d.useState(!1),[w,P]=d.useState(""),[I,_]=d.useState(""),F=N.filter(e=>{let n=!0;if(L){if(!e.date)return!1;const l=new Date(e.date),i=new Date,c=new Date(i);c.setDate(i.getDate()-30),n=n&&l>=c&&l<=i}if(w&&(n=n&&e.type===w),I.trim()){const l=I.trim().toLowerCase();n=n&&!!(e.child?.name&&e.child.name.toLowerCase().includes(l)||e.summary&&e.summary.toLowerCase().includes(l)||e.details&&e.details.toLowerCase().includes(l))}return n}),[U,y]=d.useState(!1),[x,f]=d.useState(null),[a,r]=d.useState({priority:"moyenne",type:"incident",status:"en_attente",childId:"",childName:"",childAge:3,childGroup:"",nannyId:"",nannyName:"",nannyRole:"",summary:"",details:"",date:new Date().toISOString().split("T")[0],time:"14:00",duration:"",childrenInvolved:""}),[S,g]=d.useState([]),[C,b]=d.useState([]),j=S.find(e=>e.id===a.childId),k=j&&Array.isArray(j.nannyIds)&&j.nannyIds.length>0?C.filter(e=>j.nannyIds.includes(e.id)):C;d.useEffect(()=>{if(!a.nannyId)return;k.some(n=>n.id===a.nannyId)||r(n=>({...n,nannyId:"",nannyName:"",nannyRole:""}))},[a.childId,a.nannyId,k]);const[A,J]=d.useState(!1);d.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const e=window.matchMedia("(max-height: 600px) and (orientation: landscape)"),n=()=>J(!!e.matches);return n(),typeof e.addEventListener=="function"?e.addEventListener("change",n):e.addListener(n),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{try{typeof e.removeEventListener=="function"?e.removeEventListener("change",n):e.removeListener(n)}catch{}window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),d.useEffect(()=>{m(`${o}/children`).then(e=>e.json()).then(e=>g(e)).catch(()=>g([])),m(`${o}/nannies`).then(e=>e.json()).then(e=>b(e)).catch(()=>b([]))},[]);async function W(e){e.preventDefault();const n={priority:a.priority,type:a.type,status:a.status,childId:a.childId,nannyId:a.nannyId,summary:a.summary,details:a.details,date:a.date,time:a.time,duration:a.type==="comportement"?a.duration:void 0,childrenInvolved:a.type==="comportement"&&Number(a.childrenInvolved)||void 0};await m(`${o}/reports`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),m(`${o}/reports`).then(l=>l.json()).then(l=>u(l)).catch(()=>u([])),y(!1),f(null),r({priority:"moyenne",type:"incident",status:"en_attente",childId:"",childName:"",childAge:3,childGroup:"",nannyId:"",nannyName:"",nannyRole:"",summary:"",details:"",date:new Date().toISOString().split("T")[0],time:"14:00",duration:"",childrenInvolved:""})}return t.jsxs("div",{className:"min-h-screen bg-[#f7f8fa] flex flex-col md:flex-row",children:[!A&&t.jsx(H,{}),t.jsx("main",{className:`flex-1 flex flex-col items-center py-4 px-2 md:py-8 md:px-2 ${A?"":"md:ml-64"}`,children:t.jsxs("div",{className:"w-full max-w-5xl mx-auto",children:[t.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold mb-1 tracking-tight",style:{color:"#0b5566"},children:s("page.reports")}),t.jsx("div",{className:"text-base md:text-lg font-medium mb-4 md:mb-6",style:{color:"#08323a"},children:s("page.reports.description")}),t.jsxs("div",{className:"flex flex-col md:flex-row flex-wrap gap-2 mb-4 md:mb-6 items-stretch md:items-center",children:[t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsxs("button",{className:`flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg border text-sm md:text-base font-medium ${L?"bg-[#a9ddf2] border-[#fcdcdf] text-[#0b5566]":"bg-white border-gray-100 text-gray-500"}`,onClick:e=>{e.preventDefault(),q(n=>!n)},children:[t.jsx("span",{children:"📅"})," ",s("reports.filter.last30")]}),t.jsxs("select",{value:w,onChange:e=>P(e.target.value),className:"px-3 md:px-4 py-2 rounded-lg border border-gray-100 bg-white text-sm md:text-base font-medium",children:[t.jsx("option",{value:"",children:s("reports.filter.allTypes")}),t.jsx("option",{value:"incident",children:s("reports.type.incident")}),t.jsx("option",{value:"comportement",children:s("reports.type.comportement")}),t.jsx("option",{value:"soin",children:s("reports.type.soin")})]}),t.jsx("input",{type:"text",placeholder:s("reports.search.placeholder"),value:I,onChange:e=>_(e.target.value),className:"px-3 md:px-4 py-2 rounded-lg border border-gray-100 bg-white text-sm md:text-base w-full md:w-64"})]}),!(D&&D.role==="parent")&&t.jsx("button",{className:"bg-[#0b5566] text-white px-4 md:px-5 py-2 rounded-lg font-bold shadow hover:bg-[#08323a] transition text-sm md:text-base mt-2 md:mt-0 md:ml-2 w-full md:w-auto",onClick:()=>{f(null),r({priority:"moyenne",type:"incident",status:"en_attente",childId:"",childName:"",childAge:3,childGroup:"",nannyId:"",nannyName:"",nannyRole:"",summary:"",details:"",date:new Date().toISOString().split("T")[0],time:"14:00",duration:"",childrenInvolved:""}),y(!0)},children:s("reports.new")})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 md:gap-4 mb-4 md:mb-6",children:[t.jsxs("div",{className:"bg-white rounded-xl shadow border border-gray-100 p-3 md:p-4 flex flex-col items-center",children:[t.jsx("div",{className:"text-2xl md:text-3xl font-extrabold",style:{color:"#0b5566"},children:T}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s("reports.card.total")})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow border border-gray-100 p-3 md:p-4 flex flex-col items-center",children:[t.jsx("div",{className:"text-xl md:text-2xl font-extrabold",style:{color:"#08323a"},children:O}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s("reports.card.week")})]})]}),t.jsx("div",{className:"flex flex-col gap-4 md:gap-6",children:F.map(e=>{const n=e.child?.initials||(e.child?.name?e.child.name.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2):""),l=e.nanny?.initials||(e.nanny?.name?e.nanny.name.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2):"");return t.jsxs("div",{className:`rounded-xl shadow border-2 ${X[e.priority]||""} p-0 overflow-hidden`,style:{minWidth:0},children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between px-4 md:px-6 py-2",children:[t.jsxs("div",{className:"flex items-center gap-2 md:gap-3 mb-2 sm:mb-0",children:[t.jsx("span",{className:"px-2 md:px-3 py-1 rounded-lg font-bold text-xs",style:{background:e.type==="incident"?"#ffeaea":e.type==="comportement"?"#fff7e6":"#a9ddf2",color:e.type==="incident"?"#7a2a2a":e.type==="comportement"?"#856400":"#08323a"},children:s(Z[e.type]||e.type)}),t.jsx("span",{className:"px-2 md:px-3 py-1 rounded-lg font-bold text-xs",style:{background:e.priority==="haute"?"#dc2626":e.priority==="moyenne"?"#f59e0b":"#0b5566",color:"#ffffff"},children:s(Y[e.priority]||e.priority)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-bold border",style:{background:"#a9ddf2",color:"#08323a",borderColor:"#cfeef9"},children:n}),t.jsx("span",{className:"font-bold text-xs md:text-sm ml-1",style:{color:"#08323a"},children:e.child?.name}),t.jsx("span",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-bold border",style:{background:"#fff7e6",color:"#856400",borderColor:"#fff1d6"},children:l}),t.jsx("span",{className:"font-bold text-xs md:text-sm ml-1",style:{color:"#856400"},children:e.nanny?.name}),t.jsx("div",{className:"relative ml-2",children:t.jsx("button",{"aria-label":"Actions",className:"text-gray-500 hover:text-gray-800",onClick:()=>{f(e),r({priority:e.priority||"moyenne",type:e.type||"incident",status:e.status||"en_attente",childId:e.child?.id||e.child?.id||"",childName:e.child?.name||"",childAge:e.child?.age||3,childGroup:e.child?.group||"",nannyId:e.nanny?.id||e.nanny?.id||"",nannyName:e.nanny?.name||"",nannyRole:e.nanny?.role||"",summary:e.summary||"",details:e.details||"",date:e.date?new Date(e.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],time:e.time||"14:00",duration:e.duration||"",childrenInvolved:e.childrenInvolved?String(e.childrenInvolved):""}),y(!0)},children:"⋮"})})]})]}),t.jsxs("div",{className:"px-4 md:px-6 pb-4",children:[t.jsx("div",{className:"font-bold text-gray-700 mb-1 text-sm md:text-base",children:e.type==="incident"?s("reports.summary.incident"):e.type==="comportement"?s("reports.summary.comportement"):s("reports.summary.soin")}),t.jsx("div",{className:"text-gray-700 text-sm md:text-base mb-2",children:e.summary}),e.type==="comportement"&&t.jsxs("div",{className:"flex gap-4 md:gap-6 items-center text-xs text-gray-500 mt-2 flex-wrap",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{children:"⏱️"})," ",s("reports.card.duration")," : ",e.duration]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{children:"👧"})," ",s("reports.card.childrenInvolved",{n:String(e.childrenInvolved??0)})]})]}),t.jsxs("div",{className:"flex flex-col items-end mt-4",children:[t.jsxs("span",{className:"text-xs italic",style:{color:"#08323a"},children:["Rapport établi par ",t.jsx("span",{className:"font-bold",style:{color:"#856400"},children:e.nanny?.name})," concernant ",t.jsx("span",{className:"font-bold",style:{color:"#08323a"},children:e.child?.name})]}),t.jsx("span",{className:"text-xs text-gray-500",children:(()=>{let i;try{i=new Date(e.date)}catch{i=null}if(i&&!isNaN(i.getTime())){const c={day:"2-digit",month:"long",year:"numeric"},v=i.toLocaleDateString(G||"fr-FR",c),h=e.time?e.time.slice(0,5).replace(":","h"):"";return`${v}${h?" "+s("common.at")+" "+h:""}`}return`${e.date}${e.time?" à "+e.time:""}`})()})]})]})]},e.id)})}),U&&t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md relative flex flex-col gap-6 animate-fade-in",style:{border:"4px solid #fcdcdf"},children:[t.jsx("button",{onClick:()=>y(!1),className:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl",children:"×"}),t.jsx("h2",{className:"text-2xl font-extrabold mb-2 text-center",style:{color:"#0b5566"},children:s(x?"reports.modal.title.edit":"reports.modal.title.new")}),t.jsxs("form",{className:"space-y-3",onSubmit:async e=>{if(x){e.preventDefault();const n={priority:a.priority,type:a.type,status:a.status,childId:a.childId,nannyId:a.nannyId,summary:a.summary,details:a.details,date:a.date,time:a.time,duration:a.type==="comportement"?a.duration:void 0,childrenInvolved:a.type==="comportement"&&Number(a.childrenInvolved)||void 0};await m(`${o}/reports/${x.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),m(`${o}/reports`).then(l=>l.json()).then(l=>u(l)).catch(()=>u([])),y(!1),f(null)}else await W(e)},children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("select",{value:a.priority,onChange:e=>r(n=>({...n,priority:e.target.value})),className:"border rounded px-3 py-2 w-1/2",children:[t.jsx("option",{value:"haute",children:s("reports.priority.haute")}),t.jsx("option",{value:"moyenne",children:s("reports.priority.moyenne")}),t.jsx("option",{value:"basse",children:s("reports.priority.basse")})]}),t.jsxs("select",{value:a.type,onChange:e=>r(n=>({...n,type:e.target.value})),className:"border rounded px-3 py-2 w-1/2",children:[t.jsx("option",{value:"incident",children:s("reports.type.incident")}),t.jsx("option",{value:"comportement",children:s("reports.type.comportement")}),t.jsx("option",{value:"soin",children:s("reports.type.soin")})]})]}),t.jsxs("select",{value:a.childId,onChange:e=>{const n=S.find(l=>l.id===e.target.value);r(l=>({...l,childId:n?n.id:"",childName:n?n.name:"",childAge:n?Number(n.age):3,childGroup:n?n.group:""}))},className:"border rounded px-3 py-2 w-full",required:!0,children:[t.jsx("option",{value:"",children:s("reports.field.child")}),S.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"number",min:1,max:18,placeholder:s("label.age")||"Âge",value:a.childAge,onChange:e=>r(n=>({...n,childAge:Number(e.target.value)})),className:"border rounded px-3 py-2 w-1/2",required:!0}),t.jsxs("select",{value:a.childGroup,onChange:e=>r(n=>({...n,childGroup:e.target.value})),className:"border rounded px-3 py-2 w-1/2",required:!0,children:[t.jsx("option",{value:"",children:s("reports.field.group")}),Q.map(e=>t.jsx("option",{value:e.key,children:s(e.label)},e.key))]})]}),t.jsxs("select",{value:a.nannyId,onChange:e=>{const n=C.find(l=>l.id===e.target.value);r(l=>({...l,nannyId:n?n.id:"",nannyName:n?n.name:"",nannyRole:n?n.role:""}))},className:"border rounded px-3 py-2 w-full",required:!0,children:[t.jsx("option",{value:"",children:s("reports.field.nanny")}),k.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("select",{value:a.nannyRole,onChange:e=>r(n=>({...n,nannyRole:e.target.value})),className:"border rounded px-3 py-2 w-full",required:!0,children:[t.jsx("option",{value:"",children:s("reports.field.role")}),V.map(e=>t.jsx("option",{value:e.key,children:s(e.label)},e.key))]}),t.jsx("input",{type:"date",value:a.date,onChange:e=>r(n=>({...n,date:e.target.value})),className:"border rounded px-3 py-2 w-full",required:!0}),t.jsx("input",{type:"time",value:a.time,onChange:e=>r(n=>({...n,time:e.target.value})),className:"border rounded px-3 py-2 w-full",required:!0}),t.jsx("textarea",{placeholder:s("reports.field.summary"),value:a.summary,onChange:e=>r(n=>({...n,summary:e.target.value})),className:"border rounded px-3 py-2 w-full",required:!0}),a.type==="comportement"&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",placeholder:s("reports.field.duration")||"Durée",value:a.duration,onChange:e=>r(n=>({...n,duration:e.target.value})),className:"border rounded px-3 py-2 w-1/2"}),t.jsx("input",{type:"number",min:1,placeholder:s("reports.field.childrenInvolved")||"Nb enfants impliqués",value:a.childrenInvolved,onChange:e=>r(n=>({...n,childrenInvolved:e.target.value})),className:"border rounded px-3 py-2 w-1/2"})]}),t.jsxs("div",{className:"flex gap-2 mt-2",children:[t.jsx("button",{type:"submit",className:"bg-[#0b5566] text-white px-4 py-2 rounded hover:bg-[#08323a] transition",children:s(x?"reports.save":"reports.create")}),x&&t.jsx("button",{type:"button",onClick:async()=>{x&&(await m(`${o}/reports/${x.id}`,{method:"DELETE"}),m(`${o}/reports`).then(e=>e.json()).then(e=>u(e)).catch(()=>u([])),y(!1),f(null))},className:"bg-red-500 text-white px-4 py-2 rounded",children:s("reports.delete")}),t.jsx("button",{type:"button",onClick:()=>{y(!1),f(null)},className:"bg-gray-300 px-4 py-2 rounded",children:s("reports.cancel")})]})]})]})})]})})]})}export{se as default};
//# sourceMappingURL=ReportsPage-CDswdsUx.js.map
