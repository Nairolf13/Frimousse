import{r as o,b as xe,j as e,f as C,g as te,s as he}from"./index-BlCxgRmJ.js";import{u as Ie}from"./useI18n-BzDKbdEV.js";/* empty css                          */const j="https://api.monsite.fr";function Le(){const v=new Date;return`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}`}function De(v){if(!v||typeof v!="object")return;const S=v,n=S.prescriptionUrl??S.prescription_url;return typeof n=="string"?n:void 0}function Ee({childId:v}){const{user:S}=xe(),n="https://api.monsite.fr",[M,I]=o.useState(null),[L,A]=o.useState(!1);o.useEffect(()=>{let N=!0;async function l(){try{const h=await fetch(`${n}/children/${v}/photo-consent`,{credentials:"include"});if(!N)return;if(!h.ok)return I(!1);const P=await h.json();I(!!P.consent)}catch(h){console.error("Failed to load photo consent",h instanceof Error?h.message:String(h))}}return S&&S.role==="parent"&&l(),()=>{N=!1}},[v,S,n]);const K=async()=>{A(!0);try{const N=await fetch(`${n}/children/${v}/photo-consent`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({consent:!M})});if(!N.ok){const h=await N.json().catch(()=>({}));alert(h.message||"Erreur lors de la mise à jour du consentement");return}const l=await N.json();I(!!l.consent)}catch(N){console.error("Failed to toggle consent",N instanceof Error?N.message:String(N))}finally{A(!1)}};return!S||S.role!=="parent"?null:M===null?e.jsx("div",{className:"text-sm text-gray-500",children:"Chargement du consentement..."}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:K,disabled:L}),e.jsx("span",{className:"text-sm",children:"Autoriser les photos"})]}),e.jsx("span",{className:"text-xs text-gray-400",children:M?"Autorisé":"Non autorisé"})]})}const B={name:"",age:0,sexe:"masculin",parentName:"",parentContact:"",parentMail:"",parentId:void 0,allergies:"",group:"",present:!0,newThisMonth:!1,birthDate:void 0,nannyIds:[]},ne=[{key:"G1",label:"Groupe 1 (0-1 ans)",min:0,max:1},{key:"G2",label:"Groupe 2 (1-2 ans)",min:1,max:2},{key:"G3",label:"Groupe 3 (2-3 ans)",min:2,max:3},{key:"G4",label:"Groupe 4 (3-4 ans)",min:3,max:4},{key:"G5",label:"Groupe 5 (4-5 ans)",min:4,max:5},{key:"G6",label:"Groupe 6 (5-6 ans)",min:5,max:6}],Ae={masculin:"👦",feminin:"👧"};function Fe(){const[v,S]=o.useState(!1);o.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const t=window.matchMedia("(max-height: 600px) and (orientation: landscape)"),s=()=>S(!!t.matches);return s(),typeof t.addEventListener=="function"?t.addEventListener("change",s):t.addListener(s),window.addEventListener("resize",s),window.addEventListener("orientationchange",s),()=>{try{typeof t.removeEventListener=="function"?t.removeEventListener("change",s):t.removeListener(s)}catch{}window.removeEventListener("resize",s),window.removeEventListener("orientationchange",s)}},[]);const{t:n}=Ie(),[M,I]=o.useState({}),[L,A]=o.useState([]),[K,N]=o.useState(!0),[l,h]=o.useState(B),[P,G]=o.useState([]),[V,U]=o.useState([]),[ue,O]=o.useState(!1),[_,R]=o.useState(null),[se,k]=o.useState(""),[z,ge]=o.useState(""),[Y,fe]=o.useState(""),[X,ye]=o.useState("name"),[be,W]=o.useState(!1),[we,ae]=o.useState(""),[je,re]=o.useState(null),[q,le]=o.useState({}),[ie,oe]=o.useState({}),[D,de]=o.useState({open:!1,url:null,childName:null}),[ce,T]=o.useState({open:!1,childName:null}),{user:u}=xe(),ve=!!(u&&typeof u.role=="string"&&(u.role.toLowerCase()==="admin"||u.role.toLowerCase().includes("super")||u.role.toLowerCase()==="administrator")),H=u,Ne=!!(H&&(typeof H.role=="string"&&H.role.toLowerCase()==="nanny"||H.nannyId));function Ce(t){h({...B,...t,group:t.group||""}),R(t.id),k(""),W(!0),setTimeout(()=>window.scrollTo({top:0,behavior:"smooth"}),100)}const J=async()=>{N(!0);try{const t=new Date().toISOString().split("T")[0],s=`${j}/children`;let r=te(s)??null;const d=C(`${j}/assignments?start=${t}&end=${t}`,{credentials:"include"});r||(r=await(await C(`${j}/children`,{credentials:"include"})).json(),he(s,r));const y=await(await d).json(),b=new Set(y.map(f=>f.child.id)),w=Array.isArray(r)?r.map(f=>{const a={...f},c=Array.isArray(a.parents)?a.parents:void 0;if(c&&c.length>0&&c[0]&&c[0].parent){const p=c[0].parent,E=`${String(p.firstName??"")} ${String(p.lastName??"")}`.trim();a.parentName=E||String(a.parentName??""),a.parentContact=p.phone??String(a.parentContact??""),a.parentMail=p.email??String(a.parentMail??""),a.parentId=String(p.id??a.parentId??"")}return{id:String(a.id??""),name:String(a.name??""),age:Number(a.age??0),sexe:a.sexe==="feminin"?"feminin":"masculin",parentName:String(a.parentName??""),parentContact:String(a.parentContact??""),parentMail:String(a.parentMail??""),parentId:a.parentId?String(a.parentId):void 0,allergies:a.allergies?String(a.allergies):void 0,group:a.group?String(a.group):void 0,present:b.has(String(a.id??"")),newThisMonth:!!(a.newThisMonth??!1),cotisationPaidUntil:a.cotisationPaidUntil?String(a.cotisationPaidUntil):void 0,birthDate:a.birthDate?String(a.birthDate):void 0,nannyIds:Array.isArray(a.childNannies)?a.childNannies.map(p=>{if(!p||typeof p!="object")return"";const E=p.nanny;return E&&E.id?String(E.id):p.nannyId?String(p.nannyId):""}).filter(Boolean):[]}}):[];A(w);const x={};w.forEach(f=>{x[f.id]=15}),le(x);try{const f=await Promise.all(w.map(async c=>{try{const m=await C(`${j}/children/${c.id}/photo-consent-summary`,{credentials:"include"});if(!m.ok)return{id:c.id,allowed:!1};const p=await m.json();return{id:c.id,allowed:!!p.allowed}}catch{return{id:c.id,allowed:!1}}})),a={};f.forEach(c=>{a[c.id]=!!c.allowed}),oe(a)}catch{oe({})}}catch{A([])}finally{N(!1)}};o.useEffect(()=>{J(),(async()=>{try{const r=u,d=r&&typeof r.role=="string"&&(r.role.toLowerCase()==="admin"||r.role.toLowerCase().includes("super")),g=!!(r&&r.nannyId);if(!d&&!g){G([]);return}const y=await C(`${j}/parent/admin`,{credentials:"include"});if(!y.ok)return G([]);const b=await y.json(),w=Array.isArray(b?.parents)?b.parents.map(x=>{const f=String(x.id??""),a=x.name??`${x.firstName??""} ${x.lastName??""}`,c=String(a).trim()||f,m=typeof x.email=="string"?x.email:void 0,p=typeof x.phone=="string"?x.phone:void 0;return{id:f,name:c,email:m,phone:p}}):[];G(w)}catch{G([])}})(),(async()=>{try{const r=`${j}/nannies`,d=te(r);if(d)U(d);else{const g=await C(`${j}/nannies`,{credentials:"include"});if(!g.ok)return U([]);const y=await g.json(),b=Array.isArray(y)?y.map(w=>{const x=w;return{id:String(x.id??""),name:String(x.name??"")}}):[];U(b),he(r,b)}}catch{U([])}})(),(async()=>{try{const r=Le(),d=`${j}/children`,g=te(d),y=g||await C(`${j}/children`,{credentials:"include"}).then(w=>w.json()),b={};await Promise.all(y.map(async w=>{const x=await C(`${j}/children/${w.id}/billing?month=${r}`,{credentials:"include"});if(x.ok){const f=await x.json();b[w.id]={days:f.days,amount:f.amount}}})),I(b)}catch{I({})}})()},[u]);const $=t=>{h({...l,[t.target.name]:t.target.value})},Se=async t=>{t.preventDefault(),k("");try{const s={name:l.name,age:l.age,sexe:l.sexe,parentName:l.parentName||void 0,parentContact:l.parentContact||void 0,parentMail:l.parentMail||void 0,allergies:l.allergies||void 0,group:l.group||void 0,present:l.present,birthDate:l.birthDate||void 0,nannyIds:Array.isArray(l.nannyIds)?l.nannyIds:void 0};if(l.parentId&&(s.parentId=l.parentId),!(await C(_?`${j}/children/${_}`:`${j}/children`,{method:_?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)})).ok)throw new Error("Erreur lors de la sauvegarde");h(B),R(null),W(!1),ae("L'enfant a bien été ajouté !"),J(),setTimeout(()=>ae(""),2500)}catch(s){s instanceof Error?k(s.message):k("Erreur")}},[Q,Z]=o.useState(null),[ee,me]=o.useState(!1),ke=async()=>{if(Q){me(!0);try{const t=await C(`${j}/children/${Q}`,{method:"DELETE",credentials:"include"});if(!t.ok){let s="Erreur lors de la suppression";try{const i=await t.json();i&&(s=i.error||i.message||JSON.stringify(i))}catch{}throw new Error(s)}Z(null),J()}catch(t){t instanceof Error?k(t.message):k("Erreur")}finally{me(!1)}}},$e=L.length,Me=L.filter(t=>t.present).length;let F=L.filter(t=>{const s=!z||t.name.toLowerCase().includes(z.toLowerCase())||t.parentName.toLowerCase().includes(z.toLowerCase());let i=!0;if(Y){const r=ne.find(d=>d.key===Y);r&&(i=t.group===r.key||!t.group&&t.age>=r.min&&t.age<r.max)}return s&&i});X==="name"&&(F=F.sort((t,s)=>t.name.localeCompare(s.name))),X==="age"&&(F=F.sort((t,s)=>t.age-s.age));const pe=["bg-blue-50","bg-yellow-50","bg-purple-50","bg-green-50","bg-pink-50","bg-orange-50"];return e.jsx("div",{className:`relative z-0 min-h-screen bg-[#fcfcff] p-4 ${v?"":"md:pl-64"} w-full`,children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full children-responsive-row",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6 w-full children-responsive-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold mb-1 tracking-tight",style:{color:"#0b5566"},children:n("page.children.title")}),e.jsx("div",{className:"text-base md:text-lg font-medium mb-4 md:mb-6",style:{color:"#08323a"},children:n("page.children.description")})]}),e.jsx("div",{className:"flex gap-2 items-center",children:ve&&e.jsx("button",{type:"button",onClick:()=>{W(!0),h(B),R(null),k("")},className:`bg-[#0b5566] text-white font-semibold rounded-lg px-5 py-2 text-base shadow hover:bg-[#08323a] transition min-h-[44px] md:h-[60px] flex items-center ${v?"-translate-x-3":""}`,style:{transform:v?"translateX(-12px)":void 0},children:n("children.add")})})]}),e.jsxs("div",{className:"flex flex-col md:items-start gap-3 mb-6 w-full",children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex gap-2 items-center flex-wrap w-full",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow px-3 py-2 md:px-4 md:py-2 flex flex-col items-center min-w-[80px] md:min-w-[90px] min-h-[44px] md:h-[60px] justify-center flex-shrink-0",children:[e.jsx("div",{className:"text-xs text-gray-400",children:n("children.total")}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:$e})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow px-3 py-2 md:px-4 md:py-2 flex flex-col items-center min-w-[80px] md:min-w-[90px] min-h-[44px] md:h-[60px] justify-center flex-shrink-0",children:[e.jsx("div",{className:"text-xs text-gray-400",children:n("children.present")}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:Me})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow px-3 py-2 md:px-4 md:py-2 flex flex-col items-center min-w-[80px] md:min-w-[90px] min-h-[44px] md:h-[60px] justify-center flex-shrink-0",children:[e.jsx("div",{className:"text-xs text-gray-400",children:n("children.new_badge")}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:L.filter(t=>t.newThisMonth).length})]})]})}),e.jsx("div",{className:"w-full md:w-auto",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsx("input",{type:"text",value:z,onChange:t=>ge(t.target.value),placeholder:n("children.search_placeholder"),className:"border border-gray-200 rounded-lg px-3 py-2 text-gray-700 bg-white shadow-sm text-sm md:text-base w-full md:w-64 min-h-[44px]"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:Y,onChange:t=>fe(t.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 bg-white text-gray-700 shadow-sm text-sm",children:[e.jsx("option",{value:"",children:n("children.group.all")}),ne.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))]}),e.jsxs("select",{value:X,onChange:t=>ye(t.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 bg-white text-gray-700 shadow-sm text-sm",children:[e.jsx("option",{value:"name",children:n("children.sort.name")}),e.jsx("option",{value:"age",children:n("children.sort.age")})]})]})]})})]}),(be||_)&&e.jsxs("form",{onSubmit:Se,className:"mb-6 bg-white rounded-2xl shadow p-6 grid gap-2 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx("input",{name:"name",value:l.name,onChange:$,placeholder:n("children.form.name"),required:!0,className:"border rounded px-3 py-2"}),e.jsx("input",{name:"age",type:"number",value:l.age,onChange:$,placeholder:n("children.form.age"),required:!0,className:"border rounded px-3 py-2"}),e.jsx("input",{name:"birthDate",type:"date",value:l.birthDate||"",onChange:$,placeholder:n("children.form.birthDate"),className:"border rounded px-3 py-2"}),e.jsxs("select",{name:"sexe",value:l.sexe,onChange:$,required:!0,className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"masculin",children:n("children.form.sexe.m")}),e.jsx("option",{value:"feminin",children:n("children.form.sexe.f")})]}),e.jsxs("select",{name:"group",value:l.group,onChange:$,required:!0,className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:n("children.form.group_placeholder")}),ne.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))]}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{name:"parentName",value:l.parentName,onChange:t=>{const s=t.target.value;h(d=>({...d,parentName:s}));const i=s.toLowerCase(),r=P.find(d=>d.name.toLowerCase()===i);h(r?d=>({...d,parentMail:r.email||"",parentContact:r.phone||"",parentId:r.id}):d=>({...d,parentId:void 0})),O(!0)},onFocus:()=>O(!0),onBlur:()=>{setTimeout(()=>O(!1),150)},placeholder:n("children.form.parent_placeholder"),className:"border rounded px-3 py-2 w-full"}),ue&&(()=>{const t=l.parentName.trim().toLowerCase(),s=t?P.filter(i=>i.name.toLowerCase().includes(t)):P;return s.length===0?null:e.jsx("ul",{className:"absolute left-0 right-0 bg-white border rounded shadow max-h-56 overflow-auto z-50 mt-1",children:s.slice(0,12).map(i=>e.jsx("li",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",onMouseDown:r=>{r.preventDefault(),h(d=>({...d,parentName:i.name,parentMail:i.email||"",parentContact:i.phone||"",parentId:i.id})),O(!1)},children:i.name},i.id))})})()]}),e.jsx("input",{name:"parentContact",value:l.parentContact,onChange:$,placeholder:n("children.form.parentPhone_placeholder"),className:"border rounded px-3 py-2"}),e.jsx("input",{name:"parentMail",type:"email",value:l.parentMail,onChange:$,placeholder:n("children.form.parentEmail_placeholder"),className:"border rounded px-3 py-2"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n("children.nannies.label")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-auto border rounded p-2 bg-gray-50",children:V.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:n("children.nannies.none")}):V.map(t=>{const s=Array.isArray(l.nannyIds)&&l.nannyIds.includes(t.id);return e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",value:t.id,checked:s,onChange:i=>{const r=i.target.value;h(d=>{const g=Array.isArray(d.nannyIds)?[...d.nannyIds]:[];if(i.target.checked)g.includes(r)||g.push(r);else{const y=g.indexOf(r);y>=0&&g.splice(y,1)}return{...d,nannyIds:g}})}}),e.jsx("span",{children:t.name})]},t.id)})})]}),e.jsx("input",{name:"allergies",value:l.allergies,onChange:$,placeholder:n("children.form.allergies_placeholder"),className:"border rounded px-3 py-2 md:col-span-2"}),e.jsxs("div",{className:"md:col-span-2 flex gap-2",children:[e.jsx("button",{type:"submit",className:"bg-[#0b5566] text-white px-4 py-2 rounded hover:bg-[#08323a] transition",children:n(_?"children.form.edit":"children.add")}),e.jsx("button",{type:"button",onClick:()=>{h(B),R(null),W(!1),k("")},className:"bg-gray-300 px-4 py-2 rounded",children:n("global.cancel")})]}),se&&e.jsx("div",{className:"text-red-600 md:col-span-2",children:se})]}),we&&e.jsx("div",{className:"mb-4 text-[#0b5566] font-semibold text-center bg-[#a9ddf2] border border-[#fcdcdf] rounded-lg py-2",children:n("children.form.added_success")}),K?e.jsx("div",{children:n("children.loading")}):e.jsx("div",{className:"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 w-full children-responsive-grid",children:F.map((t,s)=>{const i=M[t.id],r=pe[s%pe.length],d=Ae[t.sexe]||"👦",g=Q===t.id,y=new Date,b=t.cotisationPaidUntil?new Date(t.cotisationPaidUntil):null,w=b?Math.max(0,Math.floor((b.getTime()-y.getTime())/(1e3*60*60*24))):0,x=w>0;let f="";if(b){const c=b.getTime()-y.getTime();if(c>0){const m=Math.floor(c/864e5);f=m>365?"Cotisation à jour":`${m} jours restants`}else f="Cotisation à renouveler"}const a=async()=>{re(t.id);const c=q[t.id]??15;try{const m=await C(`${j}/children/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:t.name,age:t.age,sexe:t.sexe,parentName:t.parentName,parentContact:t.parentContact,allergies:t.allergies||"",payCotisation:!0,amount:c})});m.ok?await J():console.error("Failed to update cotisation",String(m.status))}catch(m){console.error("Error while updating cotisation",m instanceof Error?m.message:String(m))}finally{re(null)}};return e.jsx("div",{className:`rounded-2xl shadow ${r} relative flex flex-col min-h-[520px] md:min-h-[540px] h-full transition-transform duration-500 perspective-1000 overflow-hidden`,style:{height:"100%",perspective:"1000px"},children:e.jsxs("div",{className:`w-full h-full transition-transform duration-500 ${g?"rotate-y-180":""}`,style:{transformStyle:"preserve-3d",position:"relative",width:"100%",height:"100%"},children:[e.jsxs("div",{className:`absolute inset-0 w-full h-full p-5 pb-20 md:pb-28 flex flex-col ${g?"opacity-0 pointer-events-none":"opacity-100"} bg-transparent`,style:{backfaceVisibility:"hidden"},children:[e.jsx("div",{className:"flex items-center gap-3 mb-2 min-w-0",children:e.jsxs("div",{className:"w-full min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white flex items-center justify-center text-2xl shadow border border-gray-100",children:d}),e.jsx("span",{className:"font-semibold text-lg text-gray-900 truncate",title:t.name,children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs font-bold bg-white text-[#08323a] px-3 py-1 rounded-full shadow border border-[#a9ddf2] whitespace-nowrap",children:[t.age," ans"]}),e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-blue-100 text-blue-700 whitespace-nowrap",title:"Sexe",children:t.sexe==="masculin"?n("children.form.sexe.m"):n("children.form.sexe.f")}),t.birthDate?e.jsxs("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-green-100 text-green-700 whitespace-nowrap",title:n("label.birthDate"),children:["🎂 ",new Date(t.birthDate).toLocaleDateString("fr-FR")]}):e.jsxs("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-100 text-gray-600 whitespace-nowrap",title:n("label.birthDate"),children:["🎂 ",n("children.birthDate.undefined")]})]})]})}),e.jsxs("span",{className:"block text-xs text-yellow-700 flex items-center gap-1 mb-2",children:[e.jsxs("span",{children:["⚠️ ",n("children.allergies.label")]}),e.jsx("span",{className:"font-medium",children:t.allergies?t.allergies:e.jsx("span",{className:"text-gray-400",children:n("children.allergies.none")})})]}),e.jsxs("div",{className:"flex flex-col gap-3 text-sm text-gray-700 mb-4",children:[e.jsxs("span",{className:"block",children:["👤 ",n("children.parent.label")," ",t.parentName]}),e.jsxs("span",{className:"block",children:["📞 ",e.jsx("a",{href:`tel:${t.parentContact}`,className:"text-blue-600 underline hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-400 transition",title:n("children.call_parent_title"),children:t.parentContact})]}),e.jsxs("span",{className:"block",children:["✉️ ",e.jsx("a",{href:`mailto:${t.parentMail}`,className:"text-blue-600 underline hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-400 transition",title:n("children.email_parent_title"),children:t.parentMail})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2 mb-0",style:{marginBottom:0},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-700",children:[n("children.cotisation.label")," :"]}),w>0?e.jsxs("span",{className:"text-base font-bold text-[#08323a]",children:[q[t.id]??15,"€"]}):u&&(u.role==="admin"||u.role==="super-admin")?e.jsx("input",{type:"number",min:0,className:"w-24 px-2 py-1 border rounded text-sm",value:q[t.id]??"",placeholder:"€",onChange:c=>le(m=>({...m,[t.id]:c.target.value===""?void 0:Number(c.target.value)}))}):e.jsxs("span",{className:"text-base font-bold text-green-700",children:[q[t.id]??15,"€"]}),x?e.jsx("span",{className:"text-[#0b5566] text-xl",children:"✔️"}):je===t.id?e.jsx("span",{className:"text-gray-400 text-xs ml-2 animate-pulse",children:n("children.loading")}):Ne?e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"—"}):e.jsx("button",{onClick:a,className:"text-[#0b5566] text-xs font-semibold px-2 py-1 rounded bg-[#a9ddf2] hover:bg-[#f7f4d7] transition",title:n("children.cotisation.pay"),children:n("children.cotisation.pay")}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:f})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-700",children:[n("children.cotisation.this_month")," :"]}),e.jsx("span",{className:"text-base font-bold text-[#08323a]",children:i?`${i.amount}€`:"..."}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i?`${i.days} jour${i.days>1?"s":""}`:"calcul...",")"]})]})]}),u&&u.role==="parent"&&t.parentId===(u.parentId||void 0)&&e.jsx("div",{className:"mt-3",children:e.jsx(Ee,{childId:t.id})}),e.jsx("div",{className:"mt-2",children:typeof ie[t.id]=="boolean"?ie[t.id]?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:n("children.photo_consent.yes")}):e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:n("children.photo_consent.no")}):e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full",children:n("children.photo_consent.unknown")})})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.present?e.jsxs("span",{className:"text-[#08323a] text-xs font-semibold flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#a9ddf2] inline-block"}),n("children.presence.present_today")]}):e.jsxs("span",{className:"text-red-500 text-xs font-semibold flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-400 inline-block"}),n("children.presence.absent_today")]}),t.newThisMonth&&e.jsx("span",{className:"ml-2 text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full",children:n("children.new_badge")}),Array.isArray(t.nannyIds)&&t.nannyIds.length>0?e.jsxs("span",{className:"ml-2 text-xs px-2 py-1 rounded-full flex items-center gap-2 bg-indigo-100 text-indigo-700 flex-shrink-0",children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"inline-block",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),e.jsx("span",{className:"font-medium truncate max-w-[160px]",children:n("children.assigned",{names:t.nannyIds.map(c=>V.find(m=>m.id===c)?.name||"").filter(Boolean).join(", ")})})]}):e.jsx("span",{className:"ml-2 text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full",children:n("children.not_assigned")})]}),e.jsx("div",{})]})]}),e.jsx("div",{className:"absolute left-0 right-0 bottom-4 flex justify-center z-10",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{let m=De(t)||null;if(!m)try{const p=await C(`${j}/children/${t.id}/prescription`,{credentials:"include"});if(!p.ok){T({open:!0,childName:t.name});return}if(m=(await p.json()).url||null,!m){T({open:!0,childName:t.name});return}}catch(p){console.error("Failed to fetch prescription",p),T({open:!0,childName:t.name});return}m&&de({open:!0,url:m,childName:t.name})},className:"bg-white border border-gray-200 text-gray-500 hover:text-green-700 rounded-full p-2 shadow-sm",title:n("children.prescription.view_button"),children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("path",{d:"M7 10l5 5 5-5"})]})}),u&&(u.role==="admin"||u.role==="super-admin"||u.nannyId)?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ce(t),className:"bg-white border border-gray-200 text-gray-500 hover:text-[#08323a] rounded-full p-2 shadow-sm",title:n("children.action.edit"),children:e.jsx("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15.232 5.232l3.536 3.536M9 13l6-6 3 3-6 6H9v-3z"})})}),e.jsx("button",{onClick:()=>Z(t.id),className:"bg-white border border-gray-200 text-gray-500 hover:text-red-500 rounded-full p-2 shadow-sm",title:n("children.action.delete"),children:e.jsx("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6M1 7h22M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})})})]}):null]})}),e.jsxs("div",{className:`absolute inset-0 w-full h-full flex flex-col items-center justify-center bg-white rounded-2xl shadow-xl p-8 ${g?"opacity-100":"opacity-0 pointer-events-none"}`,style:{backfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:[e.jsx("div",{className:"text-red-500 text-4xl mb-2",children:"🗑️"}),e.jsx("div",{className:"text-lg font-semibold mb-2 text-gray-900 text-center",children:n("children.delete.confirm_title")}),e.jsx("div",{className:"text-gray-500 mb-6 text-center",children:n("children.delete.confirm_body")}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:()=>Z(null),className:"flex-1 bg-gray-100 text-gray-700 rounded-lg px-4 py-2 font-medium hover:bg-gray-200 transition",disabled:ee,children:n("modal.cancel")}),e.jsx("button",{onClick:ke,className:"flex-1 bg-red-500 text-white rounded-lg px-4 py-2 font-medium hover:bg-red-600 transition shadow",disabled:ee,children:n(ee?"children.deleting":"children.action.delete")})]})]})]})},t.id)})}),D.open&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-4 w-full max-w-3xl relative mx-4",children:[e.jsx("button",{onClick:()=>de({open:!1,url:null}),className:"absolute top-3 right-3 text-gray-500",children:"×"}),e.jsxs("div",{className:"text-lg font-bold mb-2",children:["Ordonnance de ",D.childName||"cet enfant"]}),e.jsx("div",{className:"w-full h-[50vh] sm:h-[70vh] flex items-center justify-center overflow-auto",children:D.url&&D.url.endsWith(".pdf")?e.jsx("iframe",{src:D.url,className:"w-full h-full",title:"Ordonnance PDF"}):e.jsx("img",{src:D.url||"",alt:"Ordonnance",className:"h-full w-auto object-contain"})})]})}),ce.open&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-full max-w-md relative",children:[e.jsx("button",{onClick:()=>T({open:!1,childName:null}),className:"absolute top-3 right-3 text-gray-500",children:"×"}),e.jsx("div",{className:"text-lg font-bold mb-2",children:n("children.prescription.noneTitle")}),e.jsx("div",{className:"text-gray-600 mb-4",children:n("children.prescription.noneMessage",{name:ce.childName||n("children.thisChild")})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>T({open:!1,childName:null}),className:"px-4 py-2 bg-[#0b5566] text-white rounded-lg",children:n("common.ok")})})]})})]})})}export{Fe as default};
//# sourceMappingURL=Children-Dx3KOnno.js.map
