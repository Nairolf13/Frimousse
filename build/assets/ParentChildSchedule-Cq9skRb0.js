import{a as T,r as h,j as e,b as K,e as U,f as N}from"./index-BlCxgRmJ.js";import{u as q}from"./useI18n-BzDKbdEV.js";function B(s){try{return new Date(s).toLocaleDateString(void 0,{dateStyle:"full"})}catch{return s}}function Q({assignment:s,onClose:a}){const c=T();return h.useEffect(()=>{const m=r=>{r.key==="Escape"&&a()};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[a]),e.jsx("div",{className:"fixed inset-0 z-60 bg-white/40 backdrop-blur-[2px] flex items-center justify-center",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 w-full max-w-md relative border border-gray-100",children:[e.jsx("button",{onClick:a,className:"absolute top-3 right-3 text-gray-500 hover:text-[#08323a]","aria-label":"Fermer",children:"✕"}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-[#08323a]",children:"Détail de l'activité"}),e.jsxs("div",{className:"text-sm text-[#08323a] mb-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Enfant :"})," ",s.child?.name??"—"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date :"})," ",B(s.date)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Nounou :"})," ",s.nanny?.name??"—"]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{className:"flex-1 bg-white border border-gray-200 rounded-xl px-4 py-2 hover:bg-gray-50 text-[#0b5566]",onClick:a,children:"Fermer"}),e.jsx("button",{className:"flex-1 bg-[#0b5566] text-white rounded-xl px-4 py-2 hover:bg-[#08323a]",onClick:()=>{a(),c(`/assignments/${s.id}`)},children:"Voir l'affectation"})]})]})})}function W({activities:s,onClose:a}){h.useEffect(()=>{const r=u=>{u.key==="Escape"&&a()};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[a]);const{t:c,locale:m}=q();return!s||s.length===0?e.jsx("div",{className:"fixed inset-0 z-60 bg-white/40 backdrop-blur-[2px] flex items-center justify-center",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 w-full max-w-md relative border border-gray-100",children:[e.jsx("button",{onClick:a,className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700","aria-label":c("common.close"),children:"✕"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:c("activities.none")}),e.jsxs("p",{className:"text-sm text-gray-600",children:[c("activities.none")," ",c("common.no")]})]})}):e.jsx("div",{className:"fixed inset-0 z-60 bg-white/40 backdrop-blur-[2px] flex items-center justify-center",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 w-full max-w-2xl relative border border-gray-100",children:[e.jsx("button",{onClick:a,className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700","aria-label":c("common.close"),children:"✕"}),e.jsx("h3",{className:"text-xl font-semibold mb-4",children:c("page.activities")}),e.jsx("div",{className:"space-y-4",children:s.map(r=>e.jsxs("div",{className:"p-4 rounded-xl border bg-blue-50 border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-bold text-lg",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[new Intl.DateTimeFormat(m).format(new Date(r.date))," • ",r.startTime," - ",r.endTime]})]}),r.comment&&e.jsx("div",{className:"text-sm text-gray-700 mb-2",children:r.comment}),r.nannies&&r.nannies.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.nannies.map(u=>e.jsx("span",{className:"px-3 py-1 rounded-full bg-blue-100 text-blue-700 font-semibold text-sm",children:u.name},u.id))})]},r.id))})]})})}function H(s){const a=s.getFullYear(),c=s.getMonth(),m=new Date(a,c,1),r=new Date(a,c+1,0),u=new Date(m);u.setDate(m.getDate()-(m.getDay()+6)%7);const b=new Date(r);b.setDate(r.getDate()+(7-b.getDay()===7?0:7-b.getDay()));const y=[];for(let o=new Date(u);o<=b;o.setDate(o.getDate()+1))y.push(new Date(o));const v=[];for(let o=0;o<y.length;o+=7)v.push(y.slice(o,o+7));return v}function p(s){const a=new Date(s);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`}function te(){const{user:s}=K(),[a,c]=h.useState(!1);h.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const t=window.matchMedia("(max-height: 600px) and (orientation: landscape)"),n=()=>c(!!t.matches);return n(),typeof t.addEventListener=="function"?t.addEventListener("change",n):t.addListener(n),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{try{typeof t.removeEventListener=="function"?t.removeEventListener("change",n):t.removeListener(n)}catch{}window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]);const{childId:m}=U(),r=T(),[u,b]=h.useState([]),[y,v]=h.useState(!0),[o,D]=h.useState(new Date),[S,F]=h.useState(null),[M,w]=h.useState(null),k=(t,n)=>{for(const i of n)if(typeof t[i]=="string")return t[i];return""},I=t=>t?t.map(n=>{const i=n;return{id:n.id,date:n.date,startTime:k(i,["startTime","start"]),endTime:k(i,["endTime","end"]),name:typeof n.name=="string"?n.name:"",comment:typeof n.comment=="string"?n.comment:null,nannies:Array.isArray(n.nannies)?n.nannies:void 0}}):[],[z,Y]=h.useState(null),L=h.useCallback(async(t,n)=>{let i="/api/assignments";const g=[];t&&n&&(g.push(`start=${t.toISOString()}`),g.push(`end=${n.toISOString()}`)),g.length&&(i+=`?${g.join("&")}`);const l=await N(i,{credentials:"include"});return l.ok?l.json():[]},[]);h.useEffect(()=>{if(!m)return;(async()=>{try{const x=await(await N("/api/children",{credentials:"include"})).json(),d=Array.isArray(x)?x.find(f=>String(f.id)===String(m)):null;Y(d?d.name||`${d.firstName||""} ${d.lastName||""}`.trim():null)}catch(l){console.error("Failed to load child name",l instanceof Error?l.message:String(l))}})(),v(!0);const t=o.getFullYear(),n=o.getMonth(),i=new Date(t,n,1),g=new Date(t,n+1,0);(async()=>{try{const l=await L(i,g),x=Array.isArray(l)?l.filter(d=>d.child&&d.child.id===m):[];b(x)}catch(l){console.error("Failed to load assignments for child",l instanceof Error?l.message:String(l)),b([])}finally{v(!1)}})()},[m,o,L]);const E=H(o),P=()=>{const t=new Date(o);t.setMonth(t.getMonth()-1),D(t)},R=()=>{const t=new Date(o);t.setMonth(t.getMonth()+1),D(t)},O=t=>{if(s&&s.role==="parent")return;const n={id:"placeholder",date:t.toISOString(),startTime:"",endTime:"",name:`Sélection: ${t.toLocaleDateString()}`,comment:""};w({activities:[n]})},A=o.toLocaleString("default",{month:"long",year:"numeric"});return e.jsx("div",{className:`relative z-0 min-h-screen bg-[#fcfcff] p-4 ${a?"":"md:pl-64"} w-full`,children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4 w-full",children:[e.jsx("div",{children:e.jsxs("button",{className:"mr-2 cursor-pointer flex items-center gap-2 bg-[#a9ddf2] text-[#0b5566] px-3 py-1 rounded",onClick:()=>r(-1),children:[e.jsx("span",{className:"text-lg",children:"←"}),e.jsx("span",{children:"Retour"})]})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("div",{className:"text-2xl font-semibold",children:["Planning de ",z??"l'enfant"]})}),e.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-end",children:[e.jsx("button",{onClick:P,className:"w-8 h-8 flex items-center justify-center rounded-full border border-gray-200 bg-white hover:bg-gray-100 text-gray-500",children:"‹"}),e.jsx("div",{className:"text-lg font-bold text-[#0b5566]",children:A.charAt(0).toUpperCase()+A.slice(1)}),e.jsx("button",{onClick:R,className:"w-8 h-8 flex items-center justify-center rounded-full border border-gray-200 bg-white hover:bg-gray-100 text-gray-500",children:"›"})]})]}),S&&e.jsx(Q,{assignment:S,onClose:()=>F(null)}),M&&e.jsx(W,{activities:M.activities,onClose:()=>w(null)}),y?e.jsx("div",{children:"Chargement..."}):e.jsxs("div",{className:"bg-white rounded-2xl shadow p-4",style:{border:"1px solid #fcdcdf"},children:[e.jsx("div",{className:"hidden sm:block w-full",children:e.jsxs("table",{className:"w-full table-fixed bg-white rounded-lg",style:{borderCollapse:"separate",borderSpacing:0,border:"1px solid transparent"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"].map(t=>e.jsx("th",{className:"p-2 text-center font-semibold text-base",style:{color:"#08323a"},children:t},t))})}),e.jsx("tbody",{children:E.map((t,n)=>e.jsx("tr",{children:t.map((i,g)=>{const l=u.filter(f=>p(f.date)===p(i)),x=i.toDateString()===new Date().toDateString(),d=i.getMonth()===o.getMonth();return e.jsxs("td",{className:"align-top p-2 h-28 "+(x?"border-2 border-[#a9ddf2] rounded-xl ":"border border-gray-100 ")+(d?"bg-[#f8f8fc]":"bg-gray-50 opacity-60")+" relative",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-xs font-bold "+(d?"":"text-gray-400"),style:d?{color:"#08323a"}:void 0,children:i.getDate()})}),l.length===0?e.jsx("div",{className:"text-gray-300 text-sm",children:"—"}):e.jsx("div",{className:"space-y-2",children:l.map(f=>e.jsx("div",{className:"rounded px-2 py-1 text-sm shadow-sm",style:{background:"#a9ddf2",color:"#08323a"},children:f.nanny?e.jsx("button",{className:"font-semibold",style:{color:"#0b5566"},onClick:async()=>{try{const j=f.nanny.id,V=p(f.date),C=await(await N(`/api/nannies/${encodeURIComponent(j)}/schedules`,{credentials:"include"})).json(),G=Array.isArray(C)?C.filter(J=>{const $=J;return(typeof $.date=="string"?p($.date):"")===V}):[];w({activities:I(G)})}catch(j){console.error("Failed to fetch activities",j),w({activities:[]})}},children:f.nanny.name}):"Affectation"},f.id))})]},g)})},n))})]})}),e.jsx("div",{className:"block sm:hidden w-full overflow-x-auto",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1 w-full",children:[["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"].map((t,n)=>e.jsx("div",{className:"text-center text-gray-500 font-semibold text-xs py-1",children:t},n)),E.flat().map((t,n)=>{const i=u.filter(x=>p(x.date)===p(t)),g=t.toDateString()===new Date().toDateString(),l=t.getMonth()===o.getMonth();return e.jsxs("div",{className:"box-border align-top p-1 h-full flex flex-col "+(g?"border-2 border-[#0b5566] rounded-xl ":"border border-gray-100 ")+(l?"bg-[#f8f8fc]":"bg-gray-50 opacity-60")+" relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold "+(l?"text-gray-700":"text-gray-400"),children:t.getDate()}),!(s&&s.role==="parent")&&e.jsx("button",{onClick:()=>O(t),className:"text-[#0b5566] hover:text-[#08323a] text-lg font-bold",children:"+"})]}),i.length===0?e.jsx("div",{className:"text-gray-300 text-xs",children:"—"}):i.slice(0,2).map((x,d)=>e.jsxs("div",{className:"flex items-center gap-2 mb-1 px-1 py-1 rounded-lg "+(d===0?"bg-[#a9ddf2]":"bg-[#fff7e6]")+" shadow-sm group",children:[e.jsx("span",{className:"w-2 h-2 rounded-full "+(d===0?"bg-[#08323a]":"bg-[#856400]")}),e.jsx("span",{className:"font-semibold text-gray-800 text-[11px] group-hover:underline cursor-pointer truncate max-w-[70px]",title:x.child.name,children:x.child.name})]},x.id)),i.length>2&&e.jsxs("div",{className:"text-gray-400 text-xs italic truncate max-w-[70px] overflow-hidden whitespace-nowrap",children:["...et ",i.length-2," autres"]})]},n)})]})})]})]})})}export{te as default};
//# sourceMappingURL=ParentChildSchedule-Cq9skRb0.js.map
