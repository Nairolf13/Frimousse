import{r as a,j as e,f as b}from"./index-BlCxgRmJ.js";import{u as M}from"./useI18n-BzDKbdEV.js";import{C as D}from"./ConfirmDialog-ziUy2HEp.js";function B({items:c=[],loading:g=!1,onRefresh:l=()=>{},onDeleted:j=()=>{}}){const[u,d]=a.useState(null),[N,k]=a.useState(!1),{t:o}=M();function f(t){const x=new Date(String(t)),n=Date.now()-x.getTime(),s=Math.round(n/6e4);if(s<1)return o("time.now");if(s<60)return o("time.minutes",{n:String(s)});const h=Math.round(s/60);if(h<24)return o("time.hours",{n:String(h)});const E=Math.round(h/24);return o("time.days",{n:String(E)})}async function y(t){await fetch(`/api/notifications/${t}/read`,{method:"PUT",credentials:"include"}),l(),typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("notifications:changed",{detail:{action:"read",id:t}}))}async function m(t){await fetch(`/api/notifications/${t}/unread`,{method:"PUT",credentials:"include"}),l(),typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("notifications:changed",{detail:{action:"unread",id:t}}))}function r(t){d(t)}async function C(t){try{k(!0),await fetch(`/api/notifications/${t}`,{method:"DELETE",credentials:"include"}),j(),typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("notifications:changed",{detail:{action:"delete",id:t}}))}catch(x){console.error("Failed to delete notification",x)}finally{k(!1),d(null)}}if(g)return e.jsx("div",{className:"text-gray-600",children:o("notifications.loading")});if(!c||c.length===0)return e.jsx("div",{className:"text-gray-500",children:o("notifications.none")});const p=["bg-blue-50","bg-yellow-50","bg-purple-50","bg-green-50","bg-pink-50","bg-orange-50"];return e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:c.map((t,x)=>{const n=t.data&&typeof t.data=="object"?t.data:null,s=n&&typeof n.type=="string"?n.type:"",E={activity:"bg-emerald-500",message:"bg-sky-500",reminder:"bg-amber-500",report:"bg-violet-500",system:"bg-red-500"}[s]||"bg-indigo-500",L=n&&Array.isArray(n.tags)?n.tags:[];function W(i,v=!1){const _=v?16:20,w={width:_,height:_,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};switch(i){case"activity":return e.jsxs("svg",{...w,children:[e.jsx("path",{d:"M12 2v6l4 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"12",cy:"16",r:"4",fill:"currentColor"})]});case"message":return e.jsx("svg",{...w,children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})});case"reminder":return e.jsxs("svg",{...w,children:[e.jsx("path",{d:"M12 7v5l3 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M5 3h14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]});case"report":return e.jsx("svg",{...w,children:e.jsx("path",{d:"M3 7h18M6 11h12M9 15h6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})});case"system":return e.jsxs("svg",{...w,children:[e.jsx("path",{d:"M12 9v4",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 17h.01",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]});default:return e.jsxs("svg",{...w,children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z",fill:"currentColor"}),e.jsx("path",{d:"M12 7v6l4 2",stroke:"#fff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}}const S=t.read?"bg-gray-100 text-gray-500":`${E} text-white`;return e.jsxs("li",{className:`rounded-lg p-4 pb-12 sm:pb-6 relative ${p[x%p.length]} border border-blue-50 shadow-sm`,children:[e.jsxs("div",{className:"w-full flex items-center justify-between sm:hidden",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:`w-8 h-8 rounded-lg ${S} flex items-center justify-center text-base font-bold`,children:W(s,!0)})}),e.jsx("div",{className:"text-xs text-gray-500",children:f(t.createdAt)})]}),e.jsxs("div",{className:"hidden sm:flex items-start gap-3",children:[e.jsx("div",{className:"w-12 flex-shrink-0",children:e.jsx("div",{className:`w-12 h-12 rounded-lg ${S} flex items-center justify-center text-xl font-bold`,children:W(s,!1)})}),e.jsxs("div",{className:"flex-1 px-3",children:[e.jsx("div",{className:"text-sm font-semibold",title:t.title,children:t.title}),t.body?e.jsx("div",{className:"text-sm text-gray-600 mt-1 break-words",children:t.body}):null,L.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:L.map(i=>e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-white text-gray-700 border border-gray-100",children:i},i))}):null]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("div",{className:"text-xs text-gray-500",children:f(t.createdAt)}),e.jsxs("div",{className:"hidden sm:flex mt-3 gap-2",children:[(()=>{const i=!!t.read,v=i?"px-3 py-2 rounded-full bg-gray-100 text-gray-600 border border-gray-100":"px-3 py-2 rounded-full bg-blue-600 text-white border border-blue-600";return e.jsx("button",{onClick:()=>i?m(t.id):y(t.id),className:v,title:o(i?"notifications.mark_unread":"notifications.mark_read"),children:i?e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 12a9 9 0 1 0-9 9",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3 3l6 6",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"})]}):e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 12l4 4L18 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})})(),e.jsx("button",{onClick:()=>r(t.id),className:"px-3 py-2 rounded-full bg-red-50 text-red-600 border border-red-100",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M3 6h18",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]})]}),e.jsxs("div",{className:"sm:hidden mt-3",children:[e.jsx("div",{className:"text-sm font-semibold",title:t.title,children:t.title}),t.body?e.jsx("div",{className:"text-sm text-gray-600 mt-1 break-words",children:t.body}):null,L.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:L.map(i=>e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-white text-gray-700 border border-gray-100",children:i},i))}):null]}),e.jsxs("div",{className:"sm:hidden absolute right-4 bottom-4 flex items-center gap-2",children:[(()=>{const i=!!t.read,v=i?"px-3 py-2 rounded-full bg-gray-100 text-gray-600 border border-gray-100":"px-3 py-2 rounded-full bg-blue-600 text-white border border-blue-600";return e.jsx("button",{onClick:()=>i?m(t.id):y(t.id),className:v,title:o(i?"notifications.mark_unread":"notifications.mark_read"),children:i?e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 12a9 9 0 1 0-9 9",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3 3l6 6",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"})]}):e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 12l4 4L18 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})})(),e.jsx("button",{onClick:()=>r(t.id),className:"px-3 py-2 rounded-full bg-red-50 text-red-600 border border-red-100",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M3 6h18",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]},t.id)})}),e.jsx($,{id:u,open:!!u,onCancel:()=>d(null),onConfirm:C,loading:N})]})}function $({id:c,open:g,onCancel:l,onConfirm:j,loading:u}){const{t:d}=M();return!g||!c?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-full max-w-md relative",children:[e.jsx("button",{onClick:l,className:"absolute top-3 right-3 text-gray-500",children:"×"}),e.jsx("div",{className:"text-red-500 text-4xl mb-2 mt-2 flex justify-center",children:"🗑️"}),e.jsx("div",{className:"text-lg font-semibold mb-2 text-gray-900 text-center",children:d("notifications.confirm_delete.title")}),e.jsx("div",{className:"text-gray-500 mb-6 text-center",children:d("notifications.confirm_delete.body")}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:l,className:"flex-1 bg-gray-100 text-gray-700 rounded-lg px-4 py-2 font-medium hover:bg-gray-200 transition",disabled:u,children:d("notifications.confirm_delete.cancel")}),e.jsx("button",{onClick:()=>j(c),className:"flex-1 bg-red-500 text-white rounded-lg px-4 py-2 font-medium hover:bg-red-600 transition shadow",disabled:u,children:d(u?"notifications.deleting":"notifications.confirm_delete.confirm")})]})]})})}function I(){const[c,g]=a.useState(!1);a.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const n=window.matchMedia("(max-height: 600px) and (orientation: landscape)"),s=()=>g(!!n.matches);return s(),typeof n.addEventListener=="function"?n.addEventListener("change",s):n.addListener(s),window.addEventListener("resize",s),window.addEventListener("orientationchange",s),()=>{try{typeof n.removeEventListener=="function"?n.removeEventListener("change",s):n.removeListener(s)}catch{}window.removeEventListener("resize",s),window.removeEventListener("orientationchange",s)}},[]);const[l,j]=a.useState(1),[u,d]=a.useState([]),[N,k]=a.useState(!1);async function o(n=1){k(!0);try{const h=await(await b(`/api/notifications?page=${n}`,{credentials:"include"})).json();d(h.items||[]),j(h.page||n)}catch(s){console.error(s)}finally{k(!1)}}const[f,y]=a.useState({unread:0,today:0,week:0});async function m(){try{const s=await(await b("/api/notifications/stats",{credentials:"include"})).json();y({unread:s.unread||0,today:s.today||0,week:s.week||0})}catch(n){console.error("Failed to load notification stats",n)}}a.useEffect(()=>{typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("notifications:viewed")),(async()=>{try{await b("/api/notifications/mark-all-read",{method:"PUT",credentials:"include"})}catch(s){console.debug("mark-all-read on mount failed",s)}})(),m();const n=()=>{m(),o(l)};return window.addEventListener("notifications:changed",n),()=>window.removeEventListener("notifications:changed",n)},[l]),a.useEffect(()=>{o(1)},[]);const{t:r}=M(),[C,p]=a.useState(!1),[t,x]=a.useState(!1);return e.jsx("div",{className:`min-h-screen bg-[#f7f8fa] w-full flex flex-col items-center ${c?"":"md:pl-64"} px-2 md:px-8 py-8`,children:e.jsxs("div",{className:"w-full max-w-6xl mx-auto",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold mb-1 tracking-tight",style:{color:"#0b5566"},children:r("page.notifications.title")}),e.jsx("div",{className:"text-base md:text-lg font-medium mb-4 md:mb-6",style:{color:"#08323a"},children:r("page.notifications.desc")})]}),e.jsxs("div",{className:"flex flex-col items-start sm:items-start justify-start mb-6",children:[e.jsxs("div",{className:"flex gap-2 items-center mb-3 overflow-x-auto no-scrollbar",style:{WebkitOverflowScrolling:"touch"},children:[e.jsxs("div",{className:"flex-shrink-0 px-2 py-1 sm:px-4 sm:py-2 rounded-md sm:rounded-lg border border-red-200 bg-red-50 text-red-700 font-semibold text-sm sm:text-base",children:[f.unread,e.jsx("div",{className:"text-[10px] sm:text-xs text-red-500",children:r("notifications.stats.unread")})]}),e.jsxs("div",{className:"flex-shrink-0 px-2 py-1 sm:px-4 sm:py-2 rounded-md sm:rounded-lg border border-blue-200 bg-blue-50 text-blue-700 font-semibold text-sm sm:text-base",children:[f.today,e.jsx("div",{className:"text-[10px] sm:text-xs text-blue-500",children:r("notifications.stats.today")})]}),e.jsxs("div",{className:"flex-shrink-0 px-2 py-1 sm:px-4 sm:py-2 rounded-md sm:rounded-lg border border-green-200 bg-green-50 text-green-700 font-semibold text-sm sm:text-base",children:[f.week,e.jsx("div",{className:"text-[10px] sm:text-xs text-green-500",children:r("notifications.stats.week")})]})]}),e.jsxs("div",{className:"w-full sm:w-auto mt-3 flex flex-col sm:flex-row sm:items-center gap-2 sm:justify-start",children:[e.jsxs("button",{onClick:async()=>{try{await b("/api/notifications/mark-all-read",{method:"PUT",credentials:"include"}),m(),o(1),typeof window<"u"&&typeof window.dispatchEvent=="function"&&(window.dispatchEvent(new CustomEvent("notifications:changed")),window.dispatchEvent(new CustomEvent("notifications:viewed")))}catch(n){console.error("Failed to mark all read",n)}},className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 bg-white border border-gray-200 text-gray-700 rounded-full shadow-sm w-auto text-sm",title:r("notifications.mark_all"),style:{pointerEvents:"auto"},children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-gray-500",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:e.jsx("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-sm font-medium",children:r("notifications.mark_all")})]}),e.jsxs("button",{onClick:()=>p(!0),className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 bg-red-50 border border-red-200 text-red-700 rounded-full shadow-sm w-auto sm:ml-2 text-sm",title:r("notifications.delete_all"),style:{pointerEvents:"auto"},children:[e.jsxs("svg",{className:"w-3.5 h-3.5 text-red-500",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[e.jsx("path",{d:"M3 6h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10 11v6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14 11v6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 6V4h6v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"text-sm font-medium",children:r("notifications.delete_all")})]})]})]}),e.jsx(B,{items:u,loading:N,onRefresh:()=>o(l),onDeleted:()=>o(l)}),e.jsx(D,{open:C,title:r("notifications.confirm_delete.title"),body:r("notifications.confirm_delete_all"),confirmLabel:r("notifications.confirm_delete.confirm"),cancelLabel:r("notifications.confirm_delete.cancel"),loading:t,onCancel:()=>p(!1),onConfirm:async()=>{try{if(x(!0),!(await b("/api/notifications",{method:"DELETE",credentials:"include"})).ok)throw new Error("Delete failed");p(!1),m(),o(1),typeof window<"u"&&typeof window.dispatchEvent=="function"&&(window.dispatchEvent(new CustomEvent("notifications:changed")),window.dispatchEvent(new CustomEvent("notifications:viewed")))}catch(n){console.error("Failed to delete all notifications",n),alert(r("notifications.delete_all_failed")||"Échec de la suppression")}finally{x(!1)}}})]})})}export{I as default};
//# sourceMappingURL=Notifications-DR05jUeG.js.map
