{"version":3,"mappings":"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","names":["API_URL","inFlightFetches","useBirthdayCheck","centerId","birthdays","setBirthdays","useState","loading","setLoading","useEffect","cancelled","fetchPromise","url","res","data","result","BirthdayModal","items","open","onClose","canvasRef","useRef","computeAge","dobStr","dob","today","age","m","confettiRunningRef","confettiTimeoutRef","mod","__vitePreload","n","create","myConfettiFn","e","tick","err","key","jsxs","jsx","child","initials","s","ProtectedLayout","authenticated","setAuthenticated","navigate","useNavigate","outlet","useOutlet","setCenterId","showBirthday","setShowBirthday","seen","mounted","fetchWithRefresh","Sidebar"],"ignoreList":[],"sources":["../../src/hooks/useBirthdayCheck.ts","../../components/BirthdayModal.tsx","../../components/ProtectedLayout.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nconst API_URL = import.meta.env.VITE_API_URL || '';\n\ntype BirthdayItem = { id: string; name: string; dob: string; photoUrl?: string };\n\n// module-level map to deduplicate concurrent fetches for the same centerId\nconst inFlightFetches = new Map<string, Promise<{ birthdays?: BirthdayItem[] }>>();\n\nexport default function useBirthdayCheck(centerId?: string) {\n  const [birthdays, setBirthdays] = useState<BirthdayItem[]>([]);\n  const [loading, setLoading] = useState(false);\n  useEffect(() => {\n    if (!centerId) return;\n    let cancelled = false;\n    (async () => {\n      setLoading(true);\n      try {\n        // If there's already an in-flight fetch for this center, reuse it\n        let fetchPromise = inFlightFetches.get(centerId);\n        if (!fetchPromise) {\n          const url = API_URL ? `${API_URL}/centers/${centerId}/birthdays/today` : `/api/centers/${centerId}/birthdays/today`;\n          fetchPromise = (async () => {\n            const res = await fetch(url, { credentials: 'include' });\n            if (!res.ok) return { birthdays: [] };\n            const data = await res.json();\n            return { birthdays: Array.isArray(data.birthdays) ? data.birthdays : [] };\n          })();\n          inFlightFetches.set(centerId, fetchPromise);\n        }\n\n        const result = await fetchPromise;\n        if (!cancelled) setBirthdays(result.birthdays ?? []);\n      } catch {\n        if (!cancelled) setBirthdays([]);\n      } finally {\n        if (!cancelled) setLoading(false);\n        // clear in-flight entry for this centerId so subsequent calls will refetch later\n        inFlightFetches.delete(centerId);\n      }\n    })();\n    return () => { cancelled = true; };\n  }, [centerId]);\n\n  return { birthdays, loading };\n}\n","import { useEffect, useRef } from 'react';\n\ntype Child = { id: string; name: string; dob: string; photoUrl?: string };\n\nexport default function BirthdayModal({ items, open, onClose, centerId }: { items: Child[]; open: boolean; onClose: ()=>void; centerId?: string }) {\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  // compute age in years from a birth date string\n  const computeAge = (dobStr?: string) => {\n    if (!dobStr) return null;\n    try {\n      const dob = new Date(dobStr);\n      if (Number.isNaN(dob.getTime())) return null;\n      const today = new Date();\n      let age = today.getFullYear() - dob.getFullYear();\n      const m = today.getMonth() - dob.getMonth();\n      if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;\n      return age;\n  } catch { return null; }\n  };\n\n  // Robust confetti effect: use refs to hold running flag and timeout id so\n  // repeated renders or async timing won't accidentally cancel the loop.\n  const confettiRunningRef = useRef(false);\n  const confettiTimeoutRef = useRef<number | null>(null);\n\n  useEffect(() => {\n    if (!open) return;\n    confettiRunningRef.current = true;\n    // confetti burst: dynamically import so projects without the dependency still build\n    (async () => {\n      try {\n  // prefer the lightweight bundle if available\n  // Try the normal package first, then fallback to the browser bundle for more compatibility\n  // @vite-ignore\n  let mod: unknown = null;\n        try {\n          mod = await import('canvas-confetti');\n          } catch {\n          try {\n            // fallback: browser bundle has no TS types â€” expect an error here\n            // @ts-expect-error browser-bundle has no types\n            // @vite-ignore\n            mod = await import('canvas-confetti/dist/confetti.browser.js');\n          } catch {\n            mod = null;\n          }\n        }\n        if (!mod) return;\n        if (!confettiRunningRef.current) return;\n\n        // create has a runtime shape we can type: it accepts an optional canvas and options\n        type ConfettiOptions = { resize?: boolean; useWorker?: boolean } & Record<string, unknown>;\n        type ConfettiCreate = (canvas?: HTMLCanvasElement | OffscreenCanvas | undefined, opts?: ConfettiOptions) => ( (options?: Record<string, unknown>) => void );\n        const create = (mod && typeof mod === 'function' ? mod : (mod && (mod as { default?: unknown }).default) || mod) as unknown as ConfettiCreate;\n\n        // Use the non-worker path to avoid transferable/cloning issues across browsers.\n        let myConfettiFn: ((options?: Record<string, unknown>) => void) | null = null;\n        try {\n          // let the library create and manage its own canvas to avoid transfer/cloning issues\n          myConfettiFn = create(undefined, { resize: true, useWorker: false });\n        } catch (e) {\n          console.error('[BirthdayModal] confetti.create failed:', e);\n        }\n\n        if (!myConfettiFn || typeof myConfettiFn !== 'function') {\n          // nothing to do â€” confetti couldn't be created\n          return;\n        }\n\n        // Fire an initial burst\n        try {\n          myConfettiFn({ particleCount: 140, spread: 160, origin: { y: 0.6 } });\n        } catch (e) {\n          console.error('[BirthdayModal] confetti first-fire failed:', e);\n        }\n\n        // Use a recursive timeout loop instead of setInterval for better control and cleanup\n        const tick = () => {\n          if (!confettiRunningRef.current) return;\n          try {\n            myConfettiFn({ particleCount: 40, spread: 120, origin: { x: Math.random(), y: 0.6 } });\n            console.debug('[BirthdayModal] confetti tick');\n          } catch (e) {\n            console.error('[BirthdayModal] confetti tick error:', e);\n          }\n          if (confettiRunningRef.current) {\n            confettiTimeoutRef.current = window.setTimeout(tick, 1200) as unknown as number;\n          }\n        };\n        // start the recurring ticks\n        confettiTimeoutRef.current = window.setTimeout(tick, 1200) as unknown as number;\n      } catch (err) {\n        // log the error so we can diagnose why animation doesn't run\n        console.error('[BirthdayModal] failed to load canvas-confetti:', err);\n      }\n    })();\n\n    // mark seen in localStorage (avoid repeating)\n    if (centerId) {\n      const key = `birthday_seen:${centerId}:${new Date().toISOString().slice(0,10)}`;\n      try { localStorage.setItem(key, '1'); } catch { /* ignore */ }\n    }\n\n    return () => {\n      // stop the recurring ticks\n      confettiRunningRef.current = false;\n      if (confettiTimeoutRef.current !== null) {\n        clearTimeout(confettiTimeoutRef.current);\n        confettiTimeoutRef.current = null;\n      }\n    };\n  }, [open, centerId]);\n\n\n  useEffect(() => {\n    if (!open) return;\n    // focus trap: set focus to close button after open - simple approach\n    const el = document.getElementById('birthday-close-btn');\n    el?.focus();\n  }, [open]);\n\n  if (!open) return null;\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-6\">\n      <canvas ref={canvasRef} className=\"pointer-events-none fixed inset-0\" />\n\n      <div role=\"dialog\" aria-modal=\"true\" aria-label=\"CÃ©lÃ©bration anniversaire\" className=\"w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden\">\n        {/* Hero */}\n        <div className=\"h-64 bg-gradient-to-br from-[#f6a21a] to-[#ffd98a] flex flex-col items-center justify-center text-white\">\n          <div className=\"text-5xl\">ðŸŽ‰</div>\n          <h1 className=\"mt-3 text-4xl font-extrabold tracking-tight uppercase text-center\">Joyeux Anniversaire</h1>\n        </div>\n\n        {/* Content */}\n        <div className=\"bg-white p-6\">\n          {/* List all birthday children */}\n          {items && items.length > 0 ? (\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n              {items.map((child) => {\n                const initials = (child.name || 'U').split(' ').map(s => s[0]).slice(0,2).join('');\n                const age = computeAge(child.dob);\n                return (\n                  <div key={child.id} className=\"flex items-center gap-4 p-3 rounded-lg border border-gray-100 shadow-sm bg-white\">\n                    <div className=\"w-16 h-16 rounded-full flex items-center justify-center\" style={{ background: 'linear-gradient(135deg,#ff6aa1,#ff9b4a)' }}>\n                      <span className=\"text-white font-bold text-lg\">{initials}</span>\n                    </div>\n\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"text-lg font-extrabold text-[#08323a] truncate\">{child.name}</div>\n                      <div className=\"text-sm text-gray-500 truncate\">fÃªte {age !== null ? `ses ${age} ans` : 'son anniversaire'} aujourd'hui !</div>\n                    </div>\n\n                    <div className=\"flex-shrink-0\">\n                      <div className=\"px-3 py-2 rounded-full bg-gradient-to-br from-[#e68d17] to-[#f7b65d] text-white font-semibold shadow\">{age ?? '-'}</div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <div className=\"text-center text-gray-500\">Aucun enfant trouvÃ© pour aujourd'hui.</div>\n          )}\n\n          <div className=\"mt-6\">\n            <div className=\"rounded-xl border border-[#f3cda6] bg-gradient-to-br from-[#fff4ed] to-[#fff9f6] p-5 shadow-sm\">\n              <div className=\"text-center text-[#b45309] font-semibold mb-2\">â™¡ Message spÃ©cial â™¡</div>\n              <div className=\"text-sm text-[#6b4b3a]\">Nous souhaitons Ã  {items && items.length === 1 ? items[0].name : 'tous les enfants'} une merveilleuse journÃ©e remplie de joie, de rires et de beaux souvenirs ! Que cette nouvelle annÃ©e vous apporte plein de dÃ©couvertes et de bonheurs.</div>\n            </div>\n          </div>\n\n          {/* Footer with centered close button */}\n          <div className=\"mt-6 pb-6 flex justify-center\">\n            <button id=\"birthday-close-btn\" type=\"button\" onClick={onClose} className=\"px-6 py-2 bg-[#08323a] text-white rounded-lg font-semibold shadow hover:bg-[#0b3b41] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#f6a21a]\">Fermer</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useState } from 'react';\nimport Sidebar from './Sidebar';\nimport { useNavigate, useOutlet } from 'react-router-dom';\nimport { fetchWithRefresh } from '../utils/fetchWithRefresh';\nimport useBirthdayCheck from '../src/hooks/useBirthdayCheck';\nimport BirthdayModal from './BirthdayModal';\n\nexport default function ProtectedLayout() {\n  const [loading, setLoading] = useState(true);\n  const [authenticated, setAuthenticated] = useState(false);\n  const navigate = useNavigate();\n  const outlet = useOutlet();\n  // tutorial/welcome modal disabled by default\n  // Keep a stateful centerId (initialize from localStorage) so we can update it\n  // after we fetch /api/user/me. This ensures the birthday check runs for any\n  // authenticated user that belongs to the same center as the child.\n  const [centerId, setCenterId] = useState<string | undefined>(() => {\n    try {\n      const raw = localStorage.getItem('currentCenterId');\n      return raw ?? undefined;\n    } catch {\n      return undefined;\n    }\n  });\n\n  // Only check birthdays after we've confirmed the user is authenticated and we have a centerId\n  const { birthdays } = useBirthdayCheck(authenticated ? centerId : undefined);\n\n  const [showBirthday, setShowBirthday] = useState(false);\n\n  useEffect(() => {\n    if (!birthdays || birthdays.length === 0 || !centerId) return;\n    const key = `birthday_seen:${centerId}:${new Date().toISOString().slice(0,10)}`;\n    let seen = false;\n    try { seen = !!localStorage.getItem(key); } catch { seen = false; }\n    if (!seen) setShowBirthday(true);\n  }, [birthdays, centerId, setShowBirthday]);\n\n  useEffect(() => {\n    // Use relative path so cookies are sent correctly in dev (Vite proxy) and in prod the same origin is used\n    let mounted = true;\n    (async () => {\n      try {\n        const res = await fetchWithRefresh('/api/user/me', { credentials: 'include' });\n        if (!mounted) return;\n        if (!res.ok) {\n          setAuthenticated(false);\n          return;\n        }\n        const data = await res.json();\n        setAuthenticated(true);\n        try {\n          if (data && data.centerId) {\n            try { localStorage.setItem('currentCenterId', String(data.centerId)); } catch { /* ignore */ }\n            setCenterId(String(data.centerId));\n          }\n        } catch { /* ignore parse errors */ }\n      } catch {\n        setAuthenticated(false);\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    })();\n    return () => { mounted = false; };\n  }, []);\n\n  useEffect(() => {\n    if (!loading && !authenticated) {\n      navigate('/login', { replace: true });\n    }\n    if (!loading && authenticated) {\n      // mark welcome as shown to prevent tutorial modal from appearing\n      try { localStorage.setItem('welcomeShown', '1'); } catch { /* ignore */ }\n    }\n  }, [loading, authenticated, navigate]);\n\n  if (loading) return <div className=\"flex items-center justify-center h-screen\">Chargement...</div>;\n  if (!authenticated) return null;\n\n\n  return (\n    <div className=\"flex min-h-screen\">\n      <Sidebar />\n  <main className=\"flex-1 bg-gray-50 p-6 max-w-full overflow-x-hidden box-border\">\n  {/* Welcome/tutorial modal disabled */}\n        {outlet}\n      </main>\n      <BirthdayModal items={birthdays} open={showBirthday} onClose={() => setShowBirthday(false)} centerId={centerId} />\n    </div>\n  );\n}\n"],"file":"assets/ProtectedLayout-DMo8fCEy.js"}