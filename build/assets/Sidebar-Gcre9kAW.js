import{r as l,n as O,b as A,j as e,L as F,f as I,g as z,s as V,D as Z,k as B,p as k,o as T}from"./index-BlCxgRmJ.js";import{u as U}from"./useI18n-BzDKbdEV.js";import{G as q,i as G,j as _,k as y,c as h,l as g,m as f,n as L,o as E,p as C,q as M,r as $}from"./index-fENnYS2p.js";function S(t){return q({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"},child:[]}]})(t)}function W(t,n){return t&&t.role==="parent"?[{to:"/dashboard",label:n("nav.dashboard"),icon:e.jsx(y,{className:"w-5 h-5 mr-3"})},{to:"/feed",label:n("nav.feed"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/notifications",label:n("nav.notifications"),icon:e.jsx(g,{className:"w-5 h-5 mr-3"})},{to:"/children",label:n("nav.children_my"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/parent",label:n("nav.parents"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/reports",label:n("nav.reports"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/activites",label:n("nav.activities"),icon:e.jsx(L,{className:"w-5 h-5 mr-3"})},{to:"/payment-history",label:n("nav.payments"),icon:e.jsx(E,{className:"w-5 h-5 mr-3"})},{to:"/settings",label:n("nav.settings"),icon:e.jsx(C,{className:"w-5 h-5 mr-3"})}]:t&&t.nannyId?[{to:"/dashboard",label:n("nav.dashboard"),icon:e.jsx(y,{className:"w-5 h-5 mr-3"})},{to:"/feed",label:n("nav.feed"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/notifications",label:n("nav.notifications"),icon:e.jsx(g,{className:"w-5 h-5 mr-3"})},{to:"/children",label:n("nav.children"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/parent",label:n("nav.parents"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/nannies",label:n("nav.nannies"),icon:e.jsx(M,{className:"w-5 h-5 mr-3"})},{to:"/activites",label:n("nav.activities"),icon:e.jsx(L,{className:"w-5 h-5 mr-3"})},{to:"/reports",label:n("nav.reports"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/assistant",label:n("nav.assistant"),icon:e.jsx(S,{className:"w-5 h-5 mr-3"})},{to:"/payment-history",label:n("nav.payments"),icon:e.jsx(E,{className:"w-5 h-5 mr-3"})},{to:"/settings",label:n("nav.settings"),icon:e.jsx(C,{className:"w-5 h-5 mr-3"})}]:[{to:"/dashboard",label:n("nav.dashboard"),icon:e.jsx(y,{className:"w-5 h-5 mr-3"})},{to:"/feed",label:n("nav.feed"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/notifications",label:n("nav.notifications"),icon:e.jsx(g,{className:"w-5 h-5 mr-3"})},{to:"/children",label:n("nav.children"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/parent",label:n("nav.parents"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/nannies",label:n("nav.nannies"),icon:e.jsx(M,{className:"w-5 h-5 mr-3"})},{to:"/activites",label:n("nav.activities"),icon:e.jsx(L,{className:"w-5 h-5 mr-3"})},{to:"/reports",label:n("nav.reports"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/assistant",label:n("nav.assistant"),icon:e.jsx(S,{className:"w-5 h-5 mr-3"})},{to:"/payment-history",label:n("nav.payments"),icon:e.jsx(E,{className:"w-5 h-5 mr-3"})},...t&&typeof t.role=="string"&&t.role.toLowerCase().includes("super")?[{to:"/admin/reviews",label:n("nav.reviews"),icon:e.jsx($,{className:"w-5 h-5 mr-3"})}]:[],{to:"/settings",label:n("nav.settings"),icon:e.jsx(C,{className:"w-5 h-5 mr-3"})}]}function K({showOnMd:t=!1,onOpen:n}){const[x,i]=l.useState(!1),{t:w}=U();return l.useEffect(()=>{try{if(typeof window>"u"){i(!0);return}const c=window.matchMedia("(max-width: 767px)"),r=window.matchMedia("(max-height: 600px) and (orientation: landscape)"),m=()=>{try{const p=typeof window<"u"&&window.matchMedia&&window.matchMedia("(orientation: landscape)").matches,j=typeof window<"u"?window.innerHeight:1/0;return p&&j<=700}catch{return r.matches}},s=()=>i(c.matches||t&&m());return s(),typeof c.addEventListener=="function"?c.addEventListener("change",s):c.addListener(s),typeof r.addEventListener=="function"?r.addEventListener("change",s):r.addListener(s),window.addEventListener("resize",s),window.addEventListener("orientationchange",s),()=>{try{typeof c.removeEventListener=="function"?c.removeEventListener("change",s):c.removeListener(s)}catch{}try{typeof r.removeEventListener=="function"?r.removeEventListener("change",s):r.removeListener(s)}catch{}try{window.removeEventListener("resize",s)}catch{}try{window.removeEventListener("orientationchange",s)}catch{}}}catch{i(!0)}},[t]),x?e.jsx("button",{className:"fixed top-4 right-4 z-60 bg-white rounded-full p-2 shadow-lg border border-gray-200",onClick:n,"aria-label":w("menu.open"),children:e.jsx(_,{className:"w-7 h-7 text-gray-700"})}):null}function X(){const[t,n]=l.useState(!1),x=O(),{user:i}=A(),{t:w}=U(),[c,r]=l.useState(null),[m,s]=l.useState(0),p=l.useRef(0);l.useEffect(()=>{let o=!0;try{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(min-width: 768px)").matches)return}catch{}async function u(){try{if(!i)return s(0);const a=await I("/api/notifications/unread-count",{credentials:"include"});if(!o)return;if(!a.ok)return s(0);const d=await a.json();s(Number(d.unread)||0)}catch{o&&s(0)}}u();const v=setInterval(u,3e4);function N(){u()}return typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("notifications:changed",N),()=>{o=!1,clearInterval(v),typeof window<"u"&&typeof window.removeEventListener=="function"&&window.removeEventListener("notifications:changed",N)}},[i]),l.useEffect(()=>{try{t?document.body.style.overflow="hidden":document.body.style.overflow=""}catch{}return()=>{try{document.body.style.overflow=""}catch{}}},[t]),l.useEffect(()=>{let o=!0;async function u(){try{const v=i?.centerId;if(v){const N=Date.now();if(p.current>N)return;const a=`/api/centers/${v}`,d=z(a);if(d){r(d.name||null);return}const b=await fetch(`/centers/${v}`,{credentials:"include"});if(!o)return;if(b.status===429){const H=b.headers.get("Retry-After"),R=H?parseInt(H,10):NaN,D=Number.isNaN(R)?1e4:R*1e3;p.current=Date.now()+D;return}if(b.ok){const H=await b.json();r(H.name||null),V(a,{name:H.name||null},Z);return}}}catch{}o&&r(null)}return u(),()=>{o=!1}},[i]);function j(o){if(!o)return"Frimousse";const u=o.trim();return u.length===0?"Frimousse":u.charAt(0).toUpperCase()+u.slice(1)}return e.jsxs(e.Fragment,{children:[!t&&e.jsx(K,{showOnMd:!0,onOpen:()=>n(!0)}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-white flex flex-col",style:{WebkitOverflowScrolling:"touch"},children:[e.jsxs("div",{className:"flex items-center gap-3 px-6 pt-8 pb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-white flex items-center justify-center",children:e.jsx("img",{src:"/imgs/LogoFrimousse.webp",alt:"Logo Frimousse",className:"w-full h-full object-contain"})}),e.jsx("span",{className:"font-extrabold text-xl text-gray-900",children:j(c)}),e.jsx("button",{className:"ml-auto bg-gray-100 rounded-full p-2 border border-gray-200",onClick:()=>n(!1),"aria-label":w("menu.close"),children:e.jsx(G,{className:"w-6 h-6 text-gray-700"})})]}),e.jsx("nav",{className:"flex-1 px-2 overflow-y-auto",style:{maxHeight:"calc(100vh - 160px)",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:e.jsx("ul",{className:"space-y-1",style:{paddingBottom:"96px"},children:W(i,w).map(o=>e.jsx("li",{children:e.jsxs(F,{to:o.to,className:`flex items-center px-4 py-3 rounded-lg font-medium transition text-lg ${x.pathname===o.to?"bg-blue-50 text-blue-700 border border-blue-100":"text-gray-500 hover:bg-gray-50"}`,onClick:()=>n(!1),children:[o.icon,e.jsx("span",{className:"flex-1",children:o.label}),o.to==="/notifications"&&m>0?e.jsx("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold bg-red-600 text-white",children:m}):null]})},o.to))})}),e.jsxs("div",{className:"mt-auto flex items-center gap-3 px-6 py-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-base font-bold text-blue-700 border border-blue-100",children:i?(i.name||"U").split(" ").map(o=>o[0]).join("").toUpperCase().slice(0,2):"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 leading-tight",children:i?.name||"Utilisateur"}),e.jsx("div",{className:"text-xs text-gray-400 capitalize",children:i?.role?i.role.replace("_"," "):"Utilisateur"})]})]})]})]})}function J(t){const[n,x]=l.useState(null),i=l.useRef(0),w=l.useRef(0);l.useEffect(()=>{const r=B(m=>{!m||!m.key||t&&m.key===`/api/centers/${t}`&&typeof m.until=="number"&&(i.current=Math.max(i.current,m.until||0))});return()=>r()},[t]);const c=l.useCallback(async()=>{if(!t){x(null);return}try{if(i.current>Date.now())return;const r=`/api/centers/${t}`,m=z(r);if(m){x({name:m.name||null});return}const s=await fetch(`/centers/${t}`,{credentials:"include"});if(s.status===429){w.current=Math.min(3,w.current+1);const j=Math.min(1e4*Math.pow(2,w.current-1),4e4),o=Date.now()+j;i.current=Math.max(i.current,o),k(`/api/centers/${t}`,i.current);return}if(!s.ok){x(null);return}w.current=0;const p=await s.json();x({name:p.name||null}),V(r,{name:p.name||null},6e4)}catch{x(null)}},[t]);return l.useEffect(()=>{c()},[c]),{center:n,refresh:c}}function P(t,n){return t&&t.role==="parent"?[{to:"/dashboard",label:n("nav.dashboard"),icon:e.jsx(y,{className:"w-5 h-5 mr-3"})},{to:"/feed",label:n("nav.feed"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/notifications",label:n("nav.notifications"),icon:e.jsx(g,{className:"w-5 h-5 mr-3"})},{to:"/children",label:n("nav.children_my"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/parent",label:n("nav.parents"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/reports",label:n("nav.reports"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/activites",label:n("nav.activities"),icon:e.jsx(L,{className:"w-5 h-5 mr-3"})},{to:"/payment-history",label:n("nav.payments"),icon:e.jsx(E,{className:"w-5 h-5 mr-3"})},{to:"/settings",label:n("nav.settings"),icon:e.jsx(C,{className:"w-5 h-5 mr-3"})}]:t&&t.nannyId?[{to:"/dashboard",label:n("nav.dashboard"),icon:e.jsx(y,{className:"w-5 h-5 mr-3"})},{to:"/feed",label:n("nav.feed"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/notifications",label:n("nav.notifications"),icon:e.jsx(g,{className:"w-5 h-5 mr-3"})},{to:"/children",label:n("nav.children"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/parent",label:n("nav.parents"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/nannies",label:n("nav.nannies"),icon:e.jsx(M,{className:"w-5 h-5 mr-3"})},{to:"/activites",label:n("nav.activities"),icon:e.jsx(L,{className:"w-5 h-5 mr-3"})},{to:"/reports",label:n("nav.reports"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/assistant",label:n("nav.assistant"),icon:e.jsx(S,{className:"w-5 h-5 mr-3"})},{to:"/payment-history",label:n("nav.payments"),icon:e.jsx(E,{className:"w-5 h-5 mr-3"})},{to:"/settings",label:n("nav.settings"),icon:e.jsx(C,{className:"w-5 h-5 mr-3"})}]:[{to:"/dashboard",label:n("nav.dashboard"),icon:e.jsx(y,{className:"w-5 h-5 mr-3"})},{to:"/feed",label:n("nav.feed"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/notifications",label:n("nav.notifications"),icon:e.jsx(g,{className:"w-5 h-5 mr-3"})},{to:"/children",label:n("nav.children"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/parent",label:n("nav.parents"),icon:e.jsx(f,{className:"w-5 h-5 mr-3"})},{to:"/nannies",label:n("nav.nannies"),icon:e.jsx(M,{className:"w-5 h-5 mr-3"})},{to:"/activites",label:n("nav.activities"),icon:e.jsx(L,{className:"w-5 h-5 mr-3"})},{to:"/reports",label:n("nav.reports"),icon:e.jsx(h,{className:"w-5 h-5 mr-3"})},{to:"/assistant",label:n("nav.assistant"),icon:e.jsx(S,{className:"w-5 h-5 mr-3"})},{to:"/payment-history",label:n("nav.payments"),icon:e.jsx(E,{className:"w-5 h-5 mr-3"})},...t&&typeof t.role=="string"&&t.role.toLowerCase().includes("super")?[{to:"/admin/reviews",label:"Avis",icon:e.jsx($,{className:"w-5 h-5 mr-3"})}]:[],{to:"/settings",label:n("nav.settings"),icon:e.jsx(C,{className:"w-5 h-5 mr-3"})}]}function ne(){const t=O(),{user:n}=A(),{t:x}=U(),[i,w]=l.useState(!1),{unreadCount:c,unreadReviews:r}=T(),m=n&&n.centerId,{center:s}=J(m??null),[p,j]=l.useState(null);l.useEffect(()=>{j(s?.name??null)},[s]),l.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const a=window.matchMedia("(min-width: 768px) and (max-height: 600px)"),d=()=>w(!!a.matches);d(),typeof a.addEventListener=="function"?a.addEventListener("change",d):typeof a.addListener=="function"&&a.addListener(d);const b=()=>d();return window.addEventListener("resize",b),window.addEventListener("orientationchange",b),()=>{typeof a.removeEventListener=="function"?a.removeEventListener("change",d):typeof a.removeListener=="function"&&a.removeListener(d),window.removeEventListener("resize",b),window.removeEventListener("orientationchange",b)}},[]);function o(a){if(!a)return"Frimousse";const d=a.trim();return d.length===0?"Frimousse":d.charAt(0).toUpperCase()+d.slice(1)}let u="Utilisateur",v="Utilisateur",N="UT";return n&&n.name&&(u=n.name,N=n.name.split(" ").filter(Boolean).map(a=>a[0]).join("").toUpperCase().slice(0,2)),n&&n.role&&(v=n.role),e.jsxs(e.Fragment,{children:[e.jsx(X,{}),!i&&e.jsxs("aside",{className:"hidden md:flex fixed top-0 left-0 h-screen w-64 bg-white shadow-lg flex-col p-0 border-r border-gray-100 z-30",children:[e.jsxs("div",{className:"flex items-center gap-3 px-6 pt-8 pb-6",children:[e.jsx("div",{className:"w-20 h-16 rounded-full overflow-hidden bg-white flex items-center justify-center",children:e.jsx("img",{src:"/imgs/LogoFrimousse.webp",alt:"Logo Frimousse",className:"w-full h-full object-contain"})}),e.jsx("span",{className:"font-extrabold text-xl text-gray-900",children:o(p)})]}),e.jsx("nav",{className:"flex-1 px-2",children:e.jsx("ul",{className:"space-y-1",children:P(n,x).map(a=>e.jsx("li",{children:e.jsxs(F,{to:a.to,className:`flex items-center px-4 py-2 rounded-lg font-medium transition text-base ${t.pathname===a.to?"bg-blue-50 text-blue-700 border border-blue-100":"text-gray-500 hover:bg-gray-50"}`,children:[a.icon,e.jsx("span",{className:"flex-1",children:a.label}),a.to==="/notifications"&&c>0?e.jsx("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold bg-red-600 text-white",children:c}):null,a.to==="/admin/reviews"&&typeof r=="number"&&r>0?e.jsx("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-600 text-white",children:r}):null]})},a.to))})}),e.jsxs("div",{className:"mt-auto flex items-center gap-3 px-6 py-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-base font-bold text-blue-700 border border-blue-100",children:N}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 leading-tight",children:u}),e.jsx("div",{className:"text-xs text-gray-400",children:v})]})]})]})]})}export{ne as S};
//# sourceMappingURL=Sidebar-Gcre9kAW.js.map
